!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).GrowingGlyphs={})}(this,(function(t){"use strict";function e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function r(t,e,r){return e&&n(t.prototype,e),r&&n(t,r),t}function i(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&s(t,e)}function a(t){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function s(t,e){return(s=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function u(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function l(t,e,n){return(l=u()?Reflect.construct:function(t,e,n){var r=[null];r.push.apply(r,e);var i=new(Function.bind.apply(t,r));return n&&s(i,n.prototype),i}).apply(null,arguments)}function h(t){var e="function"==typeof Map?new Map:void 0;return(h=function(t){if(null===t||(n=t,-1===Function.toString.call(n).indexOf("[native code]")))return t;var n;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,r)}function r(){return l(t,arguments,a(this).constructor)}return r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),s(r,t)})(t)}function c(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function p(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?c(t):e}function f(t){var e=u();return function(){var n,r=a(t);if(e){var i=a(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p(this,n)}}function y(t,e,n){return(y="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=a(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(n):i.value}})(t,e,n||t)}function g(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(t){i=!0,o=t}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return n}(t,e)||v(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function d(t){return function(t){if(Array.isArray(t))return _(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||v(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function v(t,e){if(t){if("string"==typeof t)return _(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_(t,e):void 0}}function _(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function b(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=v(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}var m={MIN_CELL_SIZE:1e-8,BIG_GLYPH_FACTOR:100,MAX_GLYPHS_PER_CELL:10,MAX_MERGES_TO_RECORD:4,BIG_GLYPHS:!1,ROBUST:!1,TRACK:!0,LOGGING_ENABLED:!0,STATS_ENABLED:!1,TIMERS_ENABLED:!0};function E(t){return null===t||t instanceof w}var O,w=function(){function t(n,r,o,a){e(this,t),i(this,"x",void 0),i(this,"y",void 0),i(this,"width",void 0),i(this,"height",void 0),this.x=n,this.y=r,this.width=o,this.height=a}return r(t,[{key:"getX",value:function(){return this.x}},{key:"getWidth",value:function(){return this.width}},{key:"getY",value:function(){return this.y}},{key:"getHeight",value:function(){return this.height}},{key:"getMinX",value:function(){return this.x}},{key:"getMaxX",value:function(){return this.x+this.width}},{key:"getMinY",value:function(){return this.y}},{key:"getMaxY",value:function(){return this.y+this.height}},{key:"contains",value:function(t,e){var n=this.getX(),r=this.getY();return t>=n&&e>=r&&t<n+this.getWidth()&&e<r+this.getHeight()}},{key:"getCenterX",value:function(){return this.getX()+this.getWidth()/2}},{key:"getCenterY",value:function(){return this.getY()+this.getHeight()/2}}]),t}();O=Symbol.iterator;var k,A=function(){function t(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e(this,t),i(this,"__internal",void 0),this.__internal=new Set(n)}return r(t,[{key:"add",value:function(t){return!this.__internal.has(t)&&(this.__internal.add(t),!0)}},{key:O,value:function(){return this.__internal[Symbol.iterator]()}}]),t}(),C=function(){function t(){e(this,t)}return r(t,null,[{key:"toCollection",value:function(t){return t}},{key:"toList",value:function(){return function(t){return t}}},{key:"toSet",value:function(){return function(t){return Array.from(new A(t))}}}]),t}();k=Symbol.iterator;var S=function(){function t(n){e(this,t),i(this,"__internal",void 0),this.__internal=[]}return r(t,[{key:"toString",value:function(){return"[".concat(this.__internal.join(", "),"]")}},{key:"addI",value:function(t,e){this.__internal.splice(t,0,e)}},{key:"add",value:function(t){return this.__internal.push(t),!0}},{key:"addAll",value:function(t){var e;return this.__internal.length===(e=this.__internal).push.apply(e,d(t))}},{key:k,value:function(){return this.__internal[Symbol.iterator]()}},{key:"length",get:function(){return this.__internal.length}},{key:"clear",value:function(){this.__internal=[]}},{key:"stream",value:function(){return new j(this.__internal)}},{key:"get",value:function(t){return this.__internal[t]}},{key:"contains",value:function(t){return this.__internal.includes(t)}},{key:"size",value:function(){return this.__internal.length}},{key:"isEmpty",value:function(){return 0===this.__internal.length}},{key:"removeI",value:function(t){if(-1===t)throw new Error("IndexOutOfBoundsException");return g(this.__internal.splice(t,1),1)[0]}},{key:"remove",value:function(t){var e=this.__internal.indexOf(t);return-1!==e&&(this.__internal.splice(e,1),!0)}},{key:"set",value:function(t,e){var n=this.__internal[t];if(void 0===n)throw new Error("OutOfBoundException");return this.__internal[t]=e,n}},{key:"poll",value:function(){return this.__internal.shift()}},{key:"pollLast",value:function(){return this.__internal.pop()}},{key:"getLast",value:function(){return this.__internal[this.__internal.length-1]}},{key:"addFirst",value:function(t){return this.__internal.unshift(t)}},{key:"sort",value:function(t){return this.__internal.sort(t)}},{key:"toArray",value:function(){return Array.from(this.__internal)}},{key:"copy",value:function(){return t.__new(Array.from(this.__internal))}},{key:"sorted",value:function(){}}],[{key:"__new",value:function(e){var n=new t;return n.__internal=e,n}}]),t}(),R=function(){function t(n){e(this,t),i(this,"value",void 0),this.value=n}return r(t,[{key:"get",value:function(){if(null===this.value)throw new Error("null pointer exception XD");return this.value}}]),t}(),j=function(){function t(n){e(this,t),i(this,"__internal",void 0),this.__internal=n}return r(t,[{key:"length",get:function(){return this.__internal.length}},{key:"filter",value:function(t){return this.__internal=this.__internal.filter(t),this}},{key:"collect",value:function(t){return t(this.__internal)}},{key:"map",value:function(e){return new t(this.__internal.map(e))}},{key:"mapToInt",value:function(t){return new L(this.__internal.map(t))}},{key:"max",value:function(t){var e=this.__internal.reduce((function(e,n){return null===e||t(e,n)<0?n:e}),null);return new R(e)}},{key:"sorted",value:function(t){return this.__internal.sort(t),this}},{key:"toArray",value:function(){return this.__internal}},{key:"forEach",value:function(t){this.__internal.forEach(t)}},{key:"parallel",value:function(){return this}},{key:"flatMap",value:function(e){return new t(this.__internal.flatMap(e))}},{key:"iterator",value:function(){return this.__internal.values()}},{key:"distinct",value:function(){return new t(this.collect(C.toSet()))}}]),t}(),L=function(t){o(i,t);var n=f(i);function i(){return e(this,i),n.apply(this,arguments)}return r(i,[{key:"sum",value:function(){return this.__internal.reduce((function(t,e){return t+e}),0)}}]),i}(j);class M{constructor(t=[],e=N){if(this.data=t,this.length=this.data.length,this.compare=e,this.length>0)for(let t=(this.length>>1)-1;t>=0;t--)this._down(t)}push(t){this.data.push(t),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const t=this.data[0],e=this.data.pop();return this.length--,this.length>0&&(this.data[0]=e,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:e,compare:n}=this,r=e[t];for(;t>0;){const i=t-1>>1,o=e[i];if(n(r,o)>=0)break;e[t]=o,t=i}e[t]=r}_down(t){const{data:e,compare:n}=this,r=this.length>>1,i=e[t];for(;t<r;){let r=1+(t<<1),o=e[r];const a=r+1;if(a<this.length&&n(e[a],o)<0&&(r=a,o=e[a]),n(o,i)>=0)break;e[t]=o,t=r}e[t]=i}}function N(t,e){return t<e?-1:t>e?1:0}var x,T=function(){function t(n){e(this,t),i(this,"__internal",void 0),this.__internal=new M([],(function(t,e){return t.compareTo(e)}))}return r(t,[{key:"add",value:function(t){return this.__internal.push(t),!0}},{key:"peek",value:function(){return this.__internal.peek()}},{key:"poll",value:function(){return this.__internal.pop()}},{key:"size",value:function(){return this.__internal.length}},{key:"isEmpty",value:function(){return 0===this.__internal.length}}]),t}(),I=function(){function t(n){e(this,t),i(this,"__internal",void 0),this.__internal=null!=n?n:""}return r(t,[{key:"append",value:function(t){return this.__internal+=t,this}},{key:"toString",value:function(){return this.__internal}},{key:"length",value:function(){return this.__internal.length}}]),t}(),G=function(){function t(){e(this,t)}return r(t,null,[{key:"clamp",value:function(t,e,n){return t<e?e:Math.min(t,n)}},{key:"euclidean",value:function(){if(4===arguments.length&&"number"==typeof(arguments.length<=0?void 0:arguments[0])&&"number"==typeof(arguments.length<=1?void 0:arguments[1])&&"number"==typeof(arguments.length<=2?void 0:arguments[2])&&"number"==typeof(arguments.length<=3?void 0:arguments[3]))return this.__euclideanAABB.apply(this,arguments);if(3===arguments.length&&E(arguments.length<=0?void 0:arguments[0])&&"number"==typeof(arguments.length<=1?void 0:arguments[1])&&"number"==typeof(arguments.length<=2?void 0:arguments[2]))return this.__euclideanRectangleXY.apply(this,arguments);throw new Error("unable to resolve")}},{key:"__euclideanAABB",value:function(t,e,n,r){return Math.hypot(n-t,r-e)}},{key:"__euclideanRectangleXY",value:function(t,e,n){return t.contains(e,n)?-1:this.__euclideanAABB(e,n,this.clamp(e,t.getMinX(),t.getMaxX()),this.clamp(n,t.getMinY(),t.getMaxY()))}},{key:"indexOf",value:function(t,e){for(var n=0;n<t.length;++n)if(null==t[n]&&null==e||null!=e&&e===t[n])return n;return-1}},{key:"intervalsOverlap",value:function(t,e){return t[1]>=e[0]&&t[0]<=e[1]}},{key:"iterable",value:function(t){var n;return new(n=Symbol.iterator,function(){function o(){e(this,o),i(this,"callCount",0)}return r(o,[{key:n,value:function(){if(1==++this.callCount)return t;throw new Error(" can only be iterated once")}},{key:"iterator",value:function(){if(1==++this.callCount)return t;throw new Error(" can only be iterated once")}}]),o}())}},{key:"join",value:function(t){for(var e=new I,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];for(var o=0,a=r;o<a.length;o++){var s=a[o];e.length()>0&&0!==s.length&&e.append(t),e.append(s)}return e.toString()}},{key:"map",value:function(t,e,n){for(var r=0;r<t.length;++r)n[r]=e.get(t[r]);return n}},{key:"onBorderOf",value:function(t,e){return 0==t.getWidth()&&(t.getX()==e.getMinX()||t.getX()==e.getMaxX())&&t.getMinY()>=e.getMinY()&&t.getMaxY()<=e.getMaxY()||0==t.getHeight()&&(t.getY()==e.getMinY()||t.getY()==e.getMaxY())&&t.getMinX()>=e.getMinX()&&t.getMaxX()<=e.getMaxX()}},{key:"openIntervalsOverlap",value:function(t,e){return t[1]>e[0]&&t[0]<e[1]}},{key:"size",value:function(t){for(var e=0,n={done:!1,value:null};!n.done;n=t.next())e++;return e}},{key:"swap",value:function(t,e,n,r){var i=t.get(e);t.set(e,n.get(r)),n.set(r,i)}}]),t}();function P(t){return t.length}i(G,"EPS",1e-7),i(G,"Double",function(){function t(){e(this,t)}return r(t,null,[{key:"eq",value:function(t,e){return Math.abs(t-e)<=G.EPS}},{key:"neq",value:function(t,e){return!this.eq(t,e)}}]),t}()),function(t){t[t.NANOSECONDS=1]="NANOSECONDS",t[t.MICROSECONDS=1e3]="MICROSECONDS",t[t.MILLISECONDS=1e6]="MILLISECONDS",t[t.SECONDS=1e9]="SECONDS"}(x||(x={}));var B=function(t){o(i,t);var n=f(i);function i(){return e(this,i),n.apply(this,arguments)}return r(i,[{key:"getBounds2D",value:function(){return this}}]),i}(w),F=function(){function t(){e(this,t)}return r(t,null,[{key:"__distGlyphGlyph",value:function(t,e){return G.euclidean(t.getX(),t.getY(),e.getX(),e.getY())}},{key:"__distRectangleGlyph",value:function(t,e){var n=G.__euclideanRectangleXY(t,e.getX(),e.getY());return n<0?Number.NEGATIVE_INFINITY:n}},{key:"exitAt",value:function(t,e,n){return this.__intersectAtRectangleGlyph(e.getSide(n),t)}},{key:"__intersectAtGlyphGlyph",value:function(t,e){return t.hasSamePositionAs(e)?Number.NEGATIVE_INFINITY:this.__distGlyphGlyph(t,e)/(this.weight(t)+this.weight(e))}},{key:"__intersectAtRectangleGlyph",value:function(t,e){var n=this.__distRectangleGlyph(t,e);return Number.isFinite(n)?n/this.weight(e):n}},{key:"__intersectAtGlyphRectangle",value:function(t,e){return this.__intersectAtRectangleGlyph(e,t)}},{key:"radius",value:function(t,e){return Math.max(0,e)*this.weight(t)}},{key:"sizeAt",value:function(t,e){var n=this.radius(t,e);return new B(t.getX()-n,t.getY()-n,2*n,2*n)}},{key:"weight",value:function(t){return Math.sqrt(t.getN())}}]),t}(),D=function(t){o(s,t);var n=f(s);function s(){var t;return e(this,s),i(c(t=n.call(this)),"α",void 0),t.α=1,t}return r(s,[{key:"add",value:function(t){var e=t.computeAt();return t.setLowerBound(e/this.α),y(a(s.prototype),"add",this).call(this,t)}},{key:"peek",value:function(){for(;!this.isEmpty();){var t=y(a(s.prototype),"peek",this).call(this);if(t.getSmallGlyph().isAlive()){var e=t.computeAt(),n=t.getLowerBound();if(G.Double.eq(e,this.α*n))return t;y(a(s.prototype),"poll",this).call(this),t.setLowerBound(e/this.α),y(a(s.prototype),"add",this).call(this,t)}else y(a(s.prototype),"poll",this).call(this)}return null}},{key:"poll",value:function(){return null==this.peek()?null:y(a(s.prototype),"poll",this).call(this)}},{key:"updateAlpha",value:function(t){var e=F.radius(t.getGlyphs()[0],t.getAt()),n=F.radius(t.getGlyphs()[1],t.getAt());if(e<n){var r=n;n=e,e=r}this.α=(e-n)/(e+n)*this.α}}]),s}(T),z=function(){function t(n,r){e(this,t),i(this,"name",void 0),i(this,"priority",void 0),this.name=n,this.priority=r}return r(t,[{key:"toString",value:function(){return this.name+" event"}}],[{key:"values",value:function(){return this._values}}]),t}();i(z,"MERGE",new z("merge",0)),i(z,"OUT_OF_CELL",new z("out of cell",10)),i(z,"_values",[z.OUT_OF_CELL,z.MERGE]);var q,X=function(){function t(n,r){e(this,t),i(this,"at",void 0),i(this,"glyphs",void 0),this.at=n,this.glyphs=[]}return r(t,[{key:"compareTo",value:function(t){var e=Math.sign(this.at-t.at);return 0!=e?e:this.getType().priority-t.getType().priority}},{key:"getAt",value:function(){return this.at}},{key:"getSize",value:function(){return this.glyphs.length}},{key:"getGlyphs",value:function(){return this.glyphs}},{key:"toString",value:function(){var t=new I(this.getType().toString());t.append(" at "),t.append(this.at),t.append(" involving [");var e,n=!0,r=b(this.glyphs);try{for(r.s();!(e=r.n()).done;){var i=e.value;n||t.append(", "),null==i?t.append("null"):t.append(i.toString()),n=!1}}catch(t){r.e(t)}finally{r.f()}return t.append("]"),t.toString()}}]),t}(),Y=function(t){o(i,t);var n=f(i);function i(t,r,o){var a;return e(this,i),null==o&&(o=F.__intersectAtGlyphGlyph(t,r)),(a=n.call(this,o,2)).glyphs[0]=t,a.glyphs[1]=r,a}return r(i,[{key:"getOther",value:function(t){return this.glyphs[0]===t?this.glyphs[1]:this.glyphs[0]}},{key:"getType",value:function(){return z.MERGE}}]),i}(X),H=function(t){o(a,t);var n=f(a);function a(t,r,o,s){var u;return e(this,a),void 0===s&&(s=F.exitAt(t,r,o)),i(c(u=n.call(this,s,1)),"cell",void 0),i(c(u),"side",void 0),u.glyphs=[t],u.cell=r,u.side=o,u}return r(a,[{key:"getCell",value:function(){return this.cell}},{key:"getSide",value:function(){return this.side}},{key:"getType",value:function(){return z.OUT_OF_CELL}}]),a}(X),U=function(t){o(a,t);var n=f(a);function a(t){var r;return e(this,a),i(c(r=n.call(this,t.at,t.glyphs.length)),"from",void 0),i(c(r),"at",void 0),r.glyphs=Array.from(t.glyphs),r.from=t,r.at=t.at,r}return r(a,[{key:"computeAt",value:function(){for(var t=!1,e=0;e<this.glyphs.length;++e)if(this.glyphs[e].isBig()){var n=this.glyphs[e];this.glyphs[e]=this.glyphs[e].getAdoptivePrimalParent(),this.glyphs[e]!=n&&(t=!0,this.from.glyphs[e]=this.glyphs[e])}return t&&(this.at=F.__intersectAtGlyphGlyph(this.glyphs[0],this.glyphs[1])),this.at}},{key:"getAt",value:function(){return this.at}},{key:"getGlyphMerge",value:function(){return G.Double.neq(this.from.at,this.at)&&(this.from=new Y(this.from.glyphs[0],this.from.glyphs[1],this.at)),this.from}},{key:"getSmallGlyph",value:function(){return this.glyphs[0].isBig()?this.glyphs[1]:this.glyphs[0]}},{key:"getType",value:function(){return z.MERGE}},{key:"setLowerBound",value:function(t){this.lb=t}},{key:"toString",value:function(){var t=new I("uncertain ");t.append(this.getType().toString()),t.append(" at "),t.append(this.at),t.append(", lower bound "),t.append(this.lb),t.append(" involving [");var e,n=!0,r=b(this.glyphs);try{for(r.s();!(e=r.n()).done;){var i=e.value;n||t.append(", "),null==i?t.append("null"):t.append(i.toString()),n=!1}}catch(t){r.e(t)}finally{r.f()}return t.append("]"),t.toString()}}]),a}(function(){function t(n,r){e(this,t),i(this,"lb",void 0),i(this,"glyphs",void 0),this.lb=n,this.glyphs=[]}return r(t,[{key:"compareTo",value:function(t){var e=Math.sign(this.lb-t.lb);return 0!=e?e:this.getType().priority-t.getType().priority}},{key:"getLowerBound",value:function(){return this.lb}},{key:"getSize",value:function(){return this.glyphs.length}},{key:"getGlyphs",value:function(){return this.glyphs}},{key:"toString",value:function(){var t=new I("uncertain ");t.append(this.getType().toString()),t.append(" at (lower bound) "),t.append(this.lb),t.append(" involving [");var e,n=!0,r=b(this.glyphs);try{for(r.s();!(e=r.n()).done;){var i=e.value;n||t.append(", "),null==i?t.append("null"):t.append(i.toString()),n=!1}}catch(t){r.e(t)}finally{r.f()}return t.append("]"),t.toString()}}]),t}()),V=new Map,Q=function(){function t(n){e(this,t),i(this,"_name",void 0),i(this,"level",void 0),this._name=n,this.level=q.FINEST}return r(t,[{key:"isLoggable",value:function(t){var e=this.level;return!(t<e||e===q.OFF)}},{key:"log",value:function(e,n){if(e>=this.level){var r="",i=2;switch(e){case q.OFF:r="OFF";break;case q.SEVERE:r="SEVERE";break;case q.WARNING:r="WARNING";break;case q.INFO:r="INFO";break;case q.CONFIG:r="CONFIG";break;case q.FINE:r="FINE";break;case q.FINER:r="FINER",i=4;break;case q.FINEST:r="FINEST",i=6;break;case q.ALL:r="All"}r=r.padEnd(8)+"|"+"".padEnd(i),t._ps?t._ps.println(r+n):console.log(r+n)}}},{key:"getLevel",value:function(){return this.level}},{key:"setLevel",value:function(t){this.level=t}}],[{key:"getLogger",value:function(e){if(!m.LOGGING_ENABLED)return null;if(V.has(e))return V.get(e);var n=new t(e);return V.set(e,n),n}},{key:"setPrintStream",value:function(t){t.reset(),this._ps=t}}]),t}();i(Q,"_ps",void 0),function(t){t[t.OFF=Number.MAX_VALUE]="OFF",t[t.SEVERE=1e3]="SEVERE",t[t.WARNING=900]="WARNING",t[t.INFO=800]="INFO",t[t.CONFIG=700]="CONFIG",t[t.FINE=500]="FINE",t[t.FINER=400]="FINER",t[t.FINEST=300]="FINEST",t[t.ALL=Number.MIN_VALUE]="ALL"}(q||(q={}));var K=function(){function t(n,r){e(this,t),i(this,"str",void 0),i(this,"regexp",void 0),i(this,"_result",void 0),this.str=n,this.regexp=r}return r(t,[{key:"find",value:function(){return this.regexp.test(this.str)}},{key:"group",value:function(t){var e;return(null!==(e=this._result)&&void 0!==e?e:this._result=this.str.match(this.regexp))[t]}},{key:"replaceAll",value:function(t){return this.str.replace(this.regexp,t)}}]),t}(),W=function(){function t(n){e(this,t),i(this,"regexp",void 0),this.regexp=n}return r(t,[{key:"matcher",value:function(t){return new K(t,this.regexp)}}],[{key:"compile",value:function(e){return new t(e)}}]),t}(),J=function(t){o(i,t);var n=f(i);function i(){return e(this,i),n.call(this)}return r(i,[{key:"containsKey",value:function(t){return this.has(t)}},{key:"put",value:function(t,e){return this.set(t,e)}},{key:"keySet",value:function(){return S.__new(Array.from(this.keys()))}},{key:"entrySet",value:function(){return S.__new(Array.from(this.entries(),(function(t){var e=g(t,2),n=e[0],r=e[1];return new $(n,r)})))}},{key:"remove",value:function(t){return this.delete(t)}}]),i}(h(Map)),$=function(){function t(n,r){e(this,t),i(this,"key",void 0),i(this,"value",void 0),this.key=n,this.value=r}return r(t,[{key:"getKey",value:function(){return this.key}},{key:"getValue",value:function(){return this.value}}],[{key:"comparingByKey",value:function(){return function(t,e){return t.getKey()<e.getKey()?-1:t.getKey()>e.getKey()?1:0}}}]),t}(),Z=function(){function t(n){e(this,t),i(this,"n",void 0),i(this,"average",void 0),i(this,"min",void 0),i(this,"max",void 0),i(this,"sum",void 0),void 0===n?this.n=0:(this.n=1,this.average=this.min=this.max=this.sum=n)}return r(t,[{key:"getAverage",value:function(){return this.average}},{key:"getMin",value:function(){return this.min}},{key:"getMax",value:function(){return this.max}},{key:"getN",value:function(){return this.n}},{key:"getSum",value:function(){return this.sum}},{key:"log",value:function(t,e){this.min===this.max?t.log(q.FINE,"".concat(e," was ").concat(this.max.toFixed(2).padStart(13)," and did not change over ").concat(this.n," measurement").concat(1===this.n?"":"s")):t.log(q.FINE,"".concat(e," was ").concat(this.average.toFixed(2).padStart(13)," on average and always between ").concat(this.min," and ").concat(this.max," over ").concat(this.n," measurement").concat(1===this.n?"":"s"))}},{key:"logCount",value:function(t,e){t.log(q.FINE,"".concat(e," occured ").concat(1===this.n?"once":this.n+" times"))}},{key:"logPercentage",value:function(t,e){t.log(q.FINE,"".concat(e," ").concat((100*this.average).toFixed(2),"% of the time"))}},{key:"record",value:function(t){if(0===this.n)return this.n=1,void(this.average=this.min=this.max=this.sum=t);this.average+=(t-this.average)/++this.n,this.sum+=t,t>this.max&&(this.max=t),t<this.min&&(this.min=t)}},{key:"unrecord",value:function(t){if(0===this.n)throw new Error("cannot unrecord a value when no values are recorded");this.average-=(t-this.average)/--this.n,this.sum-=t,this.min=this.max=Number.NaN}}]),t}(),tt=function(){function t(){e(this,t)}return r(t,null,[{key:"comparingInt",value:function(t){return function(e,n){return t(e)-t(n)}}},{key:"comparing",value:function(t){return function(e,n){var r=t(e),i=t(n);return r<i?-1:r>i?1:0}}}]),t}(),et=function(){function t(){e(this,t)}return r(t,null,[{key:"count",value:function(t,e){void 0!==e&&this.__countStringBoolean(t,e),this.__countString(t)}},{key:"__countString",value:function(t){this.record("[count] "+t,1)}},{key:"__countStringBoolean",value:function(t,e){this.record("[perc] "+t,e?1:0)}},{key:"get",value:function(t){return this.stats.containsKey(t)||this.stats.put(t,new Z(0)),this.stats.get(t)}},{key:"log",value:function(t,e){this.stats.containsKey(t)&&this.stats.get(t).log(e,t)}},{key:"logAll",value:function(t){var e=this;t.log(q.FINE,""),t.log(q.FINE,"STATS");var n,r=this.stats.keySet().stream().filter((function(t){var n=e.TAG_REGEX.matcher(t);return!n.find()||"perc"!==n.group(1)})).map((function(t){return e.TAG_REGEX.matcher(t).replaceAll("")})).max(tt.comparingInt(P)).get().length,i=function(t){return t.padEnd(r)},o=new S,a=b(this.stats.entrySet());try{for(a.s();!(n=a.n()).done;){var s=n.value;o.add(s)}}catch(t){a.e(t)}finally{a.f()}o.sort(tt.comparing((function(t){return e.noTag(t.getKey())})));var u,l=b(o);try{for(l.s();!(u=l.n()).done;){var h=u.value,c=this.TAG_REGEX.matcher(h.getKey());if(c.find()){var p=c.group(1),f=i(c.replaceAll(""));"perc"===p?h.getValue().logPercentage(t,f):h.getValue().logCount(t,f)}else h.getValue().log(t,i(h.getKey()))}}catch(t){l.e(t)}finally{l.f()}}},{key:"record",value:function(t,e){if(this.stats.containsKey(t))this.stats.get(t).record(e);else{var n=new Z(e);this.stats.put(t,n)}}},{key:"remove",value:function(t){this.stats.remove(t)}},{key:"reset",value:function(){this.stats.clear()}},{key:"noTag",value:function(t){var e=this.TAG_REGEX.matcher(t);return e.find()?e.replaceAll("").trim():t}}]),t}();function nt(t){return t.length>0&&"number"==typeof t[0]&&"number"==typeof t[1]&&"number"==typeof t[2]}function rt(t){return t.length>0&&"number"==typeof t[0]&&"number"==typeof t[1]&&"number"==typeof t[2]&&"number"==typeof t[3]}function it(t){return void 0!==t[Symbol.iterator]&&null!==t[Symbol.iterator]}function ot(t){return it(t)&&t[0]instanceof st}function at(t){return null===t||t instanceof st}i(et,"TAG_REGEX",W.compile(/^\[([a-z]+)]\s+/)),i(et,"stats",new J);var st=function(){function t(){e(this,t),i(this,"track",void 0),i(this,"trackedBy",void 0),i(this,"x",void 0),i(this,"y",void 0),i(this,"n",void 0),i(this,"alive",void 0),i(this,"big",void 0),i(this,"cells",void 0),i(this,"uncertainMergeEvents",void 0),i(this,"adoptedBy",void 0),i(this,"mergeEvents",void 0),i(this,"outOfCellEvents",void 0);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];if(nt(r)||rt(r)){var a=r[0],s=r[1],u=r[2],l=r[3],h=void 0!==l&&l;this.__constructor(a,s,u,h)}else if(r[0]&&it(r[0])){var c=r[0];this.__constructorGlyphs(c)}else{if(!ot(r))throw new Error("failed to resolve arguments");this.__constructorGlyphsArray.apply(this,r)}}return r(t,[{key:"__constructor",value:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(n<1)throw new Error("n must be at least 1");this.track=!1,m.TRACK&&!m.ROBUST?this.trackedBy=new S:this.trackedBy=null,this.x=t,this.y=e,this.n=n,this.alive=r?1:0,this.big=!1,this.cells=new S,this.uncertainMergeEvents=null,this.adoptedBy=null,this.mergeEvents=new T(m.MAX_MERGES_TO_RECORD),this.outOfCellEvents=new T}},{key:"__constructorGlyphs",value:function(t){this.__constructor(0,0,1),this.n=0;var e,n=b(t);try{for(n.s();!(e=n.n()).done;){var r=e.value;this.x+=r.x*r.n,this.y+=r.y*r.n,this.n+=r.n,this.track=this.track||r.track}}catch(t){n.e(t)}finally{n.f()}this.x/=this.n,this.y/=this.n}},{key:"__constructorGlyphsArray",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this.__constructorGlyphs(e)}},{key:"addCell",value:function(t){this.cells.contains(t)||this.cells.add(t)}},{key:"adoptUncertainMergeEvents",value:function(t,e){if(!this.isBig()||!t.isBig())throw new Error("both this glyph and bigGlyph must be big");if(this.uncertainMergeEvents.size()>0)throw new Error("can only adopt when it has no events yet");var n=this.uncertainMergeEvents;this.uncertainMergeEvents=t.uncertainMergeEvents,this.uncertainMergeEvents.updateAlpha(e),t.uncertainMergeEvents=n,t.adoptedBy=this}},{key:"getAdoptivePrimalParent",value:function(){return null===this.adoptedBy?this:this.adoptedBy.getAdoptivePrimalParent()}},{key:"getCells",value:function(){return this.cells}},{key:"getN",value:function(){return this.n}},{key:"getX",value:function(){return this.x}},{key:"getY",value:function(){return this.y}},{key:"hashCode",value:function(){return"".concat(this.x,":").concat(this.y)}},{key:"hasSamePositionAs",value:function(t){return G.Double.eq(this.x,t.x)&&G.Double.eq(this.y,t.y)}},{key:"isAlive",value:function(){return 1===this.alive}},{key:"isBig",value:function(){return this.big}},{key:"equals",value:function(t){return this===t}},{key:"participate",value:function(){if(1==this.alive)throw new Error("having a participating glyph participate");if(2==this.alive)throw new Error("cannot bring a perished glyph back to life");this.alive=1}},{key:"peekUncertain",value:function(){return this.uncertainMergeEvents.peek()}},{key:"perish",value:function(){this.alive=2}},{key:"pollUncertain",value:function(){return this.uncertainMergeEvents.poll()}},{key:"popMergeInto",value:function(t,e){if(this.big)throw new Error("big glyphs don't pop merge events into the shared queue");for(;!this.mergeEvents.isEmpty();){var n=this.mergeEvents.poll(),r=n.getOther(this);if(r.isAlive()&&!r.isBig())return t.add(n),m.TRACK&&!m.ROBUST&&(r.trackedBy.contains(this)||r.trackedBy.add(this)),null!==e&&e.log(q.FINEST,"→ merge at ".concat(n.getAt().toFixed(3)," with ").concat(r)),!0}return!1}},{key:"popOutOfCellInto",value:function(t,e){if(this.big)throw new Error("big glyphs don't pop out of cell events into the shared queue");for(var n=!1;!this.outOfCellEvents.isEmpty();){var r=this.outOfCellEvents.poll();if(null!==e&&e.log(q.FINEST,"popping ".concat(r," into the queue")),t.add(r),n=!0,!m.ROBUST)return!0}return!(!m.ROBUST||!n)||(null!=e&&e.log(q.FINEST,"no out of cell event to pop"),!1)}},{key:"record",value:function(t){if(t instanceof Y)return this.__recordG(t);if(t instanceof U)return this.__recordU(t);if(t instanceof H)return this.__recordO(t);throw new Error("unresolved choice")}},{key:"__recordG",value:function(t){this.mergeEvents.add(t)}},{key:"__recordU",value:function(t){this.uncertainMergeEvents.add(t)}},{key:"__recordO",value:function(t){this.outOfCellEvents.add(t)}},{key:"removeCell",value:function(t){this.cells.remove(t)}},{key:"setBig",value:function(t){m.BIG_GLYPHS&&(this.big=this.n>t.getAverage()*m.BIG_GLYPH_FACTOR,et.count("glyph was big when it participated",this.big),this.big&&(this.uncertainMergeEvents=new D))}},{key:"setN",value:function(t){this.n=t}},{key:"toString",value:function(){return"glyph [x = ".concat(this.x.toFixed(2),", y = ").concat(this.y.toFixed(2),", n = ").concat(this.n,"]")}}],[{key:"__isAlive",value:function(t){return t.isAlive()}}]),t}();function ut(t){return"number"==typeof t}function lt(t){return null===t||t instanceof ct}function ht(t){return t.length>2&&E(t[0])&&ut(t[1])&&ut(t[2])}var ct=function(){function t(n,r,o,a){e(this,t),i(this,"_quadrants",void 0),i(this,"_others",void 0),i(this,"_id",void 0),i(this,"_name",void 0),this._name=n,this._id=a,this._others=null,this._quadrants=[r,o]}return r(t,[{key:"toString",value:function(){return this._name}},{key:"opposite",value:function(){return t.values()[(this.ordinal()+2)%4]}},{key:"others",value:function(){if(null===this._others){this._others=[null,null,null];var e,n=0,r=b(t.values());try{for(r.s();!(e=r.n()).done;){var i=e.value;i!==this&&(this._others[n++]=i)}}catch(t){r.e(t)}finally{r.f()}}return this._others}},{key:"quadrants",value:function(){return this._quadrants}},{key:"ordinal",value:function(){return this._id}}],[{key:"interval",value:function(e,n){return n==t.TOP||n==t.BOTTOM?[e.getMinX(),e.getMaxX()]:[e.getMinY(),e.getMaxY()]}},{key:"quadrant",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];if(e.length>0){if(ut(e[0]))return this.__quadrantIdx(e[0]);if(ht(e))return this.__quadrantRXY.apply(this,e)}throw new Error("failed to resolve choice")}},{key:"__quadrantIdx",value:function(t){if(t<0||t>3)throw new Error("illegal argument");var e,n=[null,null],r=0,i=b(this.values());try{for(i.s();!(e=i.n()).done;){var o=e.value;o._quadrants[0]!=t&&o._quadrants[1]!=t||(n[r++]=o)}}catch(t){i.e(t)}finally{i.f()}return n}},{key:"__quadrantRXY",value:function(t,e,n){return(n<t.getCenterY()?0:2)+(e<t.getCenterX()?0:1)}},{key:"quadrantNeighbor",value:function(e,n){switch(e){case 0:return n.ordinal();case 1:return(e+n.ordinal())%4;case 2:return n==t.TOP?0:3;case 3:return n==t.TOP?1:2;default:return-1}}},{key:"values",value:function(){return this._values}}]),t}();i(ct,"TOP",new ct("TOP",0,1,0)),i(ct,"RIGHT",new ct("RIGHT",1,3,1)),i(ct,"BOTTOM",new ct("BOTTOM",2,3,2)),i(ct,"LEFT",new ct("LEFT",0,2,3)),i(ct,"_values",[ct.TOP,ct.RIGHT,ct.BOTTOM,ct.LEFT]);var pt=function(){function t(){e(this,t)}return r(t,null,[{key:"asList",value:function(t){return t}},{key:"stream",value:function(t,e,n){return new j(t.slice(e,n))}},{key:"nCopies",value:function(t,e){return Array.from({length:t},(function(){return e}))}},{key:"rotate",value:function(t,e){return e-=t.__internal.length*Math.floor(e/t.__internal.length),t.__internal.push.apply(t.__internal,t.__internal.splice(0,e)),t}}]),t}();Function.noop=function(){},Function.identity=function(t){return t},Function.by=function(t,e){e=e||Object.compare,t=t||Function.identity;var n=function(n,r){return e(t(n),t(r))};return n.compare=e,n.by=t,n},Function.get=function(t){return function(e){return Object.get(e,t)}};var ft="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function yt(t){var e={exports:{}};return t(e,e.exports),e.exports}var gt=dt;function dt(){throw new Error("Can't construct. GenericCollection is a mixin.")}var vt=ft.DOMTokenList||function(){};dt.EmptyArray=Object.freeze([]),dt.prototype.addEach=function(t,e,n){if(t&&(t instanceof Array||t instanceof vt||t instanceof String))if(e)for(var r=0;r<t.length;r++)this.add(e.call(n,t[r]),r);else for(r=0;r<t.length;r++)this.add(t[r],r);else if(t&&Object(t)===t)if("function"==typeof t.forEach)e?t.map(e,n).forEach(this.add,this):t.forEach(this.add,this);else if("function"==typeof t.next){var i;r=0;if(e)for(;i=t.next().value;)this.add(e.call(n,i),r++);else for(;i=t.next().value;)this.add(i,r++)}else if("number"==typeof t.length)if(e)for(r=0;r<t.length;r++)this.add(e.call(n,t[r]),r);else for(r=0;r<t.length;r++)this.add(t[r],r);else e?Object.keys(t).forEach((function(r){this.add(e.call(n,t[r]),r)}),this):Object.keys(t).forEach((function(e){this.add(t[e],e)}),this);return this},dt.prototype.deleteEach=function(t,e){return t.forEach((function(t){this.delete(t,e)}),this),this},dt.prototype.forEach=function(t){var e=arguments[1];return this.reduce((function(n,r,i,o,a){t.call(e,r,i,o,a)}),void 0)},dt.prototype.map=function(t){var e=arguments[1],n=[];return this.reduce((function(r,i,o,a,s){n.push(t.call(e,i,o,a,s))}),void 0),n},dt.prototype.enumerate=function(t){null==t&&(t=0);var e=[];return this.reduce((function(n,r){e.push([t++,r])}),void 0),e},dt.prototype.group=function(t,e,n){n=n||Object.equals;var r=[],i=[];return this.forEach((function(o,a,s){a=t.call(e,o,a,s);var u,l=i.indexOf(a,n);-1===l?(u=[],r.push([a,u]),i.push(a)):u=r[l][1],u.push(o)})),r},dt.prototype.toArray=function(){return this.map(Function.identity)},dt.prototype.toObject=function(){var t={};return this.reduce((function(e,n,r){t[r]=n}),void 0),t},dt.from=function(){return this.apply(this,arguments)},dt.prototype.filter=function(t){var e=arguments[1],n=this.constructClone();return this.reduce((function(r,i,o,a,s){t.call(e,i,o,a,s)&&n.add(i,o)}),void 0),n},dt.prototype.every=function(t){var e=arguments[1];return this.reduce((function(n,r,i,o,a){return n&&t.call(e,r,i,o,a)}),!0)},dt.prototype.some=function(t){var e=arguments[1];return this.reduce((function(n,r,i,o,a){return n||t.call(e,r,i,o,a)}),!1)},dt.prototype.all=function(){return this.every(Boolean)},dt.prototype.any=function(){return this.some(Boolean)},dt.prototype.min=function(t){t=t||this.contentCompare||Object.compare;var e=!0;return this.reduce((function(n,r){return e?(e=!1,r):t(r,n)<0?r:n}),void 0)},dt.prototype.max=function(t){t=t||this.contentCompare||Object.compare;var e=!0;return this.reduce((function(n,r){return e?(e=!1,r):t(r,n)>0?r:n}),void 0)},dt.prototype.sum=function(t){return t=void 0===t?0:t,this.reduce((function(t,e){return t+e}),t)},dt.prototype.average=function(t){var e=void 0===t?0:t,n=void 0===t?0:t;return this.reduce((function(t,r){e+=r,n+=1}),void 0),e/n},dt.prototype.concat=function(){for(var t=this.constructClone(this),e=0;e<arguments.length;e++)t.addEach(arguments[e]);return t},dt.prototype.flatten=function(){var t=this;return this.reduce((function(e,n){return n.forEach((function(t){this.push(t)}),e,t),e}),[])},dt.prototype.zip=function(){var t=Array.prototype.slice.call(arguments);return t.unshift(this),Array.unzip(t)},dt.prototype.join=function(t){return this.reduce((function(e,n){return void 0===e?n:e+t+n}),void 0)},dt.prototype.sorted=function(t,e,n){return(t=t||this.contentCompare||Object.compare).by?(e=t.by,t=t.compare||this.contentCompare||Object.compare):e=e||Function.identity,void 0===n&&(n=1),this.map((function(t){return{by:e(t),value:t}})).sort((function(e,r){return t(e.by,r.by)*n})).map((function(t){return t.value}))},dt.prototype.reversed=function(){return this.constructClone(this).reverse()},dt.prototype.clone=function(t,e){if(void 0===t)t=1/0;else if(0===t)return this;var n=this.constructClone();return this.forEach((function(r,i){n.add(Object.clone(r,t-1,e),i)}),this),n},dt.prototype.only=function(){if(1===this.length)return this.one()},dt.prototype.iterator=function(){return this.iterate.apply(this,arguments)},dt._sizePropertyDescriptor={get:function(){return this.length},enumerable:!1,configurable:!0},Object.defineProperty(dt.prototype,"size",dt._sizePropertyDescriptor);var _t=yt((function(t){!function(){if("undefined"==typeof ses||!ses.ok||ses.ok()){"undefined"!=typeof ses&&(ses.weakMapPermitHostObjects=d);var e=!1;if("function"==typeof WeakMap){var n=WeakMap;if("undefined"!=typeof navigator&&/Firefox/.test(navigator.userAgent));else{var r=new n,i=Object.freeze({});if(r.set(i,1),1===r.get(i))return void(t.exports=WeakMap);e=!0}}var o=Object.getOwnPropertyNames,a=Object.defineProperty,s=Object.isExtensible,u="weakmap:",l="weakmap:ident:"+Math.random()+"___";if("undefined"!=typeof crypto&&"function"==typeof crypto.getRandomValues&&"function"==typeof ArrayBuffer&&"function"==typeof Uint8Array){var h=new ArrayBuffer(25),c=new Uint8Array(h);crypto.getRandomValues(c),l="weakmap:rand:"+Array.prototype.map.call(c,(function(t){return(t%36).toString(36)})).join("")+"___"}if(a(Object,"getOwnPropertyNames",{value:function(t){return o(t).filter(v)}}),"getPropertyNames"in Object){var p=Object.getPropertyNames;a(Object,"getPropertyNames",{value:function(t){return p(t).filter(v)}})}!function(){var t=Object.freeze;a(Object,"freeze",{value:function(e){return _(e),t(e)}});var e=Object.seal;a(Object,"seal",{value:function(t){return _(t),e(t)}});var n=Object.preventExtensions;a(Object,"preventExtensions",{value:function(t){return _(t),n(t)}})}();var f=!1,y=0,g=function(){this instanceof g||m();var t=[],e=[],n=y++;return Object.create(g.prototype,{get___:{value:b((function(r,i){var o,a=_(r);return a?n in a?a[n]:i:(o=t.indexOf(r))>=0?e[o]:i}))},has___:{value:b((function(e){var r=_(e);return r?n in r:t.indexOf(e)>=0}))},set___:{value:b((function(r,i){var o,a=_(r);return a?a[n]=i:(o=t.indexOf(r))>=0?e[o]=i:(o=t.length,e[o]=i,t[o]=r),this}))},delete___:{value:b((function(r){var i,o,a=_(r);return a?n in a&&delete a[n]:!((i=t.indexOf(r))<0)&&(o=t.length-1,t[i]=void 0,e[i]=e[o],t[i]=t[o],t.length=o,e.length=o,!0)}))}})};g.prototype=Object.create(Object.prototype,{get:{value:function(t,e){return this.get___(t,e)},writable:!0,configurable:!0},has:{value:function(t){return this.has___(t)},writable:!0,configurable:!0},set:{value:function(t,e){return this.set___(t,e)},writable:!0,configurable:!0},delete:{value:function(t){return this.delete___(t)},writable:!0,configurable:!0}}),"function"==typeof n?function(){function r(){this instanceof g||m();var t,r=new n,i=void 0,o=!1;return t=e?function(t,e){return r.set(t,e),r.has(t)||(i||(i=new g),i.set(t,e)),this}:function(t,e){if(o)try{r.set(t,e)}catch(n){i||(i=new g),i.set___(t,e)}else r.set(t,e);return this},Object.create(g.prototype,{get___:{value:b((function(t,e){return i?r.has(t)?r.get(t):i.get___(t,e):r.get(t,e)}))},has___:{value:b((function(t){return r.has(t)||!!i&&i.has___(t)}))},set___:{value:b(t)},delete___:{value:b((function(t){var e=!!r.delete(t);return i&&i.delete___(t)||e}))},permitHostObjects___:{value:b((function(t){if(t!==d)throw new Error("bogus call to permitHostObjects___");o=!0}))}})}e&&"undefined"!=typeof Proxy&&(Proxy=void 0),r.prototype=g.prototype,t.exports=r,Object.defineProperty(WeakMap.prototype,"constructor",{value:WeakMap,enumerable:!1,configurable:!0,writable:!0})}():("undefined"!=typeof Proxy&&(Proxy=void 0),t.exports=g)}function d(t){t.permitHostObjects___&&t.permitHostObjects___(d)}function v(t){return!(t.substr(0,u.length)==u&&"___"===t.substr(t.length-3))}function _(t){if(t!==Object(t))throw new TypeError("Not an object: "+t);var e=t[l];if(e&&e.key===t)return e;if(s(t)){e={key:t};try{return a(t,l,{value:e,writable:!1,enumerable:!1,configurable:!1}),e}catch(t){return}}}function b(t){return t.prototype=null,Object.freeze(t)}function m(){f||"undefined"==typeof console||(f=!0,console.warn("WeakMap should be invoked as new WeakMap(), not WeakMap(). This will be an error in the future."))}}()})),bt="undefined"!=typeof WeakMap?WeakMap:_t,mt=Object;Object.empty=Object.freeze(Object.create(null)),Object.isObject=function(t){return Object(t)===t},Object.getValueOf=function(t){return t&&"function"==typeof t.valueOf&&(t=t.valueOf()),t};var Et=new bt;Object.hash=function(t){return t&&"function"==typeof t.hash?""+t.hash():Object(t)===t?(Et.has(t)||Et.set(t,Math.random().toString(36).slice(2)),Et.get(t)):""+t};var Ot=Object.prototype.hasOwnProperty;Object.owns=function(t,e){return Ot.call(t,e)},Object.has=function(t,e){if("object"!=typeof t)throw new Error("Object.has can't accept non-object: "+typeof t);if(t&&"function"==typeof t.has)return t.has(e);if("string"==typeof e)return e in t&&t[e]!==Object.prototype[e];throw new Error("Key must be a string for Object.has on plain objects")},Object.get=function(t,e,n){if("object"!=typeof t)throw new Error("Object.get can't accept non-object: "+typeof t);return t&&"function"==typeof t.get?t.get(e,n):Object.has(t,e)?t[e]:n},Object.set=function(t,e,n){t&&"function"==typeof t.set?t.set(e,n):t[e]=n},Object.addEach=function(t,e,n){var r=3!==arguments.length||n;if(e)if("function"!=typeof e.forEach||e.hasOwnProperty("forEach"))if("number"==typeof e.length)for(var i=0;i<e.length;i++)t[i]=e[i];else for(var o,a=Object.keys(e),s=0;o=a[s];s++)!r&&Object.owns(t,o)||(t[o]=e[o]);else!0===e.isMap?e.forEach((function(e,n){t[n]=e})):e.forEach((function(e){t[e[0]]=e[1]}));else;return t},Object.defineEach=function(t,e,n,r,i,o){var a=3!==arguments.length||n;if(e)if("function"!=typeof e.forEach||e.hasOwnProperty("forEach"))if("number"==typeof e.length)for(var s=0;s<e.length;s++)Object.defineProperty(t,s,{value:e[s],writable:o,configurable:r,enumerable:i});else for(var u,l=Object.keys(e),h=0;u=l[h];h++)!a&&Object.owns(t,u)||Object.defineProperty(t,u,{value:e[u],writable:o,configurable:r,enumerable:i});else!0===e.isMap?e.forEach((function(e,n){Object.defineProperty(t,n,{value:e,writable:o,configurable:r,enumerable:i})})):e.forEach((function(e){Object.defineProperty(t,e[0],{value:e[1],writable:o,configurable:r,enumerable:i})}));else;return t},Object.forEach=function(t,e,n){for(var r,i=Object.keys(t),o=0;r=i[o];o++)e.call(n,t[r],r,t)},Object.map=function(t,e,n){for(var r,i=Object.keys(t),o=0,a=[];r=i[o];o++)a.push(e.call(n,t[r],r,t));return a},Object.values=function(t){return Object.map(t,Function.identity)},Object.concat=function(){for(var t={},e=0;e<arguments.length;e++)Object.addEach(t,arguments[e]);return t},Object.from=Object.concat,Object.is=function(t,e){return t===e?0!==t||1/t==1/e:t!=t&&e!=e},Object.equals=function(t,e,n,r){if(n=n||Object.equals,(t=Object.getValueOf(t))===(e=Object.getValueOf(e)))return!0;if(Object.isObject(t)){if((r=r||new bt).has(t))return!0;r.set(t,!0)}if(Object.isObject(t)&&"function"==typeof t.equals)return t.equals(e,n,r);if(Object.isObject(e)&&"function"==typeof e.equals)return e.equals(t,n,r);if(Object.isObject(t)&&Object.isObject(e)&&Object.getPrototypeOf(t)===Object.prototype&&Object.getPrototypeOf(e)===Object.prototype){for(var i in t)if(!n(t[i],e[i],n,r))return!1;for(var i in e)if(!(i in t)||!n(e[i],t[i],n,r))return!1;return!0}return t!=t&&e!=e||(!t||!e)&&t===e},Object.compare=function(t,e){if((t=Object.getValueOf(t))===(e=Object.getValueOf(e)))return 0;var n=typeof t,r=typeof e;return"number"===n&&"number"===r?t-e:"string"===n&&"string"===r?t<e?-1/0:1/0:t&&"function"==typeof t.compare?t.compare(e):e&&"function"==typeof e.compare?-e.compare(t):0},Object.clone=function(t,e,n){if(t=Object.getValueOf(t),n=n||new bt,void 0===e)e=1/0;else if(0===e)return t;if(Object.isObject(t)){if(!n.has(t))if(t&&"function"==typeof t.clone)n.set(t,t.clone(e,n));else{var r=Object.getPrototypeOf(t);if(null!==r&&r!==Object.prototype)throw new Error("Can't clone "+t);var i=Object.create(r);for(var o in n.set(t,i),t)i[o]=Object.clone(t[o],e-1,n)}return n.get(t)}return t},Object.clear=function(t){if(t&&"function"==typeof t.clear)t.clear();else for(var e=Object.keys(t),n=e.length;n;)delete t[e[--n]];return t};var wt=kt;function kt(){throw new Error("Can't construct. GenericOrder is a mixin.")}kt.prototype.equals=function(t,e){return e=e||this.contentEquals||mt.equals,this===t||!!t&&(this.length===t.length&&this.zip(t).every((function(t){return e(t[0],t[1])})))},kt.prototype.compare=function(t,e){if(e=e||this.contentCompare||mt.compare,this===t)return 0;if(!t)return 1;var n=Math.min(this.length,t.length),r=this.zip(t).reduce((function(t,r,i){return 0===t?i>=n?t:e(r[0],r[1]):t}),0);return 0===r?this.length-t.length:r},kt.prototype.toJSON=function(){return this.toArray()};var At=Array.prototype.splice,Ct=Array.prototype.slice;Array.empty=[],Object.freeze&&Object.freeze(Array.empty),Array.nativeFrom=Array.from;var St="undefined"!=typeof Symbol;function Rt(t,e){Object.defineProperty(Array.prototype,t,{value:e,writable:!0,configurable:!0,enumerable:!1})}Array.from=function(t,e,n){if(St&&t&&("function"==typeof t[Symbol.iterator]||"function"==typeof e))return Array.nativeFrom(t,e,n);var r=[];return r.addEach(t),r},Array.unzip=function(t){for(var e=[],n=1/0,r=0;r<t.length;r++){var i=t[r];t[r]=i.toArray(),i.length<n&&(n=i.length)}for(r=0;r<t.length;r++){i=t[r];for(var o=0;o<i.length;o++)o<n&&o in i&&(e[o]=e[o]||[],e[o][r]=i[o])}return e},Rt("addEach",gt.prototype.addEach),Rt("deleteEach",gt.prototype.deleteEach),Rt("toArray",gt.prototype.toArray),Rt("toObject",gt.prototype.toObject),Rt("all",gt.prototype.all),Rt("any",gt.prototype.any),Rt("min",gt.prototype.min),Rt("max",gt.prototype.max),Rt("sum",gt.prototype.sum),Rt("average",gt.prototype.average),Rt("only",gt.prototype.only),Rt("flatten",gt.prototype.flatten),Rt("zip",gt.prototype.zip),Rt("enumerate",gt.prototype.enumerate),Rt("group",gt.prototype.group),Rt("sorted",gt.prototype.sorted),Rt("reversed",gt.prototype.reversed),Rt("constructClone",(function(t){var e=new this.constructor;return e.addEach(t),e})),Rt("has",(function(t,e){return-1!==this.findValue(t,e)})),Rt("get",(function(t,e){if(+t!==t)throw new Error("Indicies must be numbers");return!t in this?e:this[t]})),Rt("set",(function(t,e){return this[t]=e,!0})),Rt("add",(function(t){return this.push(t),!0})),Rt("delete",(function(t,e){var n=this.findValue(t,e);return-1!==n&&(this.spliceOne(n),!0)})),Rt("deleteAll",(function(t,e){e=e||this.contentEquals||Object.equals;for(var n=0,r=0;r<this.length;)e(t,this[r])?(this.swap(r,1),n++):r++;return n})),Array.prototype.find||Rt("find",(function(t){if(null==this)throw new TypeError('"this" is null or not defined');var e=Object(this),n=e.length>>>0;if("function"!=typeof t)throw new TypeError("predicate must be a function");for(var r=arguments[1],i=0;i<n;){var o=e[i];if(t.call(r,o,i,e))return o;i++}}));var jt={};function Lt(t,e){"undefined"!=typeof console&&"function"==typeof console.warn&&!0!==e&&!1===jt.hasOwnProperty(t)&&(console.warn(t),jt[t]++)}var Mt=Object.getOwnPropertyDescriptor(Array.prototype,"find").value;function Nt(t,e,n){this.array=t,this.start=null==e?0:e,this.end=n}if(Rt("find",(function(t,e,n){return"function"==typeof arguments[0]&&this instanceof Array?Mt.apply(this,arguments):(Lt("Array#find usage is deprecated please use Array#findValue"),this.findValue.apply(this,arguments))})),Rt("findValue",(function(t,e,n){if(n)throw new Error("Array#findValue does not support third argument: index");e=e||this.contentEquals||Object.equals;for(n=0;n<this.length;n++)if(n in this&&e(t,this[n]))return n;return-1})),Rt("findLast",(function(t,e){return Lt("Array#findLast function is deprecated please use Array#findLastValue instead."),this.findLastValue.apply(this,arguments)})),Rt("findLastValue",(function(t,e){e=e||this.contentEquals||Object.equals;var n=this.length;do{if(--n in this&&e(this[n],t))return n}while(n>0);return-1})),Rt("swap",(function(t,e,n){var r,i,o,a,s;if(t>this.length&&(this.length=t),void 0!==n){if(r=[t,e],Array.isArray(n)||(n=Ct.call(n)),o=0,(i=n.length)<1e3){for(;o<i;o++)r[o+2]=n[o];return At.apply(this,r)}for(s=At.apply(this,r);o<i;){for(r=[t+o,0],a=2;a<1002&&o<i;a++,o++)r[a]=n[o];At.apply(this,r)}return s}return void 0!==e?At.call(this,t,e):void 0!==t?At.call(this,t):[]})),Rt("peek",(function(){return this[0]})),Rt("poke",(function(t){this.length>0&&(this[0]=t)})),Rt("peekBack",(function(){if(this.length>0)return this[this.length-1]})),Rt("pokeBack",(function(t){this.length>0&&(this[this.length-1]=t)})),Rt("one",(function(){for(var t in this)if(Object.owns(this,t))return this[t]})),Array.prototype.clear||Rt("clear",(function(){return this.length=0,this})),Rt("compare",(function(t,e){var n,r,i;if(e=e||Object.compare,this===t)return 0;if(!t||!Array.isArray(t))return wt.prototype.compare.call(this,t,e);for(r=this.length<t.length?this.length:t.length,n=0;n<r;n++)if(n in this){if(!(n in t))return-1;if(i=e(this[n],t[n]))return i}else if(n in t)return 1;return this.length-t.length})),Rt("equals",(function(t,e){e=e||Object.equals;var n=0,r=this.length;if(this===t)return!0;if(!t||!Array.isArray(t))return wt.prototype.equals.call(this,t);if(r!==t.length)return!1;for(;n<r;++n)if(n in this){if(!(n in t))return!1;if(!e(this[n],t[n]))return!1}else if(n in t)return!1;return!0})),Rt("clone",(function(t,e){if(null==t)t=1/0;else if(0===t)return this;if((e=e||new bt).has(this))return e.get(this);var n=new Array(this.length);for(var r in e.set(this,n),this)n[r]=Object.clone(this[r],t-1,e);return n})),Rt("iterate",(function(t,e){return new Nt(this,t,e)})),void 0===Array.prototype.spliceOne&&Rt("spliceOne",(function(t,e){var n=this.length;if(n)if(1===arguments.length){for(;t<n;)this[t]=this[t+1],t++;this.length--}else this[t]=e})),Rt("Iterator",Nt),Nt.prototype.__iterationObject=null,Object.defineProperty(Nt.prototype,"_iterationObject",{get:function(){return this.__iterationObject||(this.__iterationObject={done:!1,value:null})}}),Nt.prototype.next=function(){return this.start===(null==this.end?this.array.length:this.end)?(this._iterationObject.done=!0,this._iterationObject.value=void 0):this._iterationObject.value=this.array[this.start++],this._iterationObject},!RegExp.escape){var xt=/[-[\]{}()*+?.\\^$|,#\s]/g;RegExp.escape=function(t){return t.replace(xt,"\\$&")}}var Tt=It;function It(t,e,n){return It._init(It,this,t,e,n)}function Gt(t){this.head=t,this.at=t.next}function Pt(t){this.value=t,this.prev=null,this.next=null}It._init=function(t,e,n,r,i){if(!(e instanceof t))return new t(n,r,i);var o=e.head=new e.Node;o.next=o,o.prev=o,e.contentEquals=r||Object.equals,e.getDefault=i||Function.noop,e.length=0,e.addEach(n)},It.List=It,Object.addEach(It.prototype,gt.prototype),Object.addEach(It.prototype,wt.prototype),It.from=gt.from,It.prototype.constructClone=function(t){return new this.constructor(t,this.contentEquals,this.getDefault)},It.prototype.find=function(t,e,n){e=e||this.contentEquals;for(var r=this.head,i=this.scan(n,r.next);i!==r;){if(e(i.value,t))return i;i=i.next}},It.prototype.findLast=function(t,e,n){e=e||this.contentEquals;for(var r=this.head,i=this.scan(n,r.prev);i!==r;){if(e(i.value,t))return i;i=i.prev}},It.prototype.has=function(t,e){return!!this.find(t,e)},It.prototype.get=function(t,e){var n=this.find(t,e);return n?n.value:this.getDefault(t)},It.prototype.delete=function(t,e){var n=this.findLast(t,e);return!!n&&(n.delete(),this.length--,!0)},It.prototype.deleteAll=function(t,e){e=e||this.contentEquals;for(var n=this.head,r=n.next,i=0;r!==n;)e(t,r.value)&&(r.delete(),i++),r=r.next;return this.length-=i,i},It.prototype.clear=function(){this.head.next=this.head.prev=this.head,this.length=0},It.prototype.add=function(t){var e=new this.Node(t);return this._addNode(e)},It.prototype._addNode=function(t){return this.head.addBefore(t),this.length++,!0},It.prototype.push=function(){for(var t=this.head,e=0;e<arguments.length;e++){var n=arguments[e],r=new this.Node(n);t.addBefore(r)}this.length+=arguments.length},It.prototype.unshift=function(){for(var t=this.head,e=0;e<arguments.length;e++){var n=arguments[e],r=new this.Node(n);t.addAfter(r),t=r}this.length+=arguments.length},It.prototype._shouldPop=function(){var t,e=this.head;return e.prev!==e&&(t=e.prev.value),t},It.prototype.pop=function(t,e){var n,r=this.head;if(r.prev!==r){n=r.prev.value;var i=this.length-1,o=t?t.call(this,n,i):void 0;r.prev.delete(),this.length--,e&&e.call(this,n,i,o)}return n},It.prototype.shift=function(t,e){var n,r=this.head;if(r.prev!==r){n=r.next.value;var i=t?t.call(this,n,0):void 0;r.next.delete(),this.length--,e&&e.call(this,n,0,i)}return n},It.prototype.peek=function(){if(this.head!==this.head.next)return this.head.next.value},It.prototype.poke=function(t){this.head!==this.head.next?this.head.next.value=t:this.push(t)},It.prototype.one=function(){return this.peek()},It.prototype.scan=function(t,e){var n=this.head;if("number"==typeof t){var r=t;if(r>=0)for(t=n.next;r&&(r--,(t=t.next)!=n););else for(t=n;r<0&&(r++,(t=t.prev)!=n););return t}return t||e},It.prototype.slice=function(t,e){var n=[],r=this.head;for(t=this.scan(t,r.next),e=this.scan(e,r);t!==e&&t!==r;)n.push(t.value),t=t.next;return n},It.prototype.splice=function(t,e){return this.swap(t,e,Array.prototype.slice.call(arguments,2))},It.prototype.swap=function(t,e,n,r,i){var o=t;t=this.scan(t,this.head),null==e&&(e=1/0),n=Array.from(n);for(var a=[],s=t;e--&&e>=0&&s!==this.head;)a.push(s.value),s=s.next;r&&r.call(this,t,n,a);s=t;var u=0;for(s=t;u<a.length;u++,s=s.next)s.delete();null==o&&s===this.head&&(s=this.head.next);for(u=0;u<n.length;u++){var l=new this.Node(n[u]);s.addBefore(l)}return this.length+=n.length-a.length,i&&i.call(this,t,n,a),a},It.prototype.reverse=function(){var t=this.head;do{var e=t.next;t.next=t.prev,t.prev=e,t=t.next}while(t!==this.head);return this},It.prototype.sort=function(){this.swap(0,this.length,this.sorted.apply(this,arguments))},It.prototype.reduce=function(t,e){for(var n=arguments[2],r=this.head,i=r.next;i!==r;)e=t.call(n,e,i.value,i,this),i=i.next;return e},It.prototype.reduceRight=function(t,e){for(var n=arguments[2],r=this.head,i=r.prev;i!==r;)e=t.call(n,e,i.value,i,this),i=i.prev;return e},It.prototype.updateIndexes=function(t,e){for(;t!==this.head;)t.index=e++,t=t.next},It.prototype.iterate=function(){return new Gt(this.head)},Gt.prototype.__iterationObject=null,Object.defineProperty(Gt.prototype,"_iterationObject",{get:function(){return this.__iterationObject||(this.__iterationObject={done:!1,value:null})}}),Gt.prototype.next=function(){if(this.at===this.head)this._iterationObject.done=!0,this._iterationObject.value=void 0;else{var t=this.at.value;this.at=this.at.next,this._iterationObject.value=t}return this._iterationObject},It.prototype.Node=Pt,Pt.prototype.delete=function(){this.prev.next=this.next,this.next.prev=this.prev},Pt.prototype.addBefore=function(t){var e=this.prev;this.prev=t,t.prev=e,e.next=t,t.next=this},Pt.prototype.addAfter=function(t){var e=this.next;this.next=t,t.next=e,e.prev=t,t.prev=this};var Bt=Ft;function Ft(){throw new Error("Can't construct. GenericSet is a mixin.")}Ft.prototype.isSet=!0,Ft.prototype.union=function(t){var e=this.constructClone(this);return e.addEach(t),e},Ft.prototype.intersection=function(t){return this.constructClone(this.filter((function(e){return t.has(e)})))},Ft.prototype.difference=function(t){var e=this.constructClone(this);return e.deleteEach(t),e},Ft.prototype.symmetricDifference=function(t){var e=this.union(t),n=this.intersection(t);return e.difference(n)},Ft.prototype.deleteAll=function(t){return+this.delete(t)},Ft.prototype.equals=function(t,e){var n=this;return t&&"function"==typeof t.reduce&&this.length===t.length&&t.reduce((function(t,r){return t&&n.has(r,e)}),!0)},Ft.prototype.forEach=function(t){var e=arguments[1];return this.reduce((function(n,r,i,o,a){t.call(e,r,r,o,a)}),void 0)},Ft.prototype.toJSON=function(){return this.toArray()},Ft.prototype.contains=function(t){return this.has(t)},Ft.prototype.remove=function(t){return this.delete(t)},Ft.prototype.toggle=function(t){this.has(t)?this.delete(t):this.add(t)};var Dt=function(t,e){return t};Ft.prototype.valuesArray=function(){return this.map(Dt)};var zt=function(t,e){return[e,t]};Ft.prototype.entriesArray=function(){return this.map(zt)};var qt=Xt;function Xt(t,e){var n=e&&t&&t.values&&t.values();if(n&&"function"==typeof n.next)return n;if(!(this instanceof Xt))return new Xt(t);if(Array.isArray(t)||"string"==typeof t)return Xt.iterate(t);if((t=mt(t))instanceof Xt)return t;if(t.next)this.next=function(){return t.next()};else if(t.iterate){var r=t.iterate();this.next=function(){return r.next()}}else{if("[object Function]"!==mt.prototype.toString.call(t))throw new TypeError("Can't iterate "+t);this.next=t}}Xt.prototype.forEach=gt.prototype.forEach,Xt.prototype.map=gt.prototype.map,Xt.prototype.filter=gt.prototype.filter,Xt.prototype.every=gt.prototype.every,Xt.prototype.some=gt.prototype.some,Xt.prototype.any=gt.prototype.any,Xt.prototype.all=gt.prototype.all,Xt.prototype.min=gt.prototype.min,Xt.prototype.max=gt.prototype.max,Xt.prototype.sum=gt.prototype.sum,Xt.prototype.average=gt.prototype.average,Xt.prototype.flatten=gt.prototype.flatten,Xt.prototype.zip=gt.prototype.zip,Xt.prototype.enumerate=gt.prototype.enumerate,Xt.prototype.sorted=gt.prototype.sorted,Xt.prototype.group=gt.prototype.group,Xt.prototype.reversed=gt.prototype.reversed,Xt.prototype.toArray=gt.prototype.toArray,Xt.prototype.toObject=gt.prototype.toObject,Xt.prototype.iterator=gt.prototype.iterator,Xt.prototype.__iterationObject=null,mt.defineProperty(Xt.prototype,"_iterationObject",{get:function(){return this.__iterationObject||(this.__iterationObject={done:!1,value:void 0})}}),Xt.prototype.constructClone=function(t){var e=[];return e.addEach(t),e},Xt.prototype.mapIterator=function(t){var e=Xt(this),n=arguments[1],r=0;if("[object Function]"!=mt.prototype.toString.call(t))throw new TypeError;return new e.constructor((function(){if(!0!==e._iterationObject.done){var i=t.call(n,e.next().value,r++,e);e._iterationObject.value=i}return e._iterationObject}))},Xt.prototype.filterIterator=function(t){var e=Xt(this),n=arguments[1],r=0;if("[object Function]"!=mt.prototype.toString.call(t))throw new TypeError;return new e.constructor((function(){for(var i;;){if(!0===(i=e.next()).done)return i;if(t.call(n,i.value,r++,e))return i}}))},Xt.prototype.reduce=function(t){var e,n=Xt(this),r=arguments[1],i=arguments[2],o=0;if("[object Function]"!=mt.prototype.toString.call(t))throw new TypeError;if(!0===(e=n.next()).done){if(arguments.length>1)return arguments[1];throw TypeError("cannot reduce a value from an empty iterator with no initial value")}for(r=arguments.length>1?t.call(i,r,e.value,o,n):e.value,o++;;){if(!0===(e=n.next()).done)return r;r=t.call(i,r,e.value,o,n),o++}},Xt.prototype.concat=function(){return Xt.concat(Array.prototype.concat.apply(this,arguments))},Xt.prototype.dropWhile=function(t){var e,n,r=Xt(this),i=arguments[1],o=!1,a=0;if("[object Function]"!=mt.prototype.toString.call(t))throw new TypeError;for(;!0!==(n=r.next()).done;){if(!t.call(i,n.value,a,r)){o=!0,e=n.value;break}a++}return o?r.constructor([e]).concat(r):r.constructor([])},Xt.prototype.takeWhile=function(t){var e=Xt(this),n=arguments[1],r=0;if("[object Function]"!=mt.prototype.toString.call(t))throw new TypeError;return new e.constructor((function(){if(!0!==e._iterationObject.done){var i=e.next().value;t.call(n,i,r++,e)?e._iterationObject.value=i:(e._iterationObject.done=!0,e._iterationObject.value=void 0)}return e._iterationObject}))},Xt.prototype.zipIterator=function(){return Xt.unzip(Array.prototype.concat.apply(this,arguments))},Xt.prototype.enumerateIterator=function(t){return Xt.count(t).zipIterator(this)},Xt.iterate=function(t){var e;return e=0,new Xt((function(){if("object"==typeof t)for(;!(e in t);){if(e>=t.length){this._iterationObject.done=!0,this._iterationObject.value=void 0;break}e+=1}else e>=t.length&&(this._iterationObject.done=!0,this._iterationObject.value=void 0);return this._iterationObject.done||(this._iterationObject.value=t[e],e+=1),this._iterationObject}))},Xt.cycle=function(t,e){var n;return arguments.length<2&&(e=1/0),new Xt((function(){var r,i;return n&&(i=n()),n&&!0!==i.done||(e>0?(e--,r=Xt.iterate(t),i=(n=r.next.bind(r))()):(this._iterationObject.done=!0,i=this._iterationObject)),i}))},Xt.concat=function(t){var e;return t=Xt(t),new Xt((function(){var n,r;return e&&(r=e()),r&&!0!==r.done?r:!1===(r=t.next()).done?(n=Xt(r.value),(e=n.next.bind(n))()):r}))},Xt.unzip=function(t){return 0===(t=Xt(t).map(Xt)).length?new Xt([]):new Xt((function(){var e,n,r=t.map((function(t){return!0===(n=t.next()).done&&(e=!0),n.value}));return e?(this._iterationObject.done=!0,this._iterationObject.value=void 0):this._iterationObject.value=r,this._iterationObject}))},Xt.zip=function(){return Xt.unzip(Array.prototype.slice.call(arguments))},Xt.chain=function(){return Xt.concat(Array.prototype.slice.call(arguments))},Xt.range=function(t,e,n){return arguments.length<3&&(n=1),arguments.length<2&&(e=t,t=0),t=t||0,n=n||1,new Xt((function(){t>=e&&(this._iterationObject.done=!0,this._iterationObject.value=void 0);var r=t;return t+=n,this._iterationObject.value=r,this._iterationObject}))},Xt.count=function(t,e){return Xt.range(t,1/0,e)},Xt.repeat=function(t,e){return new Xt.range(e).mapIterator((function(){return t}))};var Yt=Ht;function Ht(){throw new Error("Can't construct. GenericMap is a mixin.")}function Ut(t,e){this.key=t,this.value=e}Ht.prototype.isMap=!0,Ht.prototype.addEach=function(t){var e;if(t&&mt(t)===t)if("function"==typeof t.forEach)!0===t.isMap?t.forEach((function(t,e){this.set(e,t)}),this):t.forEach((function(t){this.set(t[0],t[1])}),this);else if("number"==typeof t.length)for(e=0;e<t.length;e++)this.add(t[e],e);else mt.keys(t).forEach((function(e){this.set(e,t[e])}),this);else if(t&&"number"==typeof t.length)for(e=0;e<t.length;e++)this.add(t[e],e);return this},Ht.prototype.get=function(t,e){var n=this.store.get(new this.Item(t));return n?n.value:arguments.length>1?(console.log("Use of a second argument as default value is deprecated to match standards"),e):this.getDefault(t)},Ht.prototype.set=function(t,e){var n=new this.Item(t,e),r=this.store.get(n);return r?(this.dispatchesMapChanges&&this.dispatchBeforeMapChange(t,r.value),r.value=e,this.dispatchesMapChanges&&this.dispatchMapChange(t,e)):(this.dispatchesMapChanges&&this.dispatchBeforeMapChange(t,void 0),this.store.add(n)&&this.length++,this.dispatchesMapChanges&&this.dispatchMapChange(t,e)),this},Ht.prototype.add=function(t,e){return this.set(e,t)},Ht.prototype.has=function(t){return this.store.has(new this.Item(t))},Ht.prototype.delete=function(t){var e=new this.Item(t);if(this.store.has(e)){var n=this.store.get(e).value;return this.dispatchesMapChanges&&this.dispatchBeforeMapChange(t,n),this.store.delete(e),this.length--,this.dispatchesMapChanges&&this.dispatchMapChange(t,void 0),!0}return!1},Ht.prototype.clear=function(){var t,e;if(this.dispatchesMapChanges&&(this.forEach((function(t,e){this.dispatchBeforeMapChange(e,t)}),this),t=this.keysArray()),this.store.clear(),this.length=0,this.dispatchesMapChanges)for(var n=0;e=t[n];n++)this.dispatchMapChange(e)},Ht.prototype.reduce=function(t,e,n){return this.store.reduce((function(e,r){return t.call(n,e,r.value,r.key,this)}),e,this)},Ht.prototype.reduceRight=function(t,e,n){return this.store.reduceRight((function(e,r){return t.call(n,e,r.value,r.key,this)}),e,this)},Ht.prototype.keysArray=function(){return this.map((function(t,e){return e}))},Ht.prototype.keys=function(){return new qt(this.keysArray(),!0)},Ht.prototype.valuesArray=function(){return this.map(Function.identity)},Ht.prototype.values=function(){return new qt(this.valuesArray(),!0)},Ht.prototype.entriesArray=function(){return this.map((function(t,e){return[e,t]}))},Ht.prototype.entries=function(){return new qt(this.entriesArray(),!0)},Ht.prototype.items=function(){return this.entriesArray()},Ht.prototype.equals=function(t,e){return e=e||mt.equals,this===t||(t&&"function"==typeof t.every?t.length===this.length&&t.every((function(t,n){return e(this.get(n),t)}),this):mt.keys(t).length===this.length&&mt.keys(t).every((function(n){return e(this.get(n),t[n])}),this))},Ht.prototype.toJSON=function(){return this.entriesArray()},Ht.prototype.Item=Ut,Ut.prototype.equals=function(t){return mt.equals(this.key,t.key)&&mt.equals(this.value,t.value)},Ut.prototype.compare=function(t){return mt.compare(this.key,t.key)};var Vt=Qt;function Qt(t,e){if(!(this instanceof Qt))return new Qt(t,e);e=e||Function.noop,this.getDefault=e,this.store=Object.create(null),this.length=0,this.addEach(t)}Qt.Dict=Qt,Object.addEach(Qt.prototype,gt.prototype),Object.addEach(Qt.prototype,Yt.prototype),Qt.from=gt.from,Qt.prototype.constructClone=function(t){return new this.constructor(t,this.getDefault)},Qt.prototype.assertString=function(t){if("string"!=typeof t)throw new TypeError("key must be a string but Got "+t)},Object.defineProperty(Qt.prototype,"$__proto__",{writable:!0}),Object.defineProperty(Qt.prototype,"_hasProto",{get:function(){return this.hasOwnProperty("$__proto__")&&void 0!==this._protoValue}}),Object.defineProperty(Qt.prototype,"_protoValue",{get:function(){return this.$__proto__},set:function(t){this.$__proto__=t}}),Object.defineProperty(Qt.prototype,"size",gt._sizePropertyDescriptor),Qt.prototype.get=function(t,e){return this.assertString(t),"__proto__"===t?this._hasProto?this._protoValue:arguments.length>1?e:this.getDefault(t):t in this.store?this.store[t]:arguments.length>1?e:this.getDefault(t)},Qt.prototype.set=function(t,e){this.assertString(t);var n="__proto__"===t;return(n?this._hasProto:t in this.store)?(this.dispatchesMapChanges&&this.dispatchBeforeMapChange(t,n?this._protoValue:this.store[t]),n?this._protoValue=e:this.store[t]=e,this.dispatchesMapChanges&&this.dispatchMapChange(t,e),!1):(this.dispatchesMapChanges&&this.dispatchBeforeMapChange(t,void 0),this.length++,n?this._protoValue=e:this.store[t]=e,this.dispatchesMapChanges&&this.dispatchMapChange(t,e),!0)},Qt.prototype.has=function(t){return this.assertString(t),"__proto__"===t?this._hasProto:t in this.store},Qt.prototype.delete=function(t){return this.assertString(t),"__proto__"===t?!!this._hasProto&&(this.dispatchesMapChanges&&this.dispatchBeforeMapChange(t,this._protoValue),this._protoValue=void 0,this.length--,this.dispatchesMapChanges&&this.dispatchMapChange(t,void 0),!0):t in this.store&&(this.dispatchesMapChanges&&this.dispatchBeforeMapChange(t,this.store[t]),delete this.store[t],this.length--,this.dispatchesMapChanges&&this.dispatchMapChange(t,void 0),!0)},Qt.prototype.clear=function(){var t;for(t in this._hasProto&&(this.dispatchesMapChanges&&this.dispatchBeforeMapChange("__proto__",this._protoValue),this._protoValue=void 0,this.dispatchesMapChanges&&this.dispatchMapChange("__proto__",void 0)),this.store)this.dispatchesMapChanges&&this.dispatchBeforeMapChange(t,this.store[t]),delete this.store[t],this.dispatchesMapChanges&&this.dispatchMapChange(t,void 0);this.length=0},Qt.prototype.reduce=function(t,e,n){this._hasProto&&(e=t.call(n,e,"$__proto__","__proto__",this));var r=this.store;for(var i in this.store)e=t.call(n,e,r[i],i,this);return e},Qt.prototype.reduceRight=function(t,e,n){var r=this,i=this.store;return e=Object.keys(this.store).reduceRight((function(e,o){return t.call(n,e,i[o],o,r)}),e),this._hasProto?t.call(n,e,this._protoValue,"__proto__",r):e},Qt.prototype.one=function(){var t;for(t in this.store)return this.store[t];return this._protoValue},Qt.prototype.toJSON=function(){return this.toObject()};var Kt=Wt;function Wt(){}Wt.ascii={intersection:"+",through:"-",branchUp:"+",branchDown:"+",fromBelow:".",fromAbove:"'",fromBoth:"+",strafe:"|"},Wt.unicodeRound={intersection:"╋",through:"━",branchUp:"┻",branchDown:"┳",fromBelow:"╭",fromAbove:"╰",fromBoth:"┣",strafe:"┃"},Wt.unicodeSharp={intersection:"╋",through:"━",branchUp:"┻",branchDown:"┳",fromBelow:"┏",fromAbove:"┗",fromBoth:"┣",strafe:"┃"};var Jt=$t;function $t(t,e,n,r){if(!(this instanceof $t))return new $t(t,e,n,r);e=e||Object.equals,n=n||Object.hash,r=r||Function.noop,this.contentEquals=e,this.contentHash=n,this.getDefault=r;var i=this;this.buckets=new this.Buckets(null,(function(){return new i.Bucket})),this.length=0,this.addEach(t)}$t.FastSet=$t,Object.addEach($t.prototype,gt.prototype),Object.addEach($t.prototype,Bt.prototype),$t.from=gt.from,$t.prototype.Buckets=Vt,$t.prototype.Bucket=Tt,$t.prototype.constructClone=function(t){return new this.constructor(t,this.contentEquals,this.contentHash,this.getDefault)},$t.prototype.has=function(t){var e=this.contentHash(t);return this.buckets.get(e).has(t)},$t.prototype.get=function(t,e){if(e)throw new Error("FastSet#get does not support second argument: equals");var n=this.contentHash(t),r=this.buckets;return r.has(n)?r.get(n).get(t):this.getDefault(t)},$t.prototype.delete=function(t,e){if(e)throw new Error("FastSet#delete does not support second argument: equals");var n=this.contentHash(t),r=this.buckets;if(r.has(n)){var i=r.get(n);if(i.delete(t))return this.length--,0===i.length&&r.delete(n),!0}return!1},$t.prototype.clear=function(){this.buckets.clear(),this.length=0},$t.prototype.add=function(t){var e=this.contentHash(t),n=this.buckets;return n.has(e)||n.set(e,new this.Bucket(null,this.contentEquals)),!n.get(e).has(t)&&(n.get(e).add(t),this.length++,!0)},$t.prototype.reduce=function(t,e){var n=arguments[2],r=this.buckets,i=0;return r.reduce((function(e,r){return r.reduce((function(e,r){return t.call(n,e,r,i++,this)}),e,this)}),e,this)},$t.prototype.one=function(){if(this.length>0)return this.buckets.one().one()},$t.prototype.iterate=function(){return this.buckets.valuesArray().flatten().iterate()},$t.prototype.log=function(t,e,n,r){t=t||Kt.unicodeSharp,e=e||this.logNode,n||(n=console.log,r=console),n=n.bind(r);for(var i,o,a,s,u=this.buckets,l=u.size,h=u.keys(),c=0;i=h.next().value;)c===l-1?(o=t.fromAbove,a=" "):0===c?(o=t.branchDown,a=t.strafe):(o=t.fromBoth,a=t.strafe),s=u.get(i),n.call(r,o+t.through+t.branchDown+" "+i),s.forEach((function(i,o){var u,l,h;o===s.head.prev?(u=t.fromAbove,l=" "):(u=t.fromBoth,l=t.strafe),e(o,(function(e){h?n.call(r,a+" "+l+"  "+e):(n.call(r,a+" "+u+t.through+t.through+e),h=!0)}),(function(e){n.call(r,a+" "+t.strafe+"  "+e)}))})),c++},$t.prototype.logNode=function(t,e){var n=t.value;Object(n)===n?JSON.stringify(n,null,4).split("\n").forEach((function(t){e(" "+t)})):e(" "+n)};var Zt=yt((function(t){var e,n;void 0!==ft.Set&&"function"==typeof ft.Set.prototype.values&&((e=t.exports=ft.Set).Set=e,e.prototype.reduce=function(t,e){var n=arguments[2];return this.forEach((function(r){e=t.call(n,e,r,this)})),e},e.prototype.reduceRight=function(t,e){for(var n,r=arguments[2],i=this.values(),o=this.size,a=new Array(this.size),s=o;n=i.next().value;)a[--s]=n;for(;s<o;)e=t.call(r,e,a[s++],this);return e},e.prototype.equals=function(t,e){var n=this;return t&&"function"==typeof t.reduce&&this.size===(t.size||t.length)&&t.reduce((function(t,r){return t&&n.has(r,e)}),!0)},e.prototype.constructClone=function(t){return new this.constructor(t,this.contentEquals,this.contentHash,this.getDefault)},e.prototype.toJSON=function(){return this.entriesArray()},e.prototype.one=function(){if(this.size>0)return this.values().next().value},e.prototype.pop=function(){if(this.size){for(var t,e,n=this.values();t=n.next().value;)e=t;return this.delete(e,this.size-1),e}},e.prototype.shift=function(){if(this.size){var t=this.values().next().value;return this.delete(t,0),t}},Object.defineProperty(e.prototype,"length",{get:function(){return this.size},enumerable:!0,configurable:!0}),e.from=function(t){var e=new this;return e.addEach(t),e},Object.addEach(e.prototype,gt.prototype,!1),Object.addEach(e.prototype,Bt.prototype,!1)),(n=function t(e,n,r,i){return t._init(t,this,e,n,r,i)})._init=function(t,e,n,r,i,o){if(!(e instanceof t))return new t(n,r,i,o);r=r||Object.equals,i=i||Object.hash,o=o||Function.noop,e.contentEquals=r,e.contentHash=i,e.getDefault=o,e.order=new e.Order(void 0,r),e.store=new e.Store(void 0,(function(t,e){return r(t.value,e.value)}),(function(t){return i(t.value)})),e.length=0,e.addEach(n)},n.Set=n,n.CollectionsSet=n,Object.addEach(n.prototype,gt.prototype),Object.addEach(n.prototype,Bt.prototype),n.from=gt.from,Object.defineProperty(n.prototype,"size",gt._sizePropertyDescriptor),n.prototype.Order=Tt,n.prototype.Store=Jt,n.prototype.constructClone=function(t){return new this.constructor(t,this.contentEquals,this.contentHash,this.getDefault)},n.prototype.has=function(t){var e=new this.order.Node(t);return this.store.has(e)},n.prototype.get=function(t,e){if(e)throw new Error("Set#get does not support second argument: equals");var n=new this.order.Node(t);return(n=this.store.get(n))?n.value:this.getDefault(t)},n.prototype.add=function(t){var e=new this.order.Node(t);return!this.store.has(e)&&(this.length,this.order.add(t),e=this.order.head.prev,this.store.add(e),this.length++,!0)},n.prototype.delete=function(t,e){if(e)throw new Error("Set#delete does not support second argument: equals");var n=new this.order.Node(t);return!!this.store.has(n)&&(n=this.store.get(n),this.store.delete(n),this.order.splice(n,1),this.length--,!0)},n.prototype.pop=function(){if(this.length){var t=this.order.head.prev.value;return this.delete(t),t}},n.prototype.shift=function(){if(this.length){var t=this.order.head.next.value;return this.delete(t),t}},n.prototype.one=function(){if(this.length>0)return this.store.one().value},n.prototype.clear=function(){this.store.clear(),this.order.clear(),this.length=0},Object.defineProperty(n.prototype,"_clear",{value:n.prototype.clear}),n.prototype.reduce=function(t,e){var n=arguments[2],r=this.order,i=0;return r.reduce((function(e,r){return t.call(n,e,r,i++,this)}),e,this)},n.prototype.reduceRight=function(t,e){var n=arguments[2],r=this.order,i=this.length-1;return r.reduceRight((function(e,r){return t.call(n,e,r,i--,this)}),e,this)},n.prototype.iterate=function(){return this.order.iterate()},n.prototype.values=function(){return new qt(this.valuesArray(),!0)},n.prototype.log=function(){var t=this.store;return t.log.apply(t,arguments)},e?(e.prototype.valuesArray=Bt.prototype.valuesArray,e.prototype.entriesArray=Bt.prototype.entriesArray,t.exports=e,e.CollectionsSet=n):t.exports=n})),te=yt((function(t){var e,n,r;if(void 0!==ft.Map&&"function"==typeof ft.Set.prototype.values){var i;n=e=t.exports=ft.Map,e.Map=e,i={}.__proto__===Object.prototype?function(){this.__proto__=p}:function(){Object.defineProperties(this,observableSetProperties)},Object.defineProperty(e.prototype,"makeObservable",{value:i,writable:!0,configurable:!0,enumerable:!1}),Object.defineProperty(e.prototype,"makePropertyObservable",{value:function(){},writable:!0,configurable:!0,enumerable:!1}),e.prototype.constructClone=function(t){return new this.constructor(t)},e.prototype.isMap=!0,e.prototype.addEach=function(t){if(t&&Object(t)===t)if("function"==typeof t.forEach)!0===t.isMap?t.forEach((function(t,e){this.set(e,t)}),this):t.forEach((function(t){this.set(t[0],t[1])}),this);else if("number"==typeof t.length)for(var e=0;e<t.length;e++)this.add(t[e],e);else Object.keys(t).forEach((function(e){this.set(e,t[e])}),this);else if(t&&"number"==typeof t.length)for(e=0;e<t.length;e++)this.add(t[e],e);return this},e.prototype.add=function(t,e){return this.set(e,t)},e.prototype.reduce=function(t,e){var n=arguments[2];return this.forEach((function(r,i,o){e=t.call(n,e,r,i,this)})),e},e.prototype.reduceRight=function(t,e){for(var n,r=arguments[2],i=this.keys(),o=this.size,a=new Array(this.size),s=0;n=i.next().value;)a[--o]=n;for(;s++<o;)e=t.call(r,e,this.get(a[s]),a[s],this);return e},e.prototype.equals=function(t,e){return e=e||Object.equals,this===t||(t&&"function"==typeof t.every?t.size===this.size&&t.every((function(t,n){return e(this.get(n),t)}),this):Object.keys(t).length===this.size&&Object.keys(t).every((function(n){return e(this.get(n),t[n])}),this))};var o=function(t,e){return e};e.prototype.keysArray=function(){return this.map(o)};var a=function(t,e){return t};e.prototype.valuesArray=function(){return this.map(a)};var s=function(t,e){return[e,t]};e.prototype.entriesArray=function(){return this.map(s)},e.prototype.toJSON=function(){return this.entriesArray()},e.prototype.items=function(){return this.entriesArray()},e.from=function(t){var e=new this;return e.addEach(t),e},Object.defineProperty(e.prototype,"length",{get:function(){return this.size},enumerable:!0,configurable:!0});var u=e.prototype.clear,l=e.prototype.set,h=e.prototype.delete,c={clear:{value:function(){var t;this.dispatchesMapChanges&&(this.forEach((function(t,e){this.dispatchBeforeMapChange(e,t)}),this),t=this.keysArray()),u.call(this),this.dispatchesMapChanges&&t.forEach((function(t){this.dispatchMapChange(t)}),this)},writable:!0,configurable:!0},set:{value:function(t,e){var n=this.get(t);return n?(this.dispatchesMapChanges&&this.dispatchBeforeMapChange(t,n),l.call(this,t,e),this.dispatchesMapChanges&&this.dispatchMapChange(t,e)):(this.dispatchesMapChanges&&this.dispatchBeforeMapChange(t,void 0),l.call(this,t,e),this.dispatchesMapChanges&&this.dispatchMapChange(t,e)),this},writable:!0,configurable:!0},delete:{value:function(t){return!!this.has(t)&&(this.dispatchesMapChanges&&this.dispatchBeforeMapChange(t,this.get(t)),h.call(this,t),this.dispatchesMapChanges&&this.dispatchMapChange(t,void 0),!0)}}};Object.addEach(e.prototype,gt.prototype,!1);var p=Object.create(e.prototype,c)}var f=Zt.CollectionsSet;r=e=function t(e,n,r,i){if(!(this instanceof t))return new t(e,n,r,i);n=n||Object.equals,r=r||Object.hash,i=i||Function.noop,this.contentEquals=n,this.contentHash=r,this.getDefault=i,this.store=new f(void 0,(function(t,e){return n(t.key,e.key)}),(function(t){return r(t.key)})),this.length=0,this.addEach(e)},e.Map=e,Object.addEach(e.prototype,gt.prototype),Object.addEach(e.prototype,Yt.prototype),Object.defineProperty(e.prototype,"size",gt._sizePropertyDescriptor),e.from=gt.from,e.prototype.constructClone=function(t){return new this.constructor(t,this.contentEquals,this.contentHash,this.getDefault)},e.prototype.log=function(t,e,n,r){e=e||this.logNode,this.store.log(t,(function(t,n,r){e(t.value.value,n,r)}),n,r)},e.prototype.logNode=function(t,e){e(" key: "+t.key),e(" value: "+t.value)},n?(t.exports=n,n.CollectionsMap=r):t.exports=r})),ee=yt((function(t){var e=t.exports.ObjectChangeDescriptor=function(t){return this.name=t,this.isActive=!1,this._willChangeListeners=null,this._changeListeners=null,this};Object.defineProperties(e.prototype,{name:{value:null,writable:!0},isActive:{value:!1,writable:!0},_willChangeListeners:{value:null,writable:!0},willChangeListeners:{get:function(){return this._willChangeListeners||(this._willChangeListeners=new this.willChangeListenersRecordConstructor(this.name))}},_changeListeners:{value:null,writable:!0},changeListeners:{get:function(){return this._changeListeners||(this._changeListeners=new this.changeListenersRecordConstructor(this.name))}},changeListenersRecordConstructor:{value:i,writable:!0},willChangeListenersRecordConstructor:{value:a,writable:!0}});var n=t.exports.ListenerGhost=Object.create(null),r=new te;function i(t){var e=r.get(t);return e||(e="handle",e+=t,e+="Change",r.set(t,e)),this._current=null,this._current=null,this.specificHandlerMethodName=e,this}t.exports.ChangeListenersRecord=i,Object.defineProperties(i.prototype,{_current:{value:null,writable:!0},current:{get:function(){return this._current},set:function(t){this._current=t}},ListenerGhost:{value:n,writable:!0},ghostCount:{value:0,writable:!0},maxListenerGhostRatio:{value:.3,writable:!0},listenerGhostFilter:{value:function(t){return t!==this.ListenerGhost}},removeCurrentGostListenersIfNeeded:{value:function(){return this._current&&this.ghostCount/this._current.length>this.maxListenerGhostRatio&&(this.ghostCount=0,this._current=this._current.filter(this.listenerGhostFilter,this)),this._current}},dispatchBeforeChange:{value:!1,writable:!0},genericHandlerMethodName:{value:"handlePropertyChange",writable:!0}}),t.exports.WillChangeListenersRecord=a;var o=new te;function a(t){var e=o.get(t);return e||(e="handle",e+=t,e+="WillChange",o.set(t,e)),this.specificHandlerMethodName=e,this}a.prototype=new i,a.prototype.constructor=a,a.prototype.genericHandlerMethodName="handlePropertyWillChange"})),ne=re;function re(){throw new Error("This is an abstract interface. Mix it. Don't construct it")}var ie=ee.ObjectChangeDescriptor,oe=ee.ListenerGhost;re.debug=!0;var ae=new bt,se=new te;function ue(t,e,n,r){if(t&&t._current){var i,o,a,s,u,l=t.specificHandlerMethodName,h=t.genericHandlerMethodName,c=oe;if(Array.isArray(t._current)){for(a=0,s=(i=t.removeCurrentGostListenersIfNeeded()).length;a<s;a++)if((u=i[a])!==c){if(!(o=u[l]||u[h]||u).call)throw new Error("No event listener for "+t.specificHandlerName+" or "+t.genericHandlerName+" or call on "+o);o.call(u,n,e,r)}}else{if(!(o=(u=t._current)[l]||u[h]||u).call)throw new Error("No event listener for "+t.specificHandlerName+" or "+t.genericHandlerName+" or call on "+o);o.call(u,n,e,r)}}}re.ObjectChangeDescriptor=function(){},re.prototype.getOwnPropertyChangeDescriptor=function(t){var e,n=ae.get(this);if(n||(n=Object.create(null),ae.set(this,n)),void 0===(e=n[t])){var r=se.get(t);return r||(r=(r=String(t))&&r[0].toUpperCase()+r.slice(1),se.set(t,r)),n[t]=new ie(r)}return e},re.prototype.hasOwnPropertyChangeDescriptor=function(t){var e=ae.get(this);return!!e&&(!t||void 0!==e[t])},re.prototype.addOwnPropertyChangeListener=function(t,e,n){this.makeObservable&&!this.isObservable&&this.makeObservable();var r=re.getOwnPropertyChangeDescriptor(this,t),i=n?r.willChangeListeners:r.changeListeners;re.makePropertyObservable(this,t),i._current?Array.isArray(i._current)?i._current.push(e):i._current=[i._current,e]:i._current=e;var o=this;return function(){re.removeOwnPropertyChangeListener(o,t,e,n),o=null}},re.prototype.addBeforeOwnPropertyChangeListener=function(t,e){return re.addOwnPropertyChangeListener(this,t,e,!0)},re.prototype.removeOwnPropertyChangeListener=function t(e,n,r){var i,o=re.getOwnPropertyChangeDescriptor(this,e);if((i=r?o._willChangeListeners:o._changeListeners)&&i._current)if(i._current===n)i._current=null;else{var a=i._current.lastIndexOf(n);if(-1===a)throw new Error("Can't remove property change listener: does not exist: property name"+JSON.stringify(e));o.isActive?(i.ghostCount=i.ghostCount+1,i._current[a]=t.ListenerGhost):i._current.spliceOne(a)}},re.prototype.removeOwnPropertyChangeListener.ListenerGhost=oe,re.prototype.removeBeforeOwnPropertyChangeListener=function(t,e){return re.removeOwnPropertyChangeListener(this,t,e,!0)},re.prototype.dispatchOwnPropertyChange=function t(e,n,r){var i,o=re.getOwnPropertyChangeDescriptor(this,e);if(!o.isActive){o.isActive=!0,i=r?o._willChangeListeners:o._changeListeners;try{t.dispatchEach(i,e,n,this)}finally{o.isActive=!1}}},re.prototype.dispatchOwnPropertyChange.dispatchEach=ue,ue.ListenerGhost=oe,re.prototype.dispatchBeforeOwnPropertyChange=function(t,e){return re.dispatchOwnPropertyChange(this,t,e,!0)};var le=new bt;new bt;var he={get:void 0,set:void 0,configurable:!0,enumerable:!1};re.prototype.makePropertyObservable=function(t){var e=le.get(this);if(!e||void 0===e.get(t)){if(!e){if(Array.isArray(this))return;if(!Object.isExtensible(this))throw new Error("Can't make property "+JSON.stringify(t)+" observable on "+this+" because object is not extensible");e=new te,le.set(this,e)}var n,r=this;do{if(n=Object.getOwnPropertyDescriptor(r,t))break;r=Object.getPrototypeOf(r)}while(r);if(n){if(!n.configurable)return;if(!n.writable&&!n.set)return}else n={value:void 0,enumerable:!0,writable:!0,configurable:!0};e.set(t,n),"value"in n?(he.get=function t(){return t.overriddenDescriptor.value},he.set=function t(e){var n,r,i=t.overriddenDescriptor;if(e!==i.value){if(!(r=(n=t.descriptor).isActive)){n.isActive=!0;try{t.dispatchEach(n._willChangeListeners,t.key,i.value,this)}finally{}}if(i.value=e,!r)try{t.dispatchEach(n._changeListeners,t.key,e,this)}finally{n.isActive=!1}}},he.set.dispatchEach=ue,he.set.key=t,he.get.overriddenDescriptor=he.set.overriddenDescriptor=n,he.set.descriptor=ae.get(this)[t],he.enumerable=n.enumerable,he.configurable=!0):(he.get=n.get,he.set=function e(){var n,r,i,o=e.overriddenGetter.call(this);if(1===arguments.length?e.overriddenSetter.call(this,arguments[0]):2===arguments.length?e.overriddenSetter.call(this,arguments[0],arguments[1]):e.overriddenSetter.apply(this,arguments),(i=e.overriddenGetter.call(this))!==o){if(!(r=(n=e.descriptor).isActive)){n.isActive=!0;try{e.dispatchEach(n._willChangeListeners,t,o,this)}finally{}}if(!r)try{e.dispatchEach(n._changeListeners,t,i,this)}finally{n.isActive=!1}}},he.enumerable=n.enumerable,he.configurable=!0,he.set.dispatchEach=ue,he.set.overriddenSetter=n.set,he.set.overriddenGetter=n.get,he.set.descriptor=ae.get(this)[t]),Object.defineProperty(this,t,he)}},re.getOwnPropertyChangeDescriptor=function(t,e){return t.getOwnPropertyChangeDescriptor?t.getOwnPropertyChangeDescriptor(e):re.prototype.getOwnPropertyChangeDescriptor.call(t,e)},re.hasOwnPropertyChangeDescriptor=function(t,e){return t.hasOwnPropertyChangeDescriptor?t.hasOwnPropertyChangeDescriptor(e):re.prototype.hasOwnPropertyChangeDescriptor.call(t,e)},re.addOwnPropertyChangeListener=function(t,e,n,r){if(Object.isObject(t))return t.addOwnPropertyChangeListener?t.addOwnPropertyChangeListener(e,n,r):this.prototype.addOwnPropertyChangeListener.call(t,e,n,r)},re.removeOwnPropertyChangeListener=function(t,e,n,r){if(Object.isObject(t))return t.removeOwnPropertyChangeListener?t.removeOwnPropertyChangeListener(e,n,r):re.prototype.removeOwnPropertyChangeListener.call(t,e,n,r)},re.dispatchOwnPropertyChange=function(t,e,n,r){if(Object.isObject(t))return t.dispatchOwnPropertyChange?t.dispatchOwnPropertyChange(e,n,r):re.prototype.dispatchOwnPropertyChange.call(t,e,n,r)},re.addBeforeOwnPropertyChangeListener=function(t,e,n){return re.addOwnPropertyChangeListener(t,e,n,!0)},re.removeBeforeOwnPropertyChangeListener=function(t,e,n){return re.removeOwnPropertyChangeListener(t,e,n,!0)},re.dispatchBeforeOwnPropertyChange=function(t,e,n){return re.dispatchOwnPropertyChange(t,e,n,!0)},re.makePropertyObservable=function(t,e){return t.makePropertyObservable?t.makePropertyObservable(e):re.prototype.makePropertyObservable.call(t,e)};var ce=ee.ObjectChangeDescriptor,pe=ee.ChangeListenersRecord,fe=ee.ListenerGhost,ye=new bt;function ge(t){this.name=t,this.isActive=!1,this._willChangeListeners=null,this._changeListeners=null}ge.prototype=new ce,ge.prototype.constructor=ge,ge.prototype.changeListenersRecordConstructor=ve,ge.prototype.willChangeListenersRecordConstructor=be,Object.defineProperty(ge.prototype,"active",{get:function(){return this._active||(this._active=this._current?this._current.slice():[])}});var de=new te;function ve(t){var e=de.get(t);return e||(e="handle",e+=t.slice(0,1).toUpperCase(),e+=t.slice(1),e+="RangeChange",de.set(t,e)),this.specificHandlerMethodName=e,this}ve.prototype=new pe,ve.prototype.constructor=ve;var _e=new te;function be(t){var e=_e.get(t);return e||(e="handle",e+=t.slice(0,1).toUpperCase(),e+=t.slice(1),e+="RangeWillChange",_e.set(t,e)),this.specificHandlerMethodName=e,this}be.prototype=new pe,be.prototype.constructor=be;var me=Ee;function Ee(){throw new Error("Can't construct. RangeChanges is a mixin.")}Ee.prototype.getAllRangeChangeDescriptors=function(){return ye.has(this)||ye.set(this,new te),ye.get(this)},Ee.prototype.getRangeChangeDescriptor=function(t){var e=this.getAllRangeChangeDescriptors();return t=t||"",e.has(t)||e.set(t,new ge(t)),e.get(t)};var Oe=new bt,we="dispatchesRangeChanges",ke={get:function(){return Oe.get(this)},set:function(t){return Oe.set(this,t)},configurable:!0,enumerable:!1};Ee.prototype.addRangeChangeListener=function(t,e,n){!this.isObservable&&this.makeObservable&&this.makeObservable();var r,i=this.getRangeChangeDescriptor(e);(r=n?i.willChangeListeners:i.changeListeners)._current?Array.isArray(r._current)?r._current.push(t):r._current=[r._current,t]:r._current=t,void 0===Object.getOwnPropertyDescriptor(this.__proto__||Object.getPrototypeOf(this),we)&&Object.defineProperty(this.__proto__||Object.getPrototypeOf(this),we,ke),this.dispatchesRangeChanges=!0;var o=this;return function(){o&&(o.removeRangeChangeListener(t,e,n),o=null)}},Ee.prototype.removeRangeChangeListener=function(t,e,n){var r,i=this.getRangeChangeDescriptor(e);if((r=n?i._willChangeListeners:i._changeListeners)._current)if(r._current===t)r._current=null;else{var o=r._current.lastIndexOf(t);if(-1===o)throw new Error("Can't remove range change listener: does not exist: token "+JSON.stringify(e));i.isActive?(r.ghostCount=r.ghostCount+1,r._current[o]=fe):r._current.spliceOne(o)}},Ee.prototype.dispatchRangeChange=function(t,e,n,r){var i,o,a,s,u,l,h,c,p=this.getAllRangeChangeDescriptors(),f=p.values();for(p.dispatchBeforeChange=r;i=f.next().value;){if(i.isActive)return;if((o=r?i._willChangeListeners:i._changeListeners)&&o._current)if(a=o.specificHandlerMethodName,Array.isArray(o._current)){if(o._current.length){i.isActive=!0;try{for(h=o.removeCurrentGostListenersIfNeeded(),c=fe,s=0,u=h.length;s<u;s++)if((l=h[s])!==c)if(l[a])l[a](t,e,n,this,r);else{if(!l.call)throw new Error("Handler "+l+" has no method "+a+" and is not callable");l.call(this,t,e,n,this,r)}}finally{i.isActive=!1}}}else{i.isActive=!0;try{if((l=o._current)[a])l[a](t,e,n,this,r);else{if(!l.call)throw new Error("Handler "+l+" has no method "+a+" and is not callable");l.call(this,t,e,n,this,r)}}finally{i.isActive=!1}}}},Ee.prototype.addBeforeRangeChangeListener=function(t,e){return this.addRangeChangeListener(t,e,!0)},Ee.prototype.removeBeforeRangeChangeListener=function(t,e){return this.removeRangeChangeListener(t,e,!0)},Ee.prototype.dispatchBeforeRangeChange=function(t,e,n){return this.dispatchRangeChange(t,e,n,!0)};var Ae=Ce;function Ce(t,e,n){return Tt._init(Ce,this,t,e,n)}Ce.prototype=new Tt,Ce.prototype.constructor=Ce,Ce.List=Ce,Ce.from=Tt.from,Object.addEach(Ce.prototype,ne.prototype),Object.addEach(Ce.prototype,me.prototype),Ce.prototype.makeObservable=function(){this.head.index=-1,this.updateIndexes(this.head.next,0),this.dispatchesRangeChanges=!0},Object.defineProperties(Ce.prototype,{_dispatchEmptyArray:{value:[]}}),Ce.prototype.delete=function(t,e){var n=this.findLast(t,e);if(n){if(this.dispatchesRangeChanges){var r=[],i=[t];this.dispatchBeforeRangeChange(r,i,n.index)}return n.delete(),this.length--,this.dispatchesRangeChanges&&(this.updateIndexes(n.next,n.index),this.dispatchRangeChange(r,i,n.index)),!0}return!1},Object.defineProperty(Ce.prototype,"superClear",{value:Tt.prototype.clear,enumerable:!1,configurable:!0,writable:!0}),Ce.prototype.clear=function(){var t,e;this.dispatchesRangeChanges&&(e=this.toArray(),t=[],this.dispatchBeforeRangeChange(t,e,0)),this.superClear(),this.dispatchesRangeChanges&&this.dispatchRangeChange(t,e,0)},Ce.prototype.add=function(t){var e=new this.Node(t);return this.dispatchesRangeChanges&&(e.index=this.length,this.dispatchBeforeRangeChange([t],[],e.index)),this._addNode(e),this.dispatchesRangeChanges&&this.dispatchRangeChange([t],[],e.index),!0},Object.defineProperty(Ce.prototype,"superPush",{value:Tt.prototype.push,enumerable:!1,configurable:!0,writable:!0}),Ce.prototype.push=function(){if(this.dispatchesRangeChanges){var t=Array.prototype.slice.call(arguments),e=[],n=this.length;this.dispatchBeforeRangeChange(t,e,n);var r=this.head.prev}1===arguments.length?this.superPush.call(this,arguments[0]):2===arguments.length?this.superPush.call(this,arguments[0],arguments[1]):this.superPush.apply(this,arguments),this.dispatchesRangeChanges&&(this.updateIndexes(r.next,void 0===r.index?0:r.index+1),this.dispatchRangeChange(t,e,n))},Object.defineProperty(Ce.prototype,"superUnshift",{value:Tt.prototype.unshift,enumerable:!1,configurable:!0,writable:!0}),Ce.prototype.unshift=function(){if(this.dispatchesRangeChanges){var t=Array.prototype.slice.call(arguments),e=[];this.dispatchBeforeRangeChange(t,e,0)}1===arguments.length?this.superUnshift.call(this,arguments[0]):2===arguments.length?this.superUnshift.call(this,arguments[0],arguments[1]):this.superUnshift.apply(this,arguments),this.dispatchesRangeChanges&&(this.updateIndexes(this.head.next,0),this.dispatchRangeChange(t,e,0))},Object.defineProperty(Ce.prototype,"_beforePop",{value:function(t,e){var n;return this.dispatchesRangeChanges&&(n=[t],this.dispatchBeforeRangeChange(this._dispatchEmptyArray,n,e)),n},enumerable:!1,configurable:!0,writable:!0}),Object.defineProperty(Ce.prototype,"_afterPop",{value:function(t,e,n){this.dispatchesRangeChanges&&this.dispatchRangeChange(this._dispatchEmptyArray,n,e)},enumerable:!1,configurable:!0,writable:!0}),Object.defineProperty(Ce.prototype,"superPop",{value:Tt.prototype.pop,enumerable:!1,configurable:!0,writable:!0}),Ce.prototype.pop=function(){return this.superPop(this._beforePop,this._afterPop)},Object.defineProperty(Ce.prototype,"_beforeShift",{value:function(t,e){var n;return this.dispatchesRangeChanges&&(n=[t],this.dispatchBeforeRangeChange(this._dispatchEmptyArray,n,e)),n},enumerable:!1,configurable:!0,writable:!0}),Object.defineProperty(Ce.prototype,"_afterShift",{value:function(t,e,n){this.dispatchesRangeChanges&&(this.updateIndexes(this.head.next,e),this.dispatchRangeChange(this._dispatchEmptyArray,n,e))},enumerable:!1,configurable:!0,writable:!0}),Object.defineProperty(Ce.prototype,"superShift",{value:Tt.prototype.shift,enumerable:!1,configurable:!0,writable:!0}),Ce.prototype.shift=function(){return this.superShift(this._beforeShift,this._afterShift)},Object.defineProperty(Ce.prototype,"superSwap",{value:Tt.prototype.swap,enumerable:!1,configurable:!0,writable:!0}),Ce.prototype.swap=function(t,e,n){var r,i;return this.superSwap(t,e,n,(function(t,e,n){this.dispatchesRangeChanges&&(r=t===this.head?this.length:t.prev===this.head?0:t.index,i=t.prev,this.dispatchBeforeRangeChange(e,n,r))}),(function(t,e,n){this.dispatchesRangeChanges&&(t===this.head?this.updateIndexes(this.head.next,0):this.updateIndexes(i.next,i.index+1),this.dispatchRangeChange(e,n,r))}))},Object.defineProperty(Ce.prototype,"superReverse",{value:Tt.prototype.reverse,enumerable:!1,configurable:!0,writable:!0}),Ce.prototype.reverse=function(){if(this.dispatchesRangeChanges){var t=this.toArray(),e=t.reversed();this.dispatchBeforeRangeChange(e,t,0)}return this.superReverse(),this.dispatchesRangeChanges&&this.dispatchRangeChange(e,t,0),this};var Se=function(){function t(){e(this,t),i(this,"__internal",new Ae)}return r(t,[{key:"add",value:function(t){return this.__internal.push(t)}},{key:"isEmpty",value:function(){return 0===this.__internal.length}},{key:"poll",value:function(){return this.__internal.shift()}},{key:"addAll",value:function(t){var e;return(e=this.__internal).push.apply(e,d(t))}}]),t}(),Re=function(t){o(r,t);var n=f(r);function r(){return e(this,r),n.apply(this,arguments)}return r}(S),je=function t(){e(this,t)};i(je,"out",{println:function(){var t;(t=console).log.apply(t,arguments)}}),i(je,"err",{println:function(){var t;(t=console).error.apply(t,arguments)}});var Le,Me=function(){function t(){e(this,t),i(this,"count",void 0),i(this,"running",void 0),i(this,"started",void 0),i(this,"totalElapsed",void 0),this.count=0,this.totalElapsed=0,this.running=!1,this.started=null,this.start()}return r(t,[{key:"getElapsed",value:function(){return t.now()-this.started}},{key:"getElapsedTotal",value:function(){return this.totalElapsed}},{key:"getNumCounts",value:function(){return this.count}},{key:"log",value:function(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:q.FINE;this.stop(),null!==e?e.log(r,"".concat(n," took ").concat(t.in(this.totalElapsed,x.SECONDS).toFixed(2).padStart(5)," seconds (wall clock time").concat(1===this.count?"":", ".concat(this.count," timings"))):je.out.println("".concat(n," took ").concat(t.in(this.totalElapsed,x.SECONDS).toFixed(3).padStart(5)," seconds (wall clock time").concat(1===this.count?"":", ".concat(this.count," timings")))}},{key:"start",value:function(){this.running||(this.started=t.now(),this.running=!0)}},{key:"stop",value:function(){this.running&&(this.totalElapsed+=this.getElapsed(),this.count++,this.running=!1)}}],[{key:"now",value:function(){var t=g(process.hrtime(),2);return 1e10*t[0]+t[1]}},{key:"in",value:function(t,e){return t/e}}]),t}(),Ne=function(){function t(){e(this,t)}return r(t,null,[{key:"elapsed",value:function(t){return this.timers.containsKey(t)?this.timers.get(t).getElapsedTotal():-1}},{key:"in",value:function(t,e){return t/e}},{key:"log",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:q.FINE;this.timers.containsKey(t)&&this.timers.get(t).log(e,t,n)}},{key:"logAll",value:function(t){t.log(q.FINE,""),t.log(q.FINE,"TIMERS");var e,n=!1,r=null,i=tt.comparingInt(P),o=b(this.timers.keySet());try{for(o.s();!(e=o.n()).done;){var a=e.value;(!n||i(a,r)>0)&&(n=!0,r=a)}}catch(t){o.e(t)}finally{o.f()}var s,u=(n?r:"").length,l=function(t){return t.padEnd(u)},h=new S,c=b(this.timers.entrySet());try{for(c.s();!(s=c.n()).done;){var p=s.value;p.getKey().startsWith("[")||h.add(p)}}catch(t){c.e(t)}finally{c.f()}h.sort($.comparingByKey());var f,y=b(h);try{for(y.s();!(f=y.n()).done;){var g=f.value;g.getValue().log(t,l(g.getKey()))}}catch(t){y.e(t)}finally{y.f()}var d,v=new S,_=b(this.timers.entrySet());try{for(_.s();!(d=_.n()).done;){var m=d.value;m.getKey().startsWith("[")&&v.add(m)}}catch(t){_.e(t)}finally{_.f()}v.sort($.comparingByKey());var E,O="",w=b(v.toArray());try{for(w.s();!(E=w.n()).done;){var k=E.value,A=k.getKey().indexOf("]")+1,C=k.getKey().substring(0,A);C!==O&&(O=C,t.log(q.FINE,""),t.log(q.FINE,O)),k.getValue().log(t,l(k.getKey().substring(A+1)))}}catch(t){w.e(t)}finally{w.f()}}},{key:"now",value:function(){var t=g(process.hrtime(),2);return 1e10*t[0]+t[1]}},{key:"start",value:function(t){this.timers.containsKey(t)?this.timers.get(t).start():this.timers.put(t,new Me)}},{key:"stop",value:function(t){this.timers.get(t).stop()}},{key:"reset",value:function(){this.timers.clear()}}]),t}();function xe(t){return t instanceof S}i(Ne,"timers",new J),Le=Symbol.iterator;var Te=function(){function t(n,r,o,a){e(this,t),i(this,"cell",void 0),i(this,"parent",void 0),i(this,"_isOrphan",void 0),i(this,"children",void 0),i(this,"glyphs",void 0),i(this,"neighbors",void 0),this.cell=new w(n,r,o,a),this.parent=null,this._isOrphan=!1,this.children=null,this.glyphs=new S(m.MAX_GLYPHS_PER_CELL),this.neighbors=new S(ct.values().length);var s,u=b(ct.values());try{for(u.s();!(s=u.n()).done;){s.value;this.neighbors.add(new S)}}catch(t){u.e(t)}finally{u.f()}}return r(t,[{key:"clear",value:function(){if(null!=this.children){var t,e=b(this.children);try{for(e.s();!(t=e.n()).done;){t.value.clear()}}catch(t){e.e(t)}finally{e.f()}this.children=null}if(null!=this.glyphs){var n,r=b(this.glyphs);try{for(r.s();!(n=r.n()).done;){n.value.removeCell(this)}}catch(t){r.e(t)}finally{r.f()}this.glyphs.clear()}else this.glyphs=new S(m.MAX_GLYPHS_PER_CELL);var i,o=b(this.neighbors);try{for(o.s();!(i=o.n()).done;){i.value.clear()}}catch(t){o.e(t)}finally{o.f()}}},{key:"contains",value:function(t,e){var n=this.getRoot();return this.cell.getMinX()<=t&&this.cell.getMinY()<=e&&(t<this.cell.getMaxX()||t==n.cell.getMaxX())&&(e<this.cell.getMaxY()||e==n.cell.getMaxY())}},{key:"getGlyphs",value:function(){return this.glyphs}},{key:"getGlyphsAlive",value:function(){if(null==this.glyphs)return this.glyphs;var t,e=new S,n=b(this.glyphs);try{for(n.s();!(t=n.n()).done;){var r=t.value;r.isAlive()&&e.add(r)}}catch(t){n.e(t)}finally{n.f()}return e}},{key:"getHeight",value:function(){return this.cell.getHeight()}},{key:"getLeaves",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];if(e.length>0){if(lt(e[0])){var r=e[0];if(xe(e[1])){var i=e[1];return this.__getLeavesSideResult(r,i)}if(E(e[1])){var o=e[1],a=e[2];return this.__getLeavesSideRectangleResult(r,o,a)}return this.__getLeavesSide(r)}if(E(e[0])){var s=e[0];if(xe(e[1])){var u=e[1];return this.__getLeavesRectangleResult(s,u)}return this.__getLeavesRectangle(s)}if(at(e[0])){var l=e[0];if("number"==typeof e[1]){var h=e[1];if(xe(e[2])){var c=e[2];return this.__getLeavesGlyphAtResult(l,h,c)}return this.__getLeavesGlyphAt(l,h)}}throw new Error("unresolved choice")}return this.__getLeaves()}},{key:"__getLeaves",value:function(){Ne.start("[QuadTree] getLeaves");var t=new S,e=new Re;for(e.add(this);!e.isEmpty();){var n=e.poll();n.isLeaf()?t.add(n):e.addAll(pt.asList(n.children))}return Ne.stop("[QuadTree] getLeaves"),t}},{key:"__getLeavesSide",value:function(t){Ne.start("[QuadTree] getLeaves");var e=new S;return this.__getLeavesSideResult(t,e),Ne.stop("[QuadTree] getLeaves"),e}},{key:"__getLeavesRectangle",value:function(t){Ne.start("[QuadTree] getLeaves(Rectangle2D)");var e=new S;return this.__getLeavesRectangleResult(t,e),Ne.stop("[QuadTree] getLeaves(Rectangle2D)"),e}},{key:"__getLeavesGlyphAt",value:function(t,e){Ne.start("[QuadTree] getLeaves");var n=new S;return this.__getLeavesGlyphAtResult(t,e,n),Ne.stop("[QuadTree] getLeaves"),n}},{key:"getNeighbors",value:function(t){return this.neighbors.get(t.ordinal())}},{key:"getNonOrphanAncestor",value:function(){for(var t=this;t.isOrphan();)t=t.parent;return t}},{key:"getParent",value:function(){return this.parent}},{key:"getRectangle",value:function(){return this.cell}},{key:"getRoot",value:function(){return this.isRoot()?this:this.parent.getRoot()}},{key:"getSide",value:function(t){return new w(this.cell.getX()+(t===ct.RIGHT?this.cell.getWidth():0),this.cell.getY()+(t===ct.BOTTOM?this.cell.getHeight():0),t==ct.TOP||t===ct.BOTTOM?this.cell.getWidth():0,t==ct.RIGHT||t===ct.LEFT?this.cell.getHeight():0)}},{key:"getSize",value:function(){if(this.isLeaf())return 1;var t,e=1,n=b(this.children);try{for(n.s();!(t=n.n()).done;){e+=t.value.getSize()}}catch(t){n.e(t)}finally{n.f()}return e}},{key:"getTreeHeight",value:function(){if(this.isLeaf())return 0;var t,e=1,n=b(this.children);try{for(n.s();!(t=n.n()).done;){var r=t.value.getTreeHeight();e=Math.max(e,r+1)}}catch(t){n.e(t)}finally{n.f()}return e}},{key:"getWidth",value:function(){return this.cell.getWidth()}},{key:"getX",value:function(){return this.cell.getX()}},{key:"getY",value:function(){return this.cell.getY()}},{key:"insert",value:function(t,e){if(et.count("QuadTree insert"),F.__intersectAtGlyphRectangle(t,this.cell)>e+G.EPS)return et.count("QuadTree insert",!1),0;et.count("QuadTree insert",!0),Ne.start("[QuadTree] insert");var n=0;if(this.isLeaf())this.glyphs.contains(t)||(this.glyphs.add(t),t.addCell(this),n=1);else{var r,i=b(this.children);try{for(i.s();!(r=i.n()).done;){n+=r.value.insert(t,e)}}catch(t){i.e(t)}finally{i.f()}}return Ne.stop("[QuadTree] insert"),n}},{key:"insertCenterOf",value:function(t){return et.count("QuadTree insertCenterOf"),t.getX()<this.cell.getMinX()||t.getX()>this.cell.getMaxX()||t.getY()<this.cell.getMinY()||t.getY()>this.cell.getMaxY()?(et.count("QuadTree insertCenterOf",!1),!1):(et.count("QuadTree insertCenterOf",!0),Ne.start("[QuadTree] insert"),this.isLeaf()&&this.glyphs.size()<m.MAX_GLYPHS_PER_CELL?(this.glyphs.contains(t)||(this.glyphs.add(t),t.addCell(this)),!0):(this.isLeaf()&&this.__split(),this.children[ct.quadrant(this.cell,t.getX(),t.getY())].insertCenterOf(t),Ne.stop("[QuadTree] insert"),!0))}},{key:"isOrphan",value:function(){return this._isOrphan}},{key:"isLeaf",value:function(){return null==this.children}},{key:"isRoot",value:function(){return null==this.parent}},{key:"iterator",value:function(){return new Ie(this)}},{key:Le,value:function(){return new Ie(this)}},{key:"iteratorGlyphsAlive",value:function(){return this.__getLeaves().stream().flatMap((function(t){return t.getGlyphsAlive().toArray()})).iterator()}},{key:"removeGlyph",value:function(t,e){return et.count("QuadTree remove"),null!=this.glyphs?et.count("QuadTree remove",this.glyphs.remove(t)):et.count("QuadTree remove",!1),null!=this.parent&&this.parent.joinMaybe(e)}},{key:"split",value:function(t){if("number"==typeof t)return this.__splitAt(t);if(void 0===t)return this.__split();throw new Error("better resolver")}},{key:"__split",value:function(){if(Ne.start("[QuadTree] split"),this.splitCell(),!this.glyphs.isEmpty()){var t,e=b(this.glyphs);try{for(e.s();!(t=e.n()).done;){var n=t.value;this.children[ct.quadrant(this.cell,n.getX(),n.getY())].insertCenterOf(n)}}catch(t){e.e(t)}finally{e.f()}this.glyphs=null}Ne.stop("[QuadTree] split")}},{key:"__splitAt",value:function(t){if(Ne.start("[QuadTree] split"),this.splitCell(),!this.glyphs.isEmpty()){var e,n=b(this.glyphs);try{for(n.s();!(e=n.n()).done;){var r=e.value;r.isAlive()&&this.insert(r,t)}}catch(t){n.e(t)}finally{n.f()}this.glyphs=null;var i,o=b(this.children);try{for(o.s();!(i=o.n()).done;){var a=i.value;a.glyphs.size()>m.MAX_GLYPHS_PER_CELL&&a.__splitAt(t)}}catch(t){o.e(t)}finally{o.f()}}Ne.stop("[QuadTree] split")}},{key:"toString",value:function(){return"".concat(t.name,"[cell = [").concat(this.cell.getMinX()," ; ").concat(this.cell.getMaxX(),"] x [").concat(this.cell.getMinY()," ; ").concat(this.cell.getMaxY(),"]]")}},{key:"__getLeavesGlyphAtResult",value:function(t,e,n){if(!(F.__intersectAtGlyphRectangle(t,this.cell)>e+G.EPS))if(this.isLeaf())n.add(this);else{var r,i=b(this.children);try{for(i.s();!(r=i.n()).done;){r.value.__getLeavesGlyphAtResult(t,e,n)}}catch(t){i.e(t)}finally{i.f()}}}},{key:"__getLeavesSideResult",value:function(t,e){this.__getLeavesSideRectangleResult(t,null,e)}},{key:"__getLeavesRectangleResult",value:function(t,e){if(G.intervalsOverlap([this.cell.getMinX(),this.cell.getMaxX()],[t.getMinX(),t.getMaxX()])&&G.intervalsOverlap([this.cell.getMinY(),this.cell.getMaxY()],[t.getMinY(),t.getMaxY()]))if(this.isLeaf())e.add(this);else{var n,r=b(this.children);try{for(r.s();!(n=r.n()).done;){n.value.__getLeavesRectangleResult(t,e)}}catch(t){r.e(t)}finally{r.f()}}}},{key:"__getLeavesSideRectangleResult",value:function(t,e,n){if(null!=e){var r=[null,null],i=[null,null];if(t==ct.TOP||t==ct.BOTTOM?(r[0]=e.getMinX(),r[1]=e.getMaxX(),i[0]=this.cell.getMinX(),i[1]=this.cell.getMaxX()):(r[0]=e.getMinY(),r[1]=e.getMaxY(),i[0]=this.cell.getMinY(),i[1]=this.cell.getMaxY()),!G.openIntervalsOverlap(r,i))return}if(this.isLeaf())n.add(this);else{var o,a=b(t.quadrants());try{for(a.s();!(o=a.n()).done;){var s=o.value;this.children[s].__getLeavesSideRectangleResult(t,e,n)}}catch(t){a.e(t)}finally{a.f()}}}},{key:"joinMaybe",value:function(t){if(Ne.start("[QuadTree] join"),this.isLeaf())return Ne.stop("[QuadTree] join"),!1;var e,n=0,r=b(this.children);try{for(r.s();!(e=r.n()).done;){var i=e.value;if(!i.isLeaf())return Ne.stop("[QuadTree] join"),!1;n+=i.getGlyphsAlive().size()}}catch(t){r.e(t)}finally{r.f()}if(n>m.MAX_GLYPHS_PER_CELL)return Ne.stop("[QuadTree] join"),!1;et.count("QuadTree join cells"),this.glyphs=new S(m.MAX_GLYPHS_PER_CELL);for(var o=0;o<this.children.length;++o){var a,s=this.children[o],u=b(s.getGlyphsAlive());try{for(u.s();!(a=u.n()).done;){var l=a.value;this.glyphs.contains(l)||(this.glyphs.add(l),l.addCell(this)),l.removeCell(s)}}catch(t){u.e(t)}finally{u.f()}s.glyphs=null,s._isOrphan=!0;var h,c=b(ct.quadrant(o));try{for(c.s();!(h=c.n()).done;){var p,f=h.value,y=this.neighbors.get(f.ordinal()),g=b(s.neighbors.get(f.ordinal()));try{for(g.s();!(p=g.n()).done;){var d=p.value;y.contains(d)||y.add(d)}}catch(t){g.e(t)}finally{g.f()}}}catch(t){c.e(t)}finally{c.f()}}var v,_=b(ct.values());try{for(_.s();!(v=_.n()).done;){var E,O=v.value,w=b(this.neighbors.get(O.ordinal()));try{for(w.s();!(E=w.n()).done;){var k,A=E.value.neighbors.get(O.opposite().ordinal()),C=b(this.children);try{for(C.s();!(k=C.n()).done;){var R=k.value;A.remove(R)}}catch(t){C.e(t)}finally{C.f()}A.add(this)}}catch(t){w.e(t)}finally{w.f()}}}catch(t){_.e(t)}finally{_.f()}return this.children=null,Ne.stop("[QuadTree] join"),null!=this.parent&&this.parent.joinMaybe(t),!0}},{key:"splitCell",value:function(){if(!this.isLeaf())throw new Error("cannot split cell that is already split");et.count("QuadTree split cell"),this.children=[null,null,null,null];var e=this.getX(),n=this.getY(),r=this.getWidth(),i=this.getHeight();if(r/2<m.MIN_CELL_SIZE||i/2<m.MIN_CELL_SIZE)throw new Error("cannot split a tiny cell");for(var o=0;o<4;++o)this.children[o]=new t(e+(o%2==0?0:r/2),n+(o<2?0:i/2),r/2,i/2),this.children[o].parent=this;var a,s=b(ct.values());try{for(s.s();!(a=s.n()).done;){var u,l=a.value,h=b(this.neighbors.get(l.ordinal()));try{for(h.s();!(u=h.n()).done;){var c=u.value,p=c.neighbors.get(l.opposite().ordinal());p.remove(this);var f,y=b(l.quadrants());try{for(y.s();!(f=y.n()).done;){var g=f.value;G.openIntervalsOverlap(ct.interval(this.children[g].cell,l),ct.interval(c.cell,l))&&p.add(this.children[g])}}catch(t){y.e(t)}finally{y.f()}}}catch(t){h.e(t)}finally{h.f()}}}catch(t){s.e(t)}finally{s.f()}var d,v=b(ct.values());try{for(v.s();!(d=v.n()).done;){var _,E=d.value,O=this.neighbors.get(E.ordinal()),w=b(E.quadrants());try{for(w.s();!(_=w.n()).done;){var k,A=_.value,C=ct.interval(this.children[A].cell,E),R=new S,j=b(O);try{for(j.s();!(k=j.n()).done;){var L=k.value;G.openIntervalsOverlap(C,ct.interval(L.cell,E))&&R.add(L)}}catch(t){j.e(t)}finally{j.f()}this.children[A].neighbors.get(E.ordinal()).addAll(R.toArray()),this.children[A].neighbors.get(E.opposite().ordinal()).add(this.children[ct.quadrantNeighbor(A,E.opposite())])}}catch(t){w.e(t)}finally{w.f()}O.clear()}}catch(t){v.e(t)}finally{v.f()}}}]),t}(),Ie=function(){function t(n){e(this,t),i(this,"toVisit",void 0),this.toVisit=new Se,this.toVisit.add(n)}return r(t,[{key:"isDone",value:function(){return this.toVisit.isEmpty()}},{key:"next",value:function(){var t=this.toVisit.poll();return t.isLeaf()||this.toVisit.addAll(t.children),{value:t,done:this.isDone()}}}]),t}(),Ge=function(){function t(n,r){e(this,t),i(this,"glyph",void 0),i(this,"at",void 0),i(this,"createdFrom",void 0),this.glyph=n,this.at=r;for(var o=arguments.length,a=new Array(o>2?o-2:0),s=2;s<o;s++)a[s-2]=arguments[s];0===a.length?this.createdFrom=null:this.createdFrom=S.__new(Array.from(a))}return r(t,[{key:"alsoCreatedFrom",value:function(t){null==this.createdFrom&&(this.createdFrom=new S(2)),this.createdFrom.contains(t)||this.createdFrom.add(t)}},{key:"compareTo",value:function(t){return Math.sign(this.at-t.at)}},{key:"getAt",value:function(){return this.at}},{key:"getGlyph",value:function(){return this.glyph}},{key:"setGlyph",value:function(t){this.glyph=t}},{key:"toString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,o=e+"  ",a=new I(e);if(a.append(t.name),a.append("[\n"),a.append(o),a.append(this.glyph.toString()),a.append(" at "),a.append(this.at),null==this.createdFrom)a.append("\n");else if(a.append("from (".concat(this.createdFrom.size(),")\n")),n){this.createdFrom.sort((function(t,e){var n=Math.sign(e.getAt()-t.getAt());return 0===n?e.getGlyph().getN()-t.getGlyph().getN():n}));var s,u=0,l=b(this.createdFrom);try{for(l.s();!(s=l.n()).done;){var h=s.value;if(a.append(h.toString(o,r,r,i)),++u==i)break}}catch(t){l.e(t)}finally{l.f()}u<this.createdFrom.size()&&(a.append(o),a.append("... (").append(this.createdFrom.size()-u).append(" more)\n"))}return a.append(e),a.append("]\n"),a.toString()}}]),t}();var Pe,Be,Fe=m.LOGGING_ENABLED&&null!==(Pe=Be=Q.getLogger("FirstMergeRecorder"))&&void 0!==Pe&&Pe.isLoggable(q.FINER)?Be:null,De=function(){function t(){e(this,t),i(this,"at",void 0),i(this,"glyphs",void 0),i(this,"size",void 0),this.at=S.__new(pt.nCopies(m.MAX_MERGES_TO_RECORD,Number.POSITIVE_INFINITY)),this.glyphs=new S(m.MAX_MERGES_TO_RECORD);for(var n=0;n<m.MAX_MERGES_TO_RECORD;++n)this.glyphs.add(new S(1));this.size=0,null!==Fe&&Fe.log(q.FINER,"constructed an empty FirstMerge ####")}return r(t,[{key:"accept",value:function(t,e){null!==Fe&&Fe.log(q.FINER,"accepting ".concat(e," into ####"));for(var n=F.__intersectAtGlyphGlyph(t._from,e),r=0;r<m.MAX_MERGES_TO_RECORD;++r){if(n<this.at.get(r)){Number.isFinite(this.at.get(r))||this.size++,this.at.size()===m.MAX_MERGES_TO_RECORD&&(this.at.removeI(this.at.size()-1),this.glyphs.addI(r,this.glyphs.removeI(this.glyphs.size()-1))),this.at.addI(r,n),this.glyphs.get(r).clear(),this.glyphs.get(r).add(e);break}if(n==this.at.get(r)){this.glyphs.get(r).add(e);break}}null!==Fe&&Fe.log(q.FINER,"#### now has glyphs ".concat(this.glyphs.toArray().join(", ")," at [").concat(this.at.toArray().join(", "),"]"))}},{key:"combine",value:function(t){null!=Fe&&Fe.log(q.FINER,"combining #### and ####;\n#### has glyphs ".concat(this.glyphs.toArray().join(", ")," at ").concat(this.at,";\n#### has glyphs ").concat(t.glyphs.toArray().join(", ")," at ").concat(t.at));for(var e=0,n=0,r=ze.COMBINE_RESULT,i=0;i<m.MAX_MERGES_TO_RECORD;++i)t.at.get(n)<this.at.get(e)?(G.swap(r.at,i,t.at,n),G.swap(r.glyphs,i,t.glyphs,n),n++):G.Double.eq(t.at.get(n),this.at.get(e))?(
//! } else if (that.at.get(thatInd) == this.at.get(thisInd)) {
//! } else if (that.at.get(thatInd).equals(this.at.get(thisInd))) {
G.swap(r.at,i,t.at,n),G.swap(r.glyphs,i,t.glyphs,n),r.glyphs.get(i).addAll(this.glyphs.get(e).toArray()),e++,n++):(G.swap(r.at,i,this.at,e),G.swap(r.glyphs,i,this.glyphs,e),e++),r.size++;null!==Fe&&Fe.log(q.FINER,"result #### of merging #### and #### has glyphs ".concat(r.glyphs.toArray().join(", ")," at ").concat(r.at," (storing in #### now)"));var o=this.at;this.at=r.at,r.at=o;var a=this.glyphs;return this.glyphs=r.glyphs,r.glyphs=a,this.size=r.size,r.reset(),this}},{key:"getGlyphs",value:function(){return this.glyphs.get(0)}},{key:"reset",value:function(){this.resizeIfNeeded();for(var t=0;t<m.MAX_MERGES_TO_RECORD;++t)this.at.set(t,Number.POSITIVE_INFINITY),this.glyphs.get(t).clear();this.size=0}},{key:"resizeIfNeeded",value:function(){var t=m.MAX_MERGES_TO_RECORD,e=this.at.size();if(e<t)for(var n=e;n<t;++n)this.at.add(Number.POSITIVE_INFINITY),this.glyphs.add(new S(1));else if(e>t)for(var r=e-1;r>=t;--r)this.at.removeI(r),this.glyphs.removeI(r)}},{key:"pop",value:function(t){if(0===this.size)return null;var e=this.at.get(0);pt.rotate(this.at,1);var n=this.glyphs.get(0);pt.rotate(this.glyphs,1),this.size--;var r,i=new Array(n.size()),o=0,a=b(n);try{for(a.s();!(r=a.n()).done;){var s=r.value;i[o++]=new Y(t,s,m.ROBUST?F.__intersectAtGlyphGlyph(t,s):e)}}catch(t){a.e(t)}finally{a.f()}return i}}]),t}(),ze=function(){function t(){e(this,t),i(this,"_from",void 0),i(this,"merge",void 0),this._from=null,this.merge=new De}return r(t,[{key:"addEventsTo",value:function(e){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(m.ROBUST){var i,o=b(this.merge.getGlyphs());try{for(o.s();!(i=o.n()).done;){var a=i.value;e.add(new Y(this._from,a))}}catch(t){o.e(t)}finally{o.f()}this.merge.getGlyphs().clear()}else{for(;null!==(n=this.merge.pop(this._from));){var s,u=b(n);try{for(u.s();!(s=u.n()).done;){var l=s.value;null!==Fe&&Fe.log(q.FINE,"recorded ".concat(l)),this._from.__recordG(l)}}catch(t){u.e(t)}finally{u.f()}}this._from.popMergeInto(e,r)}t.firstReusedRecord=null}},{key:"collector",value:function(){var e=this;return void 0===t.collector&&(t.collector=function(n){return n.reduce((function(t,n){return t.accept(e,n),t}),t.newInstance())}),t.collector}},{key:"from",value:function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}((function(t){null!==Fe&&Fe.log(q.FINE,"recording merges from ".concat(t)),this._from=t,this.merge.reset()}))},{key:"record",value:function(t,e,n){if(Array.isArray(t)&&void 0!==e&&void 0!==n)return this.__recordGlyphNumberNumber(t,e,n);if(t instanceof j)return this.__recordStream(t);if(t instanceof S)return this.__recordArrayList(t);throw new Error("failed to find a way")}},{key:"__recordGlyphNumberNumber",value:function(t,e,n){this.__recordStream(pt.stream(t,e,n))}},{key:"__recordArrayList",value:function(t){null!==t&&this.__recordStream(t.stream())}},{key:"__recordStream",value:function(t){var e=this,n=t.filter((function(t){return t.isAlive()&&t!=e._from}));m.ROBUST?this.merge.getGlyphs().addAll(n.collect(C.toSet())):this.merge.combine(n.collect(this.collector()))}},{key:"recordAllPairs",value:function(t,e){for(var n=t.getGlyphs().toArray(),r=0;r<n.length;++r)this.from(n[r]),Ne.start("first merge recording 5"),this.__recordGlyphNumberNumber(n,r+1,n.length),Ne.stop("first merge recording 5"),this.addEventsTo(e)}}],[{key:"getInstance",value:function(){var e;return null!==(e=this.INSTANCE)&&void 0!==e?e:this.INSTANCE=new t}},{key:"newInstance",value:function(){if(this.REUSABLE_RECORDS.size()>0&&(null==this.firstReusedRecord||this.REUSABLE_RECORDS.getLast()!=this.firstReusedRecord)){var t=this.REUSABLE_RECORDS.pollLast();return this.REUSABLE_RECORDS.addFirst(t),null===this.firstReusedRecord&&(this.firstReusedRecord=t),t}var e=new De;return this.REUSABLE_RECORDS.addFirst(e),null===this.firstReusedRecord&&(this.firstReusedRecord=e),e}}]),t}();i(ze,"collector",void 0),i(ze,"INSTANCE",void 0),i(ze,"REUSABLE_RECORDS",new Re),i(ze,"COMBINE_RESULT",new De),i(ze,"firstReusedRecord",null);var qe=function(t){o(s,t);var n=f(s);function s(t,r){var o;e(this,s);var a=r,u=null;return"number"==typeof t?a=t:u=t,i(c(o=n.call(this,a)),"counts",void 0),i(c(o),"id",void 0),i(c(o),"next",void 0),i(c(o),"root",void 0),o.counts=null===u?[0,0,0]:null,o.id=null===u?0:u.id+1,o.next=null,o.root=null===u?c(o):u.root,o}return r(s,[{key:"getDeletions",value:function(){return this.getCount(s.DELETION)}},{key:"getDiscarded",value:function(){return this.getCount(s.DISCARD)}},{key:"getInsertions",value:function(){return this.getCount(s.INSERTION)}},{key:"getNumQueues",value:function(){for(var t=this;null!==t.next;)t=t.next;return t.id+1}},{key:"add",value:function(t){this.count(s.INSERTION),this===this.root&&Ne.start("queue operations");var e=y(a(s.prototype),"add",this).call(this,t);return this===this.root&&(Ne.stop("queue operations"),et.record(t.getType().toString(),1)),e}},{key:"discard",value:function(){this.count(s.DISCARD),this._pollString(" discarded")}},{key:"peek",value:function(){var t=y(a(s.prototype),"peek",this).call(this);if(null!==this.next){var e=this.next.peek();(null==t||null!=e&&e.getAt()<t.getAt())&&(t=e)}return t}},{key:"poll",value:function(){return this.count(s.DELETION),this._pollString(" handled")}},{key:"_pollString",value:function(t){Ne.start("queue operations");var e=this.peek();return this._pollEvent(e),Ne.stop("queue operations"),et.record("queue size",this.size()),et.record(e.getType().toString()+t,1),e}},{key:"_pollEvent",value:function(t){y(a(s.prototype),"peek",this).call(this)!=t?this.next._pollEvent(t):y(a(s.prototype),"poll",this).call(this)}},{key:"size",value:function(){return this.root.sizeNoPrev()}},{key:"count",value:function(t){this.root.counts[t]++}},{key:"getCount",value:function(t){return this.root.counts[t]}},{key:"sizeNoPrev",value:function(){return y(a(s.prototype),"size",this).call(this)+(null==this.next?0:this.next.sizeNoPrev())}}]),s}(T);i(qe,"INSERTION",0),i(qe,"DELETION",1),i(qe,"DISCARD",2);var Xe=function t(n){e(this,t),i(this,"nestedMerges",new T),i(this,"createdFromTmp",[null,null]),i(this,"trackersNeedingUpdate",new S),i(this,"orphanedCells",new S),i(this,"map",void 0),i(this,"numAlive",0),i(this,"glyphSize",new Z),i(this,"bigGlyphs",new S(2)),i(this,"mergedBigGlyph",!1),this.map=n},Ye=m.LOGGING_ENABLED?Q.getLogger("QuadTreeClusterer"):null,He=function(){function t(n){e(this,t),i(this,"tree",void 0),i(this,"result",void 0),i(this,"rec",void 0),this.tree=n,this.result=null,this.rec=null}return r(t,[{key:"cluster",value:function(){var e=null==Ye?null:Ye.getLevel();if(null!=Ye&&(Ye.log(q.FINER,"ENTRY into AgglomerativeClustering#cluster()"),Ye.log(q.FINE,"clustering using ".concat(G.join(" + ",m.ROBUST?"ROBUST":"",m.TRACK&&!m.ROBUST?"TRACK":"",m.ROBUST||m.TRACK?"":"FIRST MERGE ONLY","NO BUCKETING")," strategy")),Ye.log(q.FINE,"using the Linear Area Growing Circles grow function"),Ye.log(q.FINE,"QuadTree has ".concat(this.tree.getSize()," nodes and height ").concat(this.tree.getTreeHeight(),", having at most ").concat(m.MAX_GLYPHS_PER_CELL," glyphs per cell and cell size at least ").concat(m.MIN_CELL_SIZE.toExponential())),Ye.isLoggable(q.FINE))){var n,r=0,i=b(this.tree.__getLeaves());try{for(i.s();!(n=i.n()).done;){var o=n.value;et.record("glyphs per cell",o.getGlyphs().size());var a,s=b(o.getGlyphs());try{for(s.s();!(a=s.n()).done;){r+=a.value.getN()}}catch(t){s.e(t)}finally{s.f()}}}catch(t){i.e(t)}finally{i.f()}et.record("total # works",r)}m.TIMERS_ENABLED&&Ne.start("clustering");var u=new qe(10*G.size(this.tree.iteratorGlyphsAlive())),l=new J;this.rec=ze.getInstance();var h,c,p=new Xe(l),f=this.tree.getRectangle(),y=b(this.tree.__getLeaves());try{for(y.s();!(h=y.n()).done;)for(var g=h.value,d=g.getGlyphs().toArray(),v=0;v<d.length;++v){null!==Ye&&Ye.log(q.FINEST,d[v].toString()),this.rec.from(d[v]),m.TIMERS_ENABLED&&Ne.start("first merge recording 1"),this.rec.__recordGlyphNumberNumber(d,v+1,d.length),m.TIMERS_ENABLED&&Ne.stop("first merge recording 1"),this.rec.addEventsTo(u,Ye);var _,E=b(ct.values());try{for(E.s();!(_=E.n()).done;){var O=_.value;G.onBorderOf(g.getSide(O),f)||d[v].record(new H(d[v],g,O))}}catch(t){E.e(t)}finally{E.f()}if(d[v].popOutOfCellInto(u,Ye),l.put(d[v],new Ge(d[v],0)),p.numAlive++,p.glyphSize.record(d[v].getN()),!d[v].isAlive())return null!=Ye&&Ye.log(q.SEVERE,"unexpected dead glyph in input"),null}}catch(t){y.e(t)}finally{y.f()}for(null!=Ye&&Ye.log(q.FINE,"created ".concat(u.size()," events initially, for ").concat(p.numAlive," glyphs"));null!==(c=t.getNextEvent(u,p));){if(null!==Ye){if(Ye.getLevel()>q.FINER){var w,k=b(c.getGlyphs());try{for(k.s();!(w=k.n()).done;){if(w.value.track){Ye.setLevel(q.FINEST);break}}}catch(t){k.e(t)}finally{k.f()}}Ye.log(q.FINER,"handling ".concat(c.getType()," at ").concat(c.getAt().toFixed(3)," involving"));var A,C=b(c.getGlyphs());try{for(C.s();!(A=C.n()).done;){var S=A.value;Ye.log(q.FINER,S.toString())}}catch(t){C.e(t)}finally{C.f()}}switch(c.getType()){case z.MERGE:var R,j=!1,L=b(c.getGlyphs());try{for(L.s();!(R=L.n()).done;){var M=R.value;j=j||M.track}}catch(t){L.e(t)}finally{L.f()}var N,x=null,T=!1,I=b(c.getGlyphs());try{for(I.s();!(N=I.n()).done;){var P=N.value;if(P.isBig()){if(null!=x){x=null,T=!0;break}x=P}}}catch(t){I.e(t)}finally{I.f()}null===x?(T?et.count("merge big/big"):et.count("merge small/small"),this.handleGlyphMerge(c,p,u,j)):(et.count("merge small/big"),this.handleBigGlyphMerge(c,p,u,j));break;case z.OUT_OF_CELL:m.TIMERS_ENABLED&&Ne.start("out of cell event processing"),this.handleOutOfCell(c,l,!1,u),m.TIMERS_ENABLED&&Ne.stop("out of cell event processing")}this.step(),null!==Ye&&Ye.setLevel(e)}if(null!=Ye){Ye.isLoggable(q.FINE)&&et.record("total # works",this.result.getGlyph().getN()),Ye.log(q.FINE,"created ".concat(u.getInsertions()," events, handled ").concat(u.getDeletions()," and discarded ").concat(u.getDiscarded(),"; ").concat(u.getInsertions()-u.getDeletions()-u.getDiscarded()," events were never considered"));var B,F=b(z.values());try{for(F.s();!(B=F.n()).done;){var D=B.value.toString(),X=et.get(D);Ye.log(q.FINE,"→ ".concat(X.getSum()," ").concat(D,"s (").concat(et.get(D+" handled").getSum()," handled, ").concat(et.get(D+" discarded").getSum()," discarded)")),et.remove(D),et.remove(D+" handled"),et.remove(D+" discarded")}}catch(t){F.e(t)}finally{F.f()}Ye.log(q.FINE,"events were stored in ".concat(u.getNumQueues()," queue(s)")),Ye.log(q.FINE,"QuadTree has ".concat(this.tree.getSize()," nodes and height ").concat(this.tree.getTreeHeight()," now")),et.logAll(Ye)}return m.TIMERS_ENABLED&&Ne.logAll(Ye),null!=Ye&&Ye.log(q.FINER,"RETURN from AgglomerativeClustering#cluster()"),this}},{key:"getName",value:function(){return"QuadTree Clusterer"}},{key:"findOverlap",value:function(t,e,n,r){var i,o,a=!1,s=b(this.tree.__getLeavesGlyphAt(t,e));try{for(s.s();!(o=s.n()).done;){var u,l=b(o.value.getGlyphsAlive());try{for(l.s();!(u=l.n()).done;){var h=u.value;(i=F.__intersectAtGlyphGlyph(t,h))<=e&&(a=!0,n.add(new Y(null,h,i)))}}catch(t){l.e(t)}finally{l.f()}}}catch(t){s.e(t)}finally{s.f()}var c,p=b(r);try{for(p.s();!(c=p.n()).done;){var f=c.value;f!==t&&(i=F.__intersectAtGlyphGlyph(t,f))<=e&&(a=!0,n.add(new Y(null,f,i)))}}catch(t){p.e(t)}finally{p.f()}return a}},{key:"handleBigGlyphMerge",value:function(t,e,n,r){m.TIMERS_ENABLED&&Ne.start("[merge event processing] big");var i=this.processNestedMerges(t,e,n,r);if(i.isBig())if(e.mergedBigGlyph)this.initializeBigGlyphEvents(i,e);else{var o,a=b(t.getGlyphs());try{for(a.s();!(o=a.n()).done;){var s=o.value;s.isBig()&&i.adoptUncertainMergeEvents(s,t)}}catch(t){a.e(t)}finally{a.f()}}else{var u,l=b(e.bigGlyphs);try{for(l.s();!(u=l.n()).done;){var h=u.value;h.record(new U(new Y(h,i)))}}catch(t){l.e(t)}finally{l.f()}this.recordEventsForGlyph(i,t.getAt(),n)}this.recordGlyphAndStats(i,e,r),m.TIMERS_ENABLED&&Ne.stop("[merge event processing] big")}},{key:"handleGlyphMerge",value:function(t,e,n,r){var i=this.processNestedMerges(t,e,n,r);if(i.isBig())this.initializeBigGlyphEvents(i,e);else{var o,a=b(e.bigGlyphs);try{for(a.s();!(o=a.n()).done;){var s=o.value;s.record(new U(new Y(s,i)))}}catch(t){a.e(t)}finally{a.f()}this.recordEventsForGlyph(i,t.getAt(),n)}this.recordGlyphAndStats(i,e,r)}},{key:"handleOutOfCell",value:function(t,e,n,r){var i=t.getGlyphs()[0];if(n&&G.Double.neq(e.get(i).getAt(),t.getAt())){var o=new Ge(i,t.getAt(),e.get(i));e.put(i,o)}var a=t.getCell().getNonOrphanAncestor();if(t.getCell()!==a&&!G.onBorderOf(t.getCell().getSide(t.getSide()),a.getRectangle()))return i.record(new H(i,a,t.getSide())),void i.popOutOfCellInto(r,Ye);var s=t.getAt(),u=t.getSide().opposite(),l=ct.interval(F.sizeAt(i,s).getBounds2D(),t.getSide());null!==Ye&&Ye.log(q.FINER,"size at border is [".concat(l,"]"));var h=a.getNeighbors(t.getSide()).copy();null!==Ye&&Ye.log(q.FINEST,"growing out of ".concat(t.getSide()," of ").concat(t.getCell()," into"));var c,p=b(h);try{for(p.s();!(c=p.n()).done;){var f=c.value;if(null!==Ye&&Ye.log(q.FINEST,f.toString()),G.intervalsOverlap(ct.interval(f.getSide(u),u),l))if(null!==f.getGlyphs()&&f.getGlyphs().contains(i))null!==Ye&&Ye.log(q.FINEST,"→ but was already in there, so ignoring"),i.popOutOfCellInto(r,Ye);else{f.insert(i,s);var y=void 0;if(null!==f.getGlyphs()&&f.getGlyphs().size()>m.MAX_GLYPHS_PER_CELL){if(f.__splitAt(s),y=f.__getLeavesGlyphAt(i,s),null!==Ye&&Ye.isLoggable(q.FINE)){var g,d=b(f.__getLeaves());try{for(d.s();!(g=d.n()).done;){var v=g.value;et.record("glyphs per cell",v.getGlyphsAlive().size())}}catch(t){d.e(t)}finally{d.f()}}}else y=f.__getLeaves();this.rec.from(i);var _,E=b(y);try{for(E.s();!(_=E.n()).done;){var O=_.value;Ne.start("first merge recording 4"),this.rec.__recordArrayList(O.getGlyphs()),Ne.stop("first merge recording 4");var w,k=b(t.getSide().opposite().others());try{for(k.s();!(w=k.n()).done;){var A=w.value,C=F.exitAt(i,O,A);if(C>=s){var S,R=!1,j=b(O.getNeighbors(A));try{for(j.s();!(S=j.n()).done;){if(!S.value.getGlyphs().contains(i)){R=!0;break}}}catch(t){j.e(t)}finally{j.f()}if(!R)continue;null!==Ye&&Ye.log(q.FINEST,"→ out of ".concat(A," of ").concat(O," at ").concat(C.toFixed(3))),i.record(new H(i,O,A,C))}}}catch(t){k.e(t)}finally{k.f()}}}catch(t){E.e(t)}finally{E.f()}i.popOutOfCellInto(r,Ye),this.rec.addEventsTo(r,Ye)}else null!==Ye&&Ye.log(q.FINEST,"→ but not at this point in time, so ignoring")}}catch(t){p.e(t)}finally{p.f()}}},{key:"initializeBigGlyphEvents",value:function(t,e){var n,r=b(e.bigGlyphs);try{for(r.s();!(n=r.n()).done;){var i=n.value;t.record(new U(new Y(t,i)))}}catch(t){r.e(t)}finally{r.f()}var o,a=b(this.tree.iteratorGlyphsAlive());try{for(a.s();!(o=a.n()).done;){var s=o.value;t.record(new U(new Y(t,s)))}}catch(t){a.e(t)}finally{a.f()}}},{key:"processNestedMerges",value:function(t,e,n,r){m.TIMERS_ENABLED&&(Ne.start("[merge event processing] total"),r&&Ne.start("[merge event processing] total (track)")),e.nestedMerges.add(t),e.mergedBigGlyph=!1;var i=null,o=null,a=t.getAt();m.TIMERS_ENABLED&&Ne.start("[merge event processing] nested merges");do{t:for(;!e.nestedMerges.isEmpty();){var s,u=b((t=e.nestedMerges.poll()).getGlyphs());try{for(u.s();!(s=u.n()).done;){var h=s.value;if(null!==h&&!h.isAlive())continue t}}catch(t){u.e(t)}finally{u.f()}null!==Ye&&Ye.log(q.FINEST,"handling nested "+t),null===o?(i=new st(t.getGlyphs()),o=l(Ge,[i,a].concat(d(G.map(t.getGlyphs(),e.map,e.createdFromTmp))))):(o.alsoCreatedFrom(e.map.get(t.getGlyphs()[1])),i=new st(i,t.getGlyphs()[1]),o.setGlyph(i),t.getGlyphs()[1].isBig()?(e.mergedBigGlyph=!0,et.count("merge nested big")):et.count("merge nested small"));var c,p=b(t.getGlyphs());try{for(p.s();!(c=p.n()).done;){var f=c.value;if(null!==f&&f.isAlive()){f.perish(),e.numAlive--,e.glyphSize.unrecord(f.getN()),f.isBig()&&e.bigGlyphs.remove(f);var y,g=b(f.getCells().copy());try{for(g.s();!(y=g.n()).done;){var v=y.value;v.removeGlyph(f,a)&&e.orphanedCells.add(v)}}catch(t){g.e(t)}finally{g.f()}if(m.TRACK&&!m.ROBUST){var _,E=b(f.trackedBy);try{for(E.s();!(_=E.n()).done;){var O=_.value;e.trackersNeedingUpdate.contains(O)||e.trackersNeedingUpdate.add(O)}}catch(t){E.e(t)}finally{E.f()}}}}}catch(t){p.e(t)}finally{p.f()}null!==Ye&&Ye.log(q.FINEST,"→ merged glyph is ".concat(i))}}while(this.findOverlap(i,a,e.nestedMerges,e.bigGlyphs));m.TIMERS_ENABLED&&(Ne.stop("[merge event processing] nested merges"),Ne.start("[merge event processing] merge events in joined cells"));var w,k=new A,C=b(e.orphanedCells);try{for(C.s();!(w=C.n()).done;){var S=w.value.getNonOrphanAncestor();k.add(S)&&(m.TIMERS_ENABLED&&Ne.start("record all pairs"),this.rec.recordAllPairs(S.getNonOrphanAncestor(),n),m.TIMERS_ENABLED&&Ne.stop("record all pairs"))}}catch(t){C.e(t)}finally{C.f()}if(e.orphanedCells.clear(),m.TIMERS_ENABLED&&(Ne.stop("[merge event processing] merge events in joined cells"),Ne.start("[merge event processing] tracker updating")),m.TRACK&&!m.ROBUST){var R,j=b(e.trackersNeedingUpdate);try{for(j.s();!(R=j.n()).done;){var L=R.value;if(L.isAlive()&&(et.record("orphan cells",L.getCells().size()),!L.popMergeInto(n,Ye))){this.rec.from(L),m.TIMERS_ENABLED&&Ne.start("first merge recording 2");var M,N=b(L.getCells());try{for(N.s();!(M=N.n()).done;){var x=M.value;this.rec.__recordArrayList(x.getGlyphs())}}catch(t){N.e(t)}finally{N.f()}m.TIMERS_ENABLED&&Ne.stop("first merge recording 2"),this.rec.addEventsTo(n,Ye)}}}catch(t){j.e(t)}finally{j.f()}e.trackersNeedingUpdate.clear()}return m.TIMERS_ENABLED&&(Ne.stop("[merge event processing] tracker updating"),Ne.start("[merge event processing] merged glyph insert")),i.setBig(e.glyphSize),i.isBig()||(this.tree.insert(i,a),null!==Ye&&Ye.log(q.FINER,"inserted merged glyph into ".concat(i.getCells().size()," cells"))),m.TIMERS_ENABLED&&Ne.stop("[merge event processing] merged glyph insert"),e.map.put(i,o),this.result=o,i}},{key:"recordGlyphAndStats",value:function(t,e,n){t.participate(),e.numAlive++,e.glyphSize.record(t.getN()),t.isBig()&&(et.record("merged cells big glyphs",t.getCells().size()),et.record("glyphs around big glyphs",t.getCells().stream().mapToInt((function(t){return t.getGlyphsAlive().size()})).sum()),e.bigGlyphs.add(t),et.record("number of big glyphs",e.bigGlyphs.size())),m.TIMERS_ENABLED&&(Ne.stop("[merge event processing] total"),n&&Ne.stop("[merge event processing] total (track)"))}},{key:"recordEventsForGlyph",value:function(t,e,n){m.TIMERS_ENABLED&&Ne.start("[merge event processing] merge event recording"),this.rec.from(t),et.record("merged cells",t.getCells().size());var r,i=b(t.getCells());try{for(i.s();!(r=i.n()).done;){var o=r.value;m.TIMERS_ENABLED&&Ne.start("first merge recording 3"),this.rec.__recordArrayList(o.getGlyphs()),m.TIMERS_ENABLED&&Ne.stop("first merge recording 3");var a,s=b(ct.values());try{for(s.s();!(a=s.n()).done;){var u=a.value,l=!1;m.TIMERS_ENABLED&&Ne.start("neighbor finding");var h=o.getNeighbors(u);m.TIMERS_ENABLED&&Ne.stop("neighbor finding");var c,p=b(h);try{for(p.s();!(c=p.n()).done;){if(!c.value.getGlyphs().contains(t)){l=!0;break}}}catch(t){p.e(t)}finally{p.f()}if(l){var f=new H(t,o,u);f.getAt()>e&&(t.record(f),null!==Ye&&Ye.log(q.FINEST,"→ out of ".concat(u," of ").concat(o," at ").concat(f.getAt().toFixed(3))))}}}catch(t){s.e(t)}finally{s.f()}}}catch(t){i.e(t)}finally{i.f()}t.popOutOfCellInto(n,Ye),this.rec.addEventsTo(n,Ye),m.TIMERS_ENABLED&&Ne.stop("[merge event processing] merge event recording")}},{key:"step",value:function(){m.STATS_ENABLED&&(et.record("QuadTree cells",G.size(this.tree.iterator())),et.record("QuadTree leaves",this.tree.__getLeaves().size()),et.record("QuadTree height",this.tree.getTreeHeight()))}},{key:"getClustering",value:function(){return this.result}},{key:"reset",value:function(){this.result=null}}],[{key:"getNextEvent",value:function(t,e){if(e.numAlive<=1)return null;var n=null,r=null;t:for(;!t.isEmpty();){if((n=t.peek()).getType()!=z.OUT_OF_CELL||n.getCell().isLeaf()){var i,o=b(n.getGlyphs());try{for(o.s();!(i=o.n()).done;){if(!i.value.isAlive()){t.discard();continue t}}}catch(t){o.e(t)}finally{o.f()}n=r=t.peek();break}t.discard()}var a,s=null,u=b(e.bigGlyphs);try{for(u.s();!(a=u.n()).done;){var l=a.value;null==Ye||Ye.log(q.FINER,"searching for uncertain merge on ".concat(l));var h=l.peekUncertain();null==Ye||Ye.log(q.FINER,"found ".concat(h)),(null==n||null!=h&&h.getAt()<n.getAt())&&(n=h.getGlyphMerge(),s=l)}}catch(t){u.e(t)}finally{u.f()}return null!==n&&(n===r?t.poll():s.pollUncertain()),n}}]),t}();t.Constants=m,t.QuadTree=Te,t.QuadTreeClusterer=He,Object.defineProperty(t,"__esModule",{value:!0})}));
