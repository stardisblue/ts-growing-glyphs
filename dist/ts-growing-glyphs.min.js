!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).GrowingGlyphs={})}(this,(function(t){"use strict";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function i(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),t}function o(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&u(t,e)}function s(t){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function u(t,e){return(u=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function l(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function h(t,e,n){return(h=l()?Reflect.construct:function(t,e,n){var r=[null];r.push.apply(r,e);var i=new(Function.bind.apply(t,r));return n&&u(i,n.prototype),i}).apply(null,arguments)}function c(t){var e="function"==typeof Map?new Map:void 0;return(c=function(t){if(null===t||(n=t,-1===Function.toString.call(n).indexOf("[native code]")))return t;var n;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,r)}function r(){return h(t,arguments,s(this).constructor)}return r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),u(r,t)})(t)}function p(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function f(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?p(t):e}function y(t){var e=l();return function(){var n,r=s(t);if(e){var i=s(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return f(this,n)}}function g(t,e,n){return(g="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=s(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(n):i.value}})(t,e,n||t)}function d(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(t){i=!0,o=t}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return n}(t,e)||_(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function v(t){return function(t){if(Array.isArray(t))return b(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||_(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _(t,e){if(t){if("string"==typeof t)return b(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?b(t,e):void 0}}function b(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function m(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=_(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}var E={MIN_CELL_SIZE:1e-8,BIG_GLYPH_FACTOR:100,MAX_GLYPHS_PER_CELL:10,MAX_MERGES_TO_RECORD:4,BIG_GLYPHS:!1,ROBUST:!1,TRACK:!0,LOGGING_ENABLED:!0,STATS_ENABLED:!1,TIMERS_ENABLED:!0};function O(t){return null===t||t instanceof k}var w,k=function(){function t(e,r,i,a){n(this,t),o(this,"x",void 0),o(this,"y",void 0),o(this,"width",void 0),o(this,"height",void 0),this.x=e,this.y=r,this.width=i,this.height=a}return i(t,[{key:"getX",value:function(){return this.x}},{key:"getWidth",value:function(){return this.width}},{key:"getY",value:function(){return this.y}},{key:"getHeight",value:function(){return this.height}},{key:"getMinX",value:function(){return this.x}},{key:"getMaxX",value:function(){return this.x+this.width}},{key:"getMinY",value:function(){return this.y}},{key:"getMaxY",value:function(){return this.y+this.height}},{key:"contains",value:function(t,e){var n=this.getX(),r=this.getY();return t>=n&&e>=r&&t<n+this.getWidth()&&e<r+this.getHeight()}},{key:"getCenterX",value:function(){return this.getX()+this.getWidth()/2}},{key:"getCenterY",value:function(){return this.getY()+this.getHeight()/2}}]),t}();w=Symbol.iterator;var A,C=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;n(this,t),o(this,"__internal",void 0),this.__internal=new Set(e)}return i(t,[{key:"add",value:function(t){return!this.__internal.has(t)&&(this.__internal.add(t),!0)}},{key:w,value:function(){return this.__internal[Symbol.iterator]()}}]),t}(),L=function(){function t(){n(this,t)}return i(t,null,[{key:"toCollection",value:function(t){return t}},{key:"toList",value:function(){return function(t){return t}}},{key:"toSet",value:function(){return function(t){return Array.from(new C(t))}}}]),t}();A=Symbol.iterator;var N=function(){function t(e){n(this,t),o(this,"__internal",void 0),this.__internal=[]}return i(t,[{key:"toString",value:function(){return"[".concat(this.__internal.join(", "),"]")}},{key:"addI",value:function(t,e){this.__internal.splice(t,0,e)}},{key:"add",value:function(t){return this.__internal.push(t),!0}},{key:"addAll",value:function(t){var e;return this.__internal.length===(e=this.__internal).push.apply(e,v(t))}},{key:A,value:function(){return this.__internal[Symbol.iterator]()}},{key:"length",get:function(){return this.__internal.length}},{key:"clear",value:function(){this.__internal=[]}},{key:"stream",value:function(){return new G(this.__internal)}},{key:"get",value:function(t){return this.__internal[t]}},{key:"contains",value:function(t){return this.__internal.includes(t)}},{key:"size",value:function(){return this.__internal.length}},{key:"isEmpty",value:function(){return 0===this.__internal.length}},{key:"removeI",value:function(t){if(-1===t)throw new Error("IndexOutOfBoundsException");return d(this.__internal.splice(t,1),1)[0]}},{key:"remove",value:function(t){var e=this.__internal.indexOf(t);return-1!==e&&(this.__internal.splice(e,1),!0)}},{key:"set",value:function(t,e){var n=this.__internal[t];if(void 0===n)throw new Error("OutOfBoundException");return this.__internal[t]=e,n}},{key:"poll",value:function(){return this.__internal.shift()}},{key:"pollLast",value:function(){return this.__internal.pop()}},{key:"getLast",value:function(){return this.__internal[this.__internal.length-1]}},{key:"addFirst",value:function(t){return this.__internal.unshift(t)}},{key:"sort",value:function(t){return this.__internal.sort(t)}},{key:"toArray",value:function(){return Array.from(this.__internal)}},{key:"copy",value:function(){return t.__new(Array.from(this.__internal))}},{key:"sorted",value:function(){}}],[{key:"__new",value:function(e){var n=new t;return n.__internal=e,n}}]),t}(),S=function(){function t(e){n(this,t),o(this,"value",void 0),this.value=e}return i(t,[{key:"get",value:function(){if(null===this.value)throw new Error("null pointer exception XD");return this.value}}]),t}(),G=function(){function t(e){n(this,t),o(this,"__internal",void 0),this.__internal=e}return i(t,[{key:"length",get:function(){return this.__internal.length}},{key:"filter",value:function(t){return this.__internal=this.__internal.filter(t),this}},{key:"collect",value:function(t){return t(this.__internal)}},{key:"map",value:function(e){return new t(this.__internal.map(e))}},{key:"mapToInt",value:function(t){return new R(this.__internal.map(t))}},{key:"max",value:function(t){var e=this.__internal.reduce((function(e,n){return null===e||t(e,n)<0?n:e}),null);return new S(e)}},{key:"sorted",value:function(t){return this.__internal.sort(t),this}},{key:"toArray",value:function(){return this.__internal}},{key:"forEach",value:function(t){this.__internal.forEach(t)}},{key:"parallel",value:function(){return this}},{key:"flatMap",value:function(e){return new t(this.__internal.flatMap(e))}},{key:"iterator",value:function(){return this.__internal.values()}},{key:"distinct",value:function(){return new t(this.collect(L.toSet()))}}]),t}(),R=function(t){a(r,t);var e=y(r);function r(){return n(this,r),e.apply(this,arguments)}return i(r,[{key:"sum",value:function(){return this.__internal.reduce((function(t,e){return t+e}),0)}}]),r}(G);class j{constructor(t=[],e=M){if(this.data=t,this.length=this.data.length,this.compare=e,this.length>0)for(let t=(this.length>>1)-1;t>=0;t--)this._down(t)}push(t){this.data.push(t),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const t=this.data[0],e=this.data.pop();return this.length--,this.length>0&&(this.data[0]=e,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:e,compare:n}=this,r=e[t];for(;t>0;){const i=t-1>>1,o=e[i];if(n(r,o)>=0)break;e[t]=o,t=i}e[t]=r}_down(t){const{data:e,compare:n}=this,r=this.length>>1,i=e[t];for(;t<r;){let r=1+(t<<1),o=e[r];const a=r+1;if(a<this.length&&n(e[a],o)<0&&(r=a,o=e[a]),n(o,i)>=0)break;e[t]=o,t=r}e[t]=i}}function M(t,e){return t<e?-1:t>e?1:0}var I,x=function(){function t(e){n(this,t),o(this,"__internal",void 0),this.__internal=new j([],(function(t,e){return t.compareTo(e)}))}return i(t,[{key:"add",value:function(t){return this.__internal.push(t),!0}},{key:"peek",value:function(){return this.__internal.peek()}},{key:"poll",value:function(){return this.__internal.pop()}},{key:"size",value:function(){return this.__internal.length}},{key:"isEmpty",value:function(){return 0===this.__internal.length}}]),t}(),T=function(){function t(e){n(this,t),o(this,"__internal",void 0),this.__internal=null!=e?e:""}return i(t,[{key:"append",value:function(t){return this.__internal+=t,this}},{key:"toString",value:function(){return this.__internal}},{key:"length",value:function(){return this.__internal.length}}]),t}(),B=function(){function t(){n(this,t)}return i(t,null,[{key:"clamp",value:function(t,e,n){return t<e?e:Math.min(t,n)}},{key:"euclidean",value:function(){if(4===arguments.length&&"number"==typeof(arguments.length<=0?void 0:arguments[0])&&"number"==typeof(arguments.length<=1?void 0:arguments[1])&&"number"==typeof(arguments.length<=2?void 0:arguments[2])&&"number"==typeof(arguments.length<=3?void 0:arguments[3]))return this.__euclideanAABB.apply(this,arguments);if(3===arguments.length&&O(arguments.length<=0?void 0:arguments[0])&&"number"==typeof(arguments.length<=1?void 0:arguments[1])&&"number"==typeof(arguments.length<=2?void 0:arguments[2]))return this.__euclideanRectangleXY.apply(this,arguments);throw new Error("unable to resolve")}},{key:"__euclideanAABB",value:function(t,e,n,r){return Math.hypot(n-t,r-e)}},{key:"__euclideanRectangleXY",value:function(t,e,n){return t.contains(e,n)?-1:this.__euclideanAABB(e,n,this.clamp(e,t.getMinX(),t.getMaxX()),this.clamp(n,t.getMinY(),t.getMaxY()))}},{key:"indexOf",value:function(t,e){for(var n=0;n<t.length;++n)if(null==t[n]&&null==e||null!=e&&e===t[n])return n;return-1}},{key:"intervalsOverlap",value:function(t,e){return t[1]>=e[0]&&t[0]<=e[1]}},{key:"iterable",value:function(t){var e;return new(e=Symbol.iterator,function(){function r(){n(this,r),o(this,"callCount",0)}return i(r,[{key:e,value:function(){if(1==++this.callCount)return t;throw new Error(" can only be iterated once")}},{key:"iterator",value:function(){if(1==++this.callCount)return t;throw new Error(" can only be iterated once")}}]),r}())}},{key:"join",value:function(t){for(var e=new T,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];for(var o=0,a=r;o<a.length;o++){var s=a[o];e.length()>0&&0!==s.length&&e.append(t),e.append(s)}return e.toString()}},{key:"map",value:function(t,e,n){for(var r=0;r<t.length;++r)n[r]=e.get(t[r]);return n}},{key:"onBorderOf",value:function(t,e){return 0==t.getWidth()&&(t.getX()==e.getMinX()||t.getX()==e.getMaxX())&&t.getMinY()>=e.getMinY()&&t.getMaxY()<=e.getMaxY()||0==t.getHeight()&&(t.getY()==e.getMinY()||t.getY()==e.getMaxY())&&t.getMinX()>=e.getMinX()&&t.getMaxX()<=e.getMaxX()}},{key:"openIntervalsOverlap",value:function(t,e){return t[1]>e[0]&&t[0]<e[1]}},{key:"size",value:function(t){for(var e=0,n={done:!1,value:null};!n.done;n=t.next())e++;return e}},{key:"swap",value:function(t,e,n,r){var i=t.get(e);t.set(e,n.get(r)),n.set(r,i)}}]),t}();function P(t){return t.length}o(B,"EPS",1e-7),o(B,"Double",function(){function t(){n(this,t)}return i(t,null,[{key:"eq",value:function(t,e){return Math.abs(t-e)<=B.EPS}},{key:"neq",value:function(t,e){return!this.eq(t,e)}}]),t}()),function(t){t[t.NANOSECONDS=1]="NANOSECONDS",t[t.MICROSECONDS=1e3]="MICROSECONDS",t[t.MILLISECONDS=1e6]="MILLISECONDS",t[t.SECONDS=1e9]="SECONDS"}(I||(I={}));var D=function(t){a(r,t);var e=y(r);function r(){return n(this,r),e.apply(this,arguments)}return i(r,[{key:"getBounds2D",value:function(){return this}}]),r}(k),F=function(){function t(){n(this,t)}return i(t,null,[{key:"__distGlyphGlyph",value:function(t,e){return B.euclidean(t.getX(),t.getY(),e.getX(),e.getY())}},{key:"__distRectangleGlyph",value:function(t,e){var n=B.__euclideanRectangleXY(t,e.getX(),e.getY());return n<0?Number.NEGATIVE_INFINITY:n}},{key:"exitAt",value:function(t,e,n){return this.__intersectAtRectangleGlyph(e.getSide(n),t)}},{key:"__intersectAtGlyphGlyph",value:function(t,e){return t.hasSamePositionAs(e)?Number.NEGATIVE_INFINITY:this.__distGlyphGlyph(t,e)/(this.weight(t)+this.weight(e))}},{key:"__intersectAtRectangleGlyph",value:function(t,e){var n=this.__distRectangleGlyph(t,e);return Number.isFinite(n)?n/this.weight(e):n}},{key:"__intersectAtGlyphRectangle",value:function(t,e){return this.__intersectAtRectangleGlyph(e,t)}},{key:"radius",value:function(t,e){return Math.max(0,e)*this.weight(t)}},{key:"sizeAt",value:function(t,e){var n=this.radius(t,e);return new D(t.getX()-n,t.getY()-n,2*n,2*n)}},{key:"weight",value:function(t){return Math.sqrt(t.getN())}}]),t}(),z=function(t){a(r,t);var e=y(r);function r(){var t;return n(this,r),o(p(t=e.call(this)),"α",void 0),t.α=1,t}return i(r,[{key:"add",value:function(t){var e=t.computeAt();return t.setLowerBound(e/this.α),g(s(r.prototype),"add",this).call(this,t)}},{key:"peek",value:function(){for(;!this.isEmpty();){var t=g(s(r.prototype),"peek",this).call(this);if(t.getSmallGlyph().isAlive()){var e=t.computeAt(),n=t.getLowerBound();if(B.Double.eq(e,this.α*n))return t;g(s(r.prototype),"poll",this).call(this),t.setLowerBound(e/this.α),g(s(r.prototype),"add",this).call(this,t)}else g(s(r.prototype),"poll",this).call(this)}return null}},{key:"poll",value:function(){return null==this.peek()?null:g(s(r.prototype),"poll",this).call(this)}},{key:"updateAlpha",value:function(t){var e=F.radius(t.getGlyphs()[0],t.getAt()),n=F.radius(t.getGlyphs()[1],t.getAt());if(e<n){var r=n;n=e,e=r}this.α=(e-n)/(e+n)*this.α}}]),r}(x),q=function(){function t(e,r){n(this,t),o(this,"name",void 0),o(this,"priority",void 0),this.name=e,this.priority=r}return i(t,[{key:"toString",value:function(){return this.name+" event"}}],[{key:"values",value:function(){return this._values}}]),t}();o(q,"MERGE",new q("merge",0)),o(q,"OUT_OF_CELL",new q("out of cell",10)),o(q,"_values",[q.OUT_OF_CELL,q.MERGE]);var X,Y=function(){function t(e,r){n(this,t),o(this,"at",void 0),o(this,"glyphs",void 0),this.at=e,this.glyphs=[]}return i(t,[{key:"compareTo",value:function(t){var e=Math.sign(this.at-t.at);return 0!=e?e:this.getType().priority-t.getType().priority}},{key:"getAt",value:function(){return this.at}},{key:"getSize",value:function(){return this.glyphs.length}},{key:"getGlyphs",value:function(){return this.glyphs}},{key:"toString",value:function(){var t=new T(this.getType().toString());t.append(" at "),t.append(this.at),t.append(" involving [");var e,n=!0,r=m(this.glyphs);try{for(r.s();!(e=r.n()).done;){var i=e.value;n||t.append(", "),null==i?t.append("null"):t.append(i.toString()),n=!1}}catch(t){r.e(t)}finally{r.f()}return t.append("]"),t.toString()}}]),t}(),H=function(t){a(r,t);var e=y(r);function r(t,i,o){var a;return n(this,r),null==o&&(o=F.__intersectAtGlyphGlyph(t,i)),(a=e.call(this,o,2)).glyphs[0]=t,a.glyphs[1]=i,a}return i(r,[{key:"getOther",value:function(t){return this.glyphs[0]===t?this.glyphs[1]:this.glyphs[0]}},{key:"getType",value:function(){return q.MERGE}}]),r}(Y),U=function(t){a(r,t);var e=y(r);function r(t,i,a,s){var u;return n(this,r),void 0===s&&(s=F.exitAt(t,i,a)),o(p(u=e.call(this,s,1)),"cell",void 0),o(p(u),"side",void 0),u.glyphs=[t],u.cell=i,u.side=a,u}return i(r,[{key:"getCell",value:function(){return this.cell}},{key:"getSide",value:function(){return this.side}},{key:"getType",value:function(){return q.OUT_OF_CELL}}]),r}(Y),V=function(t){a(r,t);var e=y(r);function r(t){var i;return n(this,r),o(p(i=e.call(this,t.at,t.glyphs.length)),"from",void 0),o(p(i),"at",void 0),i.glyphs=Array.from(t.glyphs),i.from=t,i.at=t.at,i}return i(r,[{key:"computeAt",value:function(){for(var t=!1,e=0;e<this.glyphs.length;++e)if(this.glyphs[e].isBig()){var n=this.glyphs[e];this.glyphs[e]=this.glyphs[e].getAdoptivePrimalParent(),this.glyphs[e]!=n&&(t=!0,this.from.glyphs[e]=this.glyphs[e])}return t&&(this.at=F.__intersectAtGlyphGlyph(this.glyphs[0],this.glyphs[1])),this.at}},{key:"getAt",value:function(){return this.at}},{key:"getGlyphMerge",value:function(){return B.Double.neq(this.from.at,this.at)&&(this.from=new H(this.from.glyphs[0],this.from.glyphs[1],this.at)),this.from}},{key:"getSmallGlyph",value:function(){return this.glyphs[0].isBig()?this.glyphs[1]:this.glyphs[0]}},{key:"getType",value:function(){return q.MERGE}},{key:"setLowerBound",value:function(t){this.lb=t}},{key:"toString",value:function(){var t=new T("uncertain ");t.append(this.getType().toString()),t.append(" at "),t.append(this.at),t.append(", lower bound "),t.append(this.lb),t.append(" involving [");var e,n=!0,r=m(this.glyphs);try{for(r.s();!(e=r.n()).done;){var i=e.value;n||t.append(", "),null==i?t.append("null"):t.append(i.toString()),n=!1}}catch(t){r.e(t)}finally{r.f()}return t.append("]"),t.toString()}}]),r}(function(){function t(e,r){n(this,t),o(this,"lb",void 0),o(this,"glyphs",void 0),this.lb=e,this.glyphs=[]}return i(t,[{key:"compareTo",value:function(t){var e=Math.sign(this.lb-t.lb);return 0!=e?e:this.getType().priority-t.getType().priority}},{key:"getLowerBound",value:function(){return this.lb}},{key:"getSize",value:function(){return this.glyphs.length}},{key:"getGlyphs",value:function(){return this.glyphs}},{key:"toString",value:function(){var t=new T("uncertain ");t.append(this.getType().toString()),t.append(" at (lower bound) "),t.append(this.lb),t.append(" involving [");var e,n=!0,r=m(this.glyphs);try{for(r.s();!(e=r.n()).done;){var i=e.value;n||t.append(", "),null==i?t.append("null"):t.append(i.toString()),n=!1}}catch(t){r.e(t)}finally{r.f()}return t.append("]"),t.toString()}}]),t}()),Q=new Map,K=function(){function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:X.FINE;n(this,t),o(this,"_name",void 0),o(this,"level",void 0),this._name=e,this.level=r}return i(t,[{key:"isLoggable",value:function(t){var e=this.level;return!(t<e||e===X.OFF)}},{key:"log",value:function(e,n){if(!E.LOGGING_ENABLED)return null;if(e>=this.level){var r="",i=2;switch(e){case X.OFF:r="OFF";break;case X.SEVERE:r="SEVERE";break;case X.WARNING:r="WARNING";break;case X.INFO:r="INFO";break;case X.CONFIG:r="CONFIG";break;case X.FINE:r="FINE";break;case X.FINER:r="FINER",i=4;break;case X.FINEST:r="FINEST",i=6;break;case X.ALL:r="All"}r=r.padEnd(8)+"|"+"".padEnd(i),t._ps?t._ps.println(r+n):console.log(r+n)}}},{key:"getLevel",value:function(){return this.level}},{key:"setLevel",value:function(t){this.level=t}}],[{key:"getLogger",value:function(e){if(!E.LOGGING_ENABLED)return null;if(Q.has(e))return Q.get(e);var n=new t(e);return Q.set(e,n),n}},{key:"setPrintStream",value:function(t){t.reset(),this._ps=t}}]),t}();o(K,"_ps",void 0),function(t){t[t.OFF=Number.MAX_VALUE]="OFF",t[t.SEVERE=1e3]="SEVERE",t[t.WARNING=900]="WARNING",t[t.INFO=800]="INFO",t[t.CONFIG=700]="CONFIG",t[t.FINE=500]="FINE",t[t.FINER=400]="FINER",t[t.FINEST=300]="FINEST",t[t.ALL=Number.MIN_VALUE]="ALL"}(X||(X={}));var W=function(){function t(e,r){n(this,t),o(this,"str",void 0),o(this,"regexp",void 0),o(this,"_result",void 0),this.str=e,this.regexp=r}return i(t,[{key:"find",value:function(){return this.regexp.test(this.str)}},{key:"group",value:function(t){var e;return(null!==(e=this._result)&&void 0!==e?e:this._result=this.str.match(this.regexp))[t]}},{key:"replaceAll",value:function(t){return this.str.replace(this.regexp,t)}}]),t}(),J=function(){function t(e){n(this,t),o(this,"regexp",void 0),this.regexp=e}return i(t,[{key:"matcher",value:function(t){return new W(t,this.regexp)}}],[{key:"compile",value:function(e){return new t(e)}}]),t}(),$=function(t){a(r,t);var e=y(r);function r(){return n(this,r),e.call(this)}return i(r,[{key:"containsKey",value:function(t){return this.has(t)}},{key:"put",value:function(t,e){return this.set(t,e)}},{key:"keySet",value:function(){return N.__new(Array.from(this.keys()))}},{key:"entrySet",value:function(){return N.__new(Array.from(this.entries(),(function(t){var e=d(t,2),n=e[0],r=e[1];return new Z(n,r)})))}},{key:"remove",value:function(t){return this.delete(t)}}]),r}(c(Map)),Z=function(){function t(e,r){n(this,t),o(this,"key",void 0),o(this,"value",void 0),this.key=e,this.value=r}return i(t,[{key:"getKey",value:function(){return this.key}},{key:"getValue",value:function(){return this.value}}],[{key:"comparingByKey",value:function(){return function(t,e){return t.getKey()<e.getKey()?-1:t.getKey()>e.getKey()?1:0}}}]),t}(),tt=function(){function t(e){n(this,t),o(this,"n",void 0),o(this,"average",void 0),o(this,"min",void 0),o(this,"max",void 0),o(this,"sum",void 0),void 0===e?this.n=0:(this.n=1,this.average=this.min=this.max=this.sum=e)}return i(t,[{key:"getAverage",value:function(){return this.average}},{key:"getMin",value:function(){return this.min}},{key:"getMax",value:function(){return this.max}},{key:"getN",value:function(){return this.n}},{key:"getSum",value:function(){return this.sum}},{key:"log",value:function(t,e){this.min===this.max?t.log(X.FINE,"".concat(e," was ").concat(this.max.toFixed(2).padStart(13)," and did not change over ").concat(this.n," measurement").concat(1===this.n?"":"s")):t.log(X.FINE,"".concat(e," was ").concat(this.average.toFixed(2).padStart(13)," on average and always between ").concat(this.min," and ").concat(this.max," over ").concat(this.n," measurement").concat(1===this.n?"":"s"))}},{key:"logCount",value:function(t,e){t.log(X.FINE,"".concat(e," occured ").concat(1===this.n?"once":this.n+" times"))}},{key:"logPercentage",value:function(t,e){t.log(X.FINE,"".concat(e," ").concat((100*this.average).toFixed(2),"% of the time"))}},{key:"record",value:function(t){if(0===this.n)return this.n=1,void(this.average=this.min=this.max=this.sum=t);this.average+=(t-this.average)/++this.n,this.sum+=t,t>this.max&&(this.max=t),t<this.min&&(this.min=t)}},{key:"unrecord",value:function(t){if(0===this.n)throw new Error("cannot unrecord a value when no values are recorded");this.average-=(t-this.average)/--this.n,this.sum-=t,this.min=this.max=Number.NaN}}]),t}(),et=function(){function t(){n(this,t)}return i(t,null,[{key:"comparingInt",value:function(t){return function(e,n){return t(e)-t(n)}}},{key:"comparing",value:function(t){return function(e,n){var r=t(e),i=t(n);return r<i?-1:r>i?1:0}}}]),t}(),nt=function(){function t(){n(this,t)}return i(t,null,[{key:"count",value:function(t,e){void 0!==e&&this.__countStringBoolean(t,e),this.__countString(t)}},{key:"__countString",value:function(t){this.record("[count] "+t,1)}},{key:"__countStringBoolean",value:function(t,e){this.record("[perc] "+t,e?1:0)}},{key:"get",value:function(t){return this.stats.containsKey(t)||this.stats.put(t,new tt(0)),this.stats.get(t)}},{key:"log",value:function(t,e){this.stats.containsKey(t)&&this.stats.get(t).log(e,t)}},{key:"logAll",value:function(t){var e=this;t.log(X.FINE,""),t.log(X.FINE,"STATS");var n,r=this.stats.keySet().stream().filter((function(t){var n=e.TAG_REGEX.matcher(t);return!n.find()||"perc"!==n.group(1)})).map((function(t){return e.TAG_REGEX.matcher(t).replaceAll("")})).max(et.comparingInt(P)).get().length,i=function(t){return t.padEnd(r)},o=new N,a=m(this.stats.entrySet());try{for(a.s();!(n=a.n()).done;){var s=n.value;o.add(s)}}catch(t){a.e(t)}finally{a.f()}o.sort(et.comparing((function(t){return e.noTag(t.getKey())})));var u,l=m(o);try{for(l.s();!(u=l.n()).done;){var h=u.value,c=this.TAG_REGEX.matcher(h.getKey());if(c.find()){var p=c.group(1),f=i(c.replaceAll(""));"perc"===p?h.getValue().logPercentage(t,f):h.getValue().logCount(t,f)}else h.getValue().log(t,i(h.getKey()))}}catch(t){l.e(t)}finally{l.f()}}},{key:"record",value:function(t,e){if(this.stats.containsKey(t))this.stats.get(t).record(e);else{var n=new tt(e);this.stats.put(t,n)}}},{key:"remove",value:function(t){this.stats.remove(t)}},{key:"reset",value:function(){this.stats.clear()}},{key:"noTag",value:function(t){var e=this.TAG_REGEX.matcher(t);return e.find()?e.replaceAll("").trim():t}}]),t}();function rt(t){return t.length>0&&"number"==typeof t[0]&&"number"==typeof t[1]&&"number"==typeof t[2]}function it(t){return t.length>0&&"number"==typeof t[0]&&"number"==typeof t[1]&&"number"==typeof t[2]&&"number"==typeof t[3]}function ot(t){return void 0!==t[Symbol.iterator]&&null!==t[Symbol.iterator]}function at(t){return ot(t)&&t[0]instanceof ut}function st(t){return null===t||t instanceof ut}o(nt,"TAG_REGEX",J.compile(/^\[([a-z]+)]\s+/)),o(nt,"stats",new $);var ut=function(){function t(){n(this,t),o(this,"track",void 0),o(this,"trackedBy",void 0),o(this,"x",void 0),o(this,"y",void 0),o(this,"n",void 0),o(this,"alive",void 0),o(this,"big",void 0),o(this,"cells",void 0),o(this,"uncertainMergeEvents",void 0),o(this,"adoptedBy",void 0),o(this,"mergeEvents",void 0),o(this,"outOfCellEvents",void 0);for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];if(rt(r)||it(r)){var a=r[0],s=r[1],u=r[2],l=r[3],h=void 0!==l&&l;this.__constructor(a,s,u,h)}else if(r[0]&&ot(r[0])){var c=r[0];this.__constructorGlyphs(c)}else{if(!at(r))throw new Error("failed to resolve arguments");this.__constructorGlyphsArray.apply(this,r)}}return i(t,[{key:"__constructor",value:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(n<1)throw new Error("n must be at least 1");this.track=!1,E.TRACK&&!E.ROBUST?this.trackedBy=new N:this.trackedBy=null,this.x=t,this.y=e,this.n=n,this.alive=r?1:0,this.big=!1,this.cells=new N,this.uncertainMergeEvents=null,this.adoptedBy=null,this.mergeEvents=new x(E.MAX_MERGES_TO_RECORD),this.outOfCellEvents=new x}},{key:"__constructorGlyphs",value:function(t){this.__constructor(0,0,1),this.n=0;var e,n=m(t);try{for(n.s();!(e=n.n()).done;){var r=e.value;this.x+=r.x*r.n,this.y+=r.y*r.n,this.n+=r.n,this.track=this.track||r.track}}catch(t){n.e(t)}finally{n.f()}this.x/=this.n,this.y/=this.n}},{key:"__constructorGlyphsArray",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this.__constructorGlyphs(e)}},{key:"addCell",value:function(t){this.cells.contains(t)||this.cells.add(t)}},{key:"adoptUncertainMergeEvents",value:function(t,e){if(!this.isBig()||!t.isBig())throw new Error("both this glyph and bigGlyph must be big");if(this.uncertainMergeEvents.size()>0)throw new Error("can only adopt when it has no events yet");var n=this.uncertainMergeEvents;this.uncertainMergeEvents=t.uncertainMergeEvents,this.uncertainMergeEvents.updateAlpha(e),t.uncertainMergeEvents=n,t.adoptedBy=this}},{key:"getAdoptivePrimalParent",value:function(){return null===this.adoptedBy?this:this.adoptedBy.getAdoptivePrimalParent()}},{key:"getCells",value:function(){return this.cells}},{key:"getN",value:function(){return this.n}},{key:"getX",value:function(){return this.x}},{key:"getY",value:function(){return this.y}},{key:"hashCode",value:function(){return"".concat(this.x,":").concat(this.y)}},{key:"hasSamePositionAs",value:function(t){return B.Double.eq(this.x,t.x)&&B.Double.eq(this.y,t.y)}},{key:"isAlive",value:function(){return 1===this.alive}},{key:"isBig",value:function(){return this.big}},{key:"equals",value:function(t){return this===t}},{key:"participate",value:function(){if(1==this.alive)throw new Error("having a participating glyph participate");if(2==this.alive)throw new Error("cannot bring a perished glyph back to life");this.alive=1}},{key:"peekUncertain",value:function(){return this.uncertainMergeEvents.peek()}},{key:"perish",value:function(){this.alive=2}},{key:"pollUncertain",value:function(){return this.uncertainMergeEvents.poll()}},{key:"popMergeInto",value:function(t,e){if(this.big)throw new Error("big glyphs don't pop merge events into the shared queue");for(;!this.mergeEvents.isEmpty();){var n=this.mergeEvents.poll(),r=n.getOther(this);if(r.isAlive()&&!r.isBig())return t.add(n),E.TRACK&&!E.ROBUST&&(r.trackedBy.contains(this)||r.trackedBy.add(this)),E.LOGGING_ENABLED&&null!==e&&e.log(X.FINEST,"→ merge at ".concat(n.getAt().toFixed(3)," with ").concat(r)),!0}return!1}},{key:"popOutOfCellInto",value:function(t,e){if(this.big)throw new Error("big glyphs don't pop out of cell events into the shared queue");for(var n=!1;!this.outOfCellEvents.isEmpty();){var r=this.outOfCellEvents.poll();if(E.LOGGING_ENABLED&&null!==e&&e.log(X.FINEST,"popping ".concat(r," into the queue")),t.add(r),n=!0,!E.ROBUST)return!0}return!(!E.ROBUST||!n)||(E.LOGGING_ENABLED&&null!==e&&e.log(X.FINEST,"no out of cell event to pop"),!1)}},{key:"record",value:function(t){if(t instanceof H)return this.__recordG(t);if(t instanceof V)return this.__recordU(t);if(t instanceof U)return this.__recordO(t);throw new Error("unresolved choice")}},{key:"__recordG",value:function(t){this.mergeEvents.add(t)}},{key:"__recordU",value:function(t){this.uncertainMergeEvents.add(t)}},{key:"__recordO",value:function(t){this.outOfCellEvents.add(t)}},{key:"removeCell",value:function(t){this.cells.remove(t)}},{key:"setBig",value:function(t){E.BIG_GLYPHS&&(this.big=this.n>t.getAverage()*E.BIG_GLYPH_FACTOR,nt.count("glyph was big when it participated",this.big),this.big&&(this.uncertainMergeEvents=new z))}},{key:"setN",value:function(t){this.n=t}},{key:"toString",value:function(){return"glyph [x = ".concat(this.x.toFixed(2),", y = ").concat(this.y.toFixed(2),", n = ").concat(this.n,"]")}}],[{key:"__isAlive",value:function(t){return t.isAlive()}}]),t}();function lt(t){return"number"==typeof t}function ht(t){return null===t||t instanceof pt}function ct(t){return t.length>2&&O(t[0])&&lt(t[1])&&lt(t[2])}var pt=function(){function t(e,r,i,a){n(this,t),o(this,"_quadrants",void 0),o(this,"_others",void 0),o(this,"_id",void 0),o(this,"_name",void 0),this._name=e,this._id=a,this._others=null,this._quadrants=[r,i]}return i(t,[{key:"toString",value:function(){return this._name}},{key:"opposite",value:function(){return t.values()[(this.ordinal()+2)%4]}},{key:"others",value:function(){if(null===this._others){this._others=[null,null,null];var e,n=0,r=m(t.values());try{for(r.s();!(e=r.n()).done;){var i=e.value;i!==this&&(this._others[n++]=i)}}catch(t){r.e(t)}finally{r.f()}}return this._others}},{key:"quadrants",value:function(){return this._quadrants}},{key:"ordinal",value:function(){return this._id}}],[{key:"interval",value:function(e,n){return n==t.TOP||n==t.BOTTOM?[e.getMinX(),e.getMaxX()]:[e.getMinY(),e.getMaxY()]}},{key:"quadrant",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];if(e.length>0){if(lt(e[0]))return this.__quadrantIdx(e[0]);if(ct(e))return this.__quadrantRXY.apply(this,e)}throw new Error("failed to resolve choice")}},{key:"__quadrantIdx",value:function(t){if(t<0||t>3)throw new Error("illegal argument");var e,n=[null,null],r=0,i=m(this.values());try{for(i.s();!(e=i.n()).done;){var o=e.value;o._quadrants[0]!=t&&o._quadrants[1]!=t||(n[r++]=o)}}catch(t){i.e(t)}finally{i.f()}return n}},{key:"__quadrantRXY",value:function(t,e,n){return(n<t.getCenterY()?0:2)+(e<t.getCenterX()?0:1)}},{key:"quadrantNeighbor",value:function(e,n){switch(e){case 0:return n.ordinal();case 1:return(e+n.ordinal())%4;case 2:return n==t.TOP?0:3;case 3:return n==t.TOP?1:2;default:return-1}}},{key:"values",value:function(){return this._values}}]),t}();o(pt,"TOP",new pt("TOP",0,1,0)),o(pt,"RIGHT",new pt("RIGHT",1,3,1)),o(pt,"BOTTOM",new pt("BOTTOM",2,3,2)),o(pt,"LEFT",new pt("LEFT",0,2,3)),o(pt,"_values",[pt.TOP,pt.RIGHT,pt.BOTTOM,pt.LEFT]);var ft=function(){function t(){n(this,t)}return i(t,null,[{key:"asList",value:function(t){return t}},{key:"stream",value:function(t,e,n){return new G(t.slice(e,n))}},{key:"nCopies",value:function(t,e){return Array.from({length:t},(function(){return e}))}},{key:"rotate",value:function(t,e){return e-=t.__internal.length*Math.floor(e/t.__internal.length),t.__internal.push.apply(t.__internal,t.__internal.splice(0,e)),t}}]),t}();Function.noop=function(){},Function.identity=function(t){return t},Function.by=function(t,e){e=e||Object.compare,t=t||Function.identity;var n=function(n,r){return e(t(n),t(r))};return n.compare=e,n.by=t,n},Function.get=function(t){return function(e){return Object.get(e,t)}};var yt="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function gt(t){var e={exports:{}};return t(e,e.exports),e.exports}var dt=vt;function vt(){throw new Error("Can't construct. GenericCollection is a mixin.")}var _t=yt.DOMTokenList||function(){};vt.EmptyArray=Object.freeze([]),vt.prototype.addEach=function(t,e,n){if(t&&(t instanceof Array||t instanceof _t||t instanceof String))if(e)for(var r=0;r<t.length;r++)this.add(e.call(n,t[r]),r);else for(r=0;r<t.length;r++)this.add(t[r],r);else if(t&&Object(t)===t)if("function"==typeof t.forEach)e?t.map(e,n).forEach(this.add,this):t.forEach(this.add,this);else if("function"==typeof t.next){var i;r=0;if(e)for(;i=t.next().value;)this.add(e.call(n,i),r++);else for(;i=t.next().value;)this.add(i,r++)}else if("number"==typeof t.length)if(e)for(r=0;r<t.length;r++)this.add(e.call(n,t[r]),r);else for(r=0;r<t.length;r++)this.add(t[r],r);else e?Object.keys(t).forEach((function(r){this.add(e.call(n,t[r]),r)}),this):Object.keys(t).forEach((function(e){this.add(t[e],e)}),this);return this},vt.prototype.deleteEach=function(t,e){return t.forEach((function(t){this.delete(t,e)}),this),this},vt.prototype.forEach=function(t){var e=arguments[1];return this.reduce((function(n,r,i,o,a){t.call(e,r,i,o,a)}),void 0)},vt.prototype.map=function(t){var e=arguments[1],n=[];return this.reduce((function(r,i,o,a,s){n.push(t.call(e,i,o,a,s))}),void 0),n},vt.prototype.enumerate=function(t){null==t&&(t=0);var e=[];return this.reduce((function(n,r){e.push([t++,r])}),void 0),e},vt.prototype.group=function(t,e,n){n=n||Object.equals;var r=[],i=[];return this.forEach((function(o,a,s){a=t.call(e,o,a,s);var u,l=i.indexOf(a,n);-1===l?(u=[],r.push([a,u]),i.push(a)):u=r[l][1],u.push(o)})),r},vt.prototype.toArray=function(){return this.map(Function.identity)},vt.prototype.toObject=function(){var t={};return this.reduce((function(e,n,r){t[r]=n}),void 0),t},vt.from=function(){return this.apply(this,arguments)},vt.prototype.filter=function(t){var e=arguments[1],n=this.constructClone();return this.reduce((function(r,i,o,a,s){t.call(e,i,o,a,s)&&n.add(i,o)}),void 0),n},vt.prototype.every=function(t){var e=arguments[1];return this.reduce((function(n,r,i,o,a){return n&&t.call(e,r,i,o,a)}),!0)},vt.prototype.some=function(t){var e=arguments[1];return this.reduce((function(n,r,i,o,a){return n||t.call(e,r,i,o,a)}),!1)},vt.prototype.all=function(){return this.every(Boolean)},vt.prototype.any=function(){return this.some(Boolean)},vt.prototype.min=function(t){t=t||this.contentCompare||Object.compare;var e=!0;return this.reduce((function(n,r){return e?(e=!1,r):t(r,n)<0?r:n}),void 0)},vt.prototype.max=function(t){t=t||this.contentCompare||Object.compare;var e=!0;return this.reduce((function(n,r){return e?(e=!1,r):t(r,n)>0?r:n}),void 0)},vt.prototype.sum=function(t){return t=void 0===t?0:t,this.reduce((function(t,e){return t+e}),t)},vt.prototype.average=function(t){var e=void 0===t?0:t,n=void 0===t?0:t;return this.reduce((function(t,r){e+=r,n+=1}),void 0),e/n},vt.prototype.concat=function(){for(var t=this.constructClone(this),e=0;e<arguments.length;e++)t.addEach(arguments[e]);return t},vt.prototype.flatten=function(){var t=this;return this.reduce((function(e,n){return n.forEach((function(t){this.push(t)}),e,t),e}),[])},vt.prototype.zip=function(){var t=Array.prototype.slice.call(arguments);return t.unshift(this),Array.unzip(t)},vt.prototype.join=function(t){return this.reduce((function(e,n){return void 0===e?n:e+t+n}),void 0)},vt.prototype.sorted=function(t,e,n){return(t=t||this.contentCompare||Object.compare).by?(e=t.by,t=t.compare||this.contentCompare||Object.compare):e=e||Function.identity,void 0===n&&(n=1),this.map((function(t){return{by:e(t),value:t}})).sort((function(e,r){return t(e.by,r.by)*n})).map((function(t){return t.value}))},vt.prototype.reversed=function(){return this.constructClone(this).reverse()},vt.prototype.clone=function(t,e){if(void 0===t)t=1/0;else if(0===t)return this;var n=this.constructClone();return this.forEach((function(r,i){n.add(Object.clone(r,t-1,e),i)}),this),n},vt.prototype.only=function(){if(1===this.length)return this.one()},vt.prototype.iterator=function(){return this.iterate.apply(this,arguments)},vt._sizePropertyDescriptor={get:function(){return this.length},enumerable:!1,configurable:!0},Object.defineProperty(vt.prototype,"size",vt._sizePropertyDescriptor);var bt=gt((function(t){!function(){if("undefined"==typeof ses||!ses.ok||ses.ok()){"undefined"!=typeof ses&&(ses.weakMapPermitHostObjects=d);var e=!1;if("function"==typeof WeakMap){var n=WeakMap;if("undefined"!=typeof navigator&&/Firefox/.test(navigator.userAgent));else{var r=new n,i=Object.freeze({});if(r.set(i,1),1===r.get(i))return void(t.exports=WeakMap);e=!0}}var o=Object.getOwnPropertyNames,a=Object.defineProperty,s=Object.isExtensible,u="weakmap:",l="weakmap:ident:"+Math.random()+"___";if("undefined"!=typeof crypto&&"function"==typeof crypto.getRandomValues&&"function"==typeof ArrayBuffer&&"function"==typeof Uint8Array){var h=new ArrayBuffer(25),c=new Uint8Array(h);crypto.getRandomValues(c),l="weakmap:rand:"+Array.prototype.map.call(c,(function(t){return(t%36).toString(36)})).join("")+"___"}if(a(Object,"getOwnPropertyNames",{value:function(t){return o(t).filter(v)}}),"getPropertyNames"in Object){var p=Object.getPropertyNames;a(Object,"getPropertyNames",{value:function(t){return p(t).filter(v)}})}!function(){var t=Object.freeze;a(Object,"freeze",{value:function(e){return _(e),t(e)}});var e=Object.seal;a(Object,"seal",{value:function(t){return _(t),e(t)}});var n=Object.preventExtensions;a(Object,"preventExtensions",{value:function(t){return _(t),n(t)}})}();var f=!1,y=0,g=function(){this instanceof g||m();var t=[],e=[],n=y++;return Object.create(g.prototype,{get___:{value:b((function(r,i){var o,a=_(r);return a?n in a?a[n]:i:(o=t.indexOf(r))>=0?e[o]:i}))},has___:{value:b((function(e){var r=_(e);return r?n in r:t.indexOf(e)>=0}))},set___:{value:b((function(r,i){var o,a=_(r);return a?a[n]=i:(o=t.indexOf(r))>=0?e[o]=i:(o=t.length,e[o]=i,t[o]=r),this}))},delete___:{value:b((function(r){var i,o,a=_(r);return a?n in a&&delete a[n]:!((i=t.indexOf(r))<0)&&(o=t.length-1,t[i]=void 0,e[i]=e[o],t[i]=t[o],t.length=o,e.length=o,!0)}))}})};g.prototype=Object.create(Object.prototype,{get:{value:function(t,e){return this.get___(t,e)},writable:!0,configurable:!0},has:{value:function(t){return this.has___(t)},writable:!0,configurable:!0},set:{value:function(t,e){return this.set___(t,e)},writable:!0,configurable:!0},delete:{value:function(t){return this.delete___(t)},writable:!0,configurable:!0}}),"function"==typeof n?function(){function r(){this instanceof g||m();var t,r=new n,i=void 0,o=!1;return t=e?function(t,e){return r.set(t,e),r.has(t)||(i||(i=new g),i.set(t,e)),this}:function(t,e){if(o)try{r.set(t,e)}catch(n){i||(i=new g),i.set___(t,e)}else r.set(t,e);return this},Object.create(g.prototype,{get___:{value:b((function(t,e){return i?r.has(t)?r.get(t):i.get___(t,e):r.get(t,e)}))},has___:{value:b((function(t){return r.has(t)||!!i&&i.has___(t)}))},set___:{value:b(t)},delete___:{value:b((function(t){var e=!!r.delete(t);return i&&i.delete___(t)||e}))},permitHostObjects___:{value:b((function(t){if(t!==d)throw new Error("bogus call to permitHostObjects___");o=!0}))}})}e&&"undefined"!=typeof Proxy&&(Proxy=void 0),r.prototype=g.prototype,t.exports=r,Object.defineProperty(WeakMap.prototype,"constructor",{value:WeakMap,enumerable:!1,configurable:!0,writable:!0})}():("undefined"!=typeof Proxy&&(Proxy=void 0),t.exports=g)}function d(t){t.permitHostObjects___&&t.permitHostObjects___(d)}function v(t){return!(t.substr(0,u.length)==u&&"___"===t.substr(t.length-3))}function _(t){if(t!==Object(t))throw new TypeError("Not an object: "+t);var e=t[l];if(e&&e.key===t)return e;if(s(t)){e={key:t};try{return a(t,l,{value:e,writable:!1,enumerable:!1,configurable:!1}),e}catch(t){return}}}function b(t){return t.prototype=null,Object.freeze(t)}function m(){f||"undefined"==typeof console||(f=!0,console.warn("WeakMap should be invoked as new WeakMap(), not WeakMap(). This will be an error in the future."))}}()})),mt="undefined"!=typeof WeakMap?WeakMap:bt,Et=Object;Object.empty=Object.freeze(Object.create(null)),Object.isObject=function(t){return Object(t)===t},Object.getValueOf=function(t){return t&&"function"==typeof t.valueOf&&(t=t.valueOf()),t};var Ot=new mt;Object.hash=function(t){return t&&"function"==typeof t.hash?""+t.hash():Object(t)===t?(Ot.has(t)||Ot.set(t,Math.random().toString(36).slice(2)),Ot.get(t)):""+t};var wt=Object.prototype.hasOwnProperty;Object.owns=function(t,e){return wt.call(t,e)},Object.has=function(t,e){if("object"!=typeof t)throw new Error("Object.has can't accept non-object: "+typeof t);if(t&&"function"==typeof t.has)return t.has(e);if("string"==typeof e)return e in t&&t[e]!==Object.prototype[e];throw new Error("Key must be a string for Object.has on plain objects")},Object.get=function(t,e,n){if("object"!=typeof t)throw new Error("Object.get can't accept non-object: "+typeof t);return t&&"function"==typeof t.get?t.get(e,n):Object.has(t,e)?t[e]:n},Object.set=function(t,e,n){t&&"function"==typeof t.set?t.set(e,n):t[e]=n},Object.addEach=function(t,e,n){var r=3!==arguments.length||n;if(e)if("function"!=typeof e.forEach||e.hasOwnProperty("forEach"))if("number"==typeof e.length)for(var i=0;i<e.length;i++)t[i]=e[i];else for(var o,a=Object.keys(e),s=0;o=a[s];s++)!r&&Object.owns(t,o)||(t[o]=e[o]);else!0===e.isMap?e.forEach((function(e,n){t[n]=e})):e.forEach((function(e){t[e[0]]=e[1]}));else;return t},Object.defineEach=function(t,e,n,r,i,o){var a=3!==arguments.length||n;if(e)if("function"!=typeof e.forEach||e.hasOwnProperty("forEach"))if("number"==typeof e.length)for(var s=0;s<e.length;s++)Object.defineProperty(t,s,{value:e[s],writable:o,configurable:r,enumerable:i});else for(var u,l=Object.keys(e),h=0;u=l[h];h++)!a&&Object.owns(t,u)||Object.defineProperty(t,u,{value:e[u],writable:o,configurable:r,enumerable:i});else!0===e.isMap?e.forEach((function(e,n){Object.defineProperty(t,n,{value:e,writable:o,configurable:r,enumerable:i})})):e.forEach((function(e){Object.defineProperty(t,e[0],{value:e[1],writable:o,configurable:r,enumerable:i})}));else;return t},Object.forEach=function(t,e,n){for(var r,i=Object.keys(t),o=0;r=i[o];o++)e.call(n,t[r],r,t)},Object.map=function(t,e,n){for(var r,i=Object.keys(t),o=0,a=[];r=i[o];o++)a.push(e.call(n,t[r],r,t));return a},Object.values=function(t){return Object.map(t,Function.identity)},Object.concat=function(){for(var t={},e=0;e<arguments.length;e++)Object.addEach(t,arguments[e]);return t},Object.from=Object.concat,Object.is=function(t,e){return t===e?0!==t||1/t==1/e:t!=t&&e!=e},Object.equals=function(t,e,n,r){if(n=n||Object.equals,(t=Object.getValueOf(t))===(e=Object.getValueOf(e)))return!0;if(Object.isObject(t)){if((r=r||new mt).has(t))return!0;r.set(t,!0)}if(Object.isObject(t)&&"function"==typeof t.equals)return t.equals(e,n,r);if(Object.isObject(e)&&"function"==typeof e.equals)return e.equals(t,n,r);if(Object.isObject(t)&&Object.isObject(e)&&Object.getPrototypeOf(t)===Object.prototype&&Object.getPrototypeOf(e)===Object.prototype){for(var i in t)if(!n(t[i],e[i],n,r))return!1;for(var i in e)if(!(i in t)||!n(e[i],t[i],n,r))return!1;return!0}return t!=t&&e!=e||(!t||!e)&&t===e},Object.compare=function(t,e){if((t=Object.getValueOf(t))===(e=Object.getValueOf(e)))return 0;var n=typeof t,r=typeof e;return"number"===n&&"number"===r?t-e:"string"===n&&"string"===r?t<e?-1/0:1/0:t&&"function"==typeof t.compare?t.compare(e):e&&"function"==typeof e.compare?-e.compare(t):0},Object.clone=function(t,e,n){if(t=Object.getValueOf(t),n=n||new mt,void 0===e)e=1/0;else if(0===e)return t;if(Object.isObject(t)){if(!n.has(t))if(t&&"function"==typeof t.clone)n.set(t,t.clone(e,n));else{var r=Object.getPrototypeOf(t);if(null!==r&&r!==Object.prototype)throw new Error("Can't clone "+t);var i=Object.create(r);for(var o in n.set(t,i),t)i[o]=Object.clone(t[o],e-1,n)}return n.get(t)}return t},Object.clear=function(t){if(t&&"function"==typeof t.clear)t.clear();else for(var e=Object.keys(t),n=e.length;n;)delete t[e[--n]];return t};var kt=At;function At(){throw new Error("Can't construct. GenericOrder is a mixin.")}At.prototype.equals=function(t,e){return e=e||this.contentEquals||Et.equals,this===t||!!t&&(this.length===t.length&&this.zip(t).every((function(t){return e(t[0],t[1])})))},At.prototype.compare=function(t,e){if(e=e||this.contentCompare||Et.compare,this===t)return 0;if(!t)return 1;var n=Math.min(this.length,t.length),r=this.zip(t).reduce((function(t,r,i){return 0===t?i>=n?t:e(r[0],r[1]):t}),0);return 0===r?this.length-t.length:r},At.prototype.toJSON=function(){return this.toArray()};var Ct=Array.prototype.splice,Lt=Array.prototype.slice;Array.empty=[],Object.freeze&&Object.freeze(Array.empty),Array.nativeFrom=Array.from;var Nt="undefined"!=typeof Symbol;function St(t,e){Object.defineProperty(Array.prototype,t,{value:e,writable:!0,configurable:!0,enumerable:!1})}Array.from=function(t,e,n){if(Nt&&t&&("function"==typeof t[Symbol.iterator]||"function"==typeof e))return Array.nativeFrom(t,e,n);var r=[];return r.addEach(t),r},Array.unzip=function(t){for(var e=[],n=1/0,r=0;r<t.length;r++){var i=t[r];t[r]=i.toArray(),i.length<n&&(n=i.length)}for(r=0;r<t.length;r++){i=t[r];for(var o=0;o<i.length;o++)o<n&&o in i&&(e[o]=e[o]||[],e[o][r]=i[o])}return e},St("addEach",dt.prototype.addEach),St("deleteEach",dt.prototype.deleteEach),St("toArray",dt.prototype.toArray),St("toObject",dt.prototype.toObject),St("all",dt.prototype.all),St("any",dt.prototype.any),St("min",dt.prototype.min),St("max",dt.prototype.max),St("sum",dt.prototype.sum),St("average",dt.prototype.average),St("only",dt.prototype.only),St("flatten",dt.prototype.flatten),St("zip",dt.prototype.zip),St("enumerate",dt.prototype.enumerate),St("group",dt.prototype.group),St("sorted",dt.prototype.sorted),St("reversed",dt.prototype.reversed),St("constructClone",(function(t){var e=new this.constructor;return e.addEach(t),e})),St("has",(function(t,e){return-1!==this.findValue(t,e)})),St("get",(function(t,e){if(+t!==t)throw new Error("Indicies must be numbers");return!t in this?e:this[t]})),St("set",(function(t,e){return this[t]=e,!0})),St("add",(function(t){return this.push(t),!0})),St("delete",(function(t,e){var n=this.findValue(t,e);return-1!==n&&(this.spliceOne(n),!0)})),St("deleteAll",(function(t,e){e=e||this.contentEquals||Object.equals;for(var n=0,r=0;r<this.length;)e(t,this[r])?(this.swap(r,1),n++):r++;return n})),Array.prototype.find||St("find",(function(t){if(null==this)throw new TypeError('"this" is null or not defined');var e=Object(this),n=e.length>>>0;if("function"!=typeof t)throw new TypeError("predicate must be a function");for(var r=arguments[1],i=0;i<n;){var o=e[i];if(t.call(r,o,i,e))return o;i++}}));var Gt={};function Rt(t,e){"undefined"!=typeof console&&"function"==typeof console.warn&&!0!==e&&!1===Gt.hasOwnProperty(t)&&(console.warn(t),Gt[t]++)}var jt=Object.getOwnPropertyDescriptor(Array.prototype,"find").value;function Mt(t,e,n){this.array=t,this.start=null==e?0:e,this.end=n}if(St("find",(function(t,e,n){return"function"==typeof arguments[0]&&this instanceof Array?jt.apply(this,arguments):(Rt("Array#find usage is deprecated please use Array#findValue"),this.findValue.apply(this,arguments))})),St("findValue",(function(t,e,n){if(n)throw new Error("Array#findValue does not support third argument: index");e=e||this.contentEquals||Object.equals;for(n=0;n<this.length;n++)if(n in this&&e(t,this[n]))return n;return-1})),St("findLast",(function(t,e){return Rt("Array#findLast function is deprecated please use Array#findLastValue instead."),this.findLastValue.apply(this,arguments)})),St("findLastValue",(function(t,e){e=e||this.contentEquals||Object.equals;var n=this.length;do{if(--n in this&&e(this[n],t))return n}while(n>0);return-1})),St("swap",(function(t,e,n){var r,i,o,a,s;if(t>this.length&&(this.length=t),void 0!==n){if(r=[t,e],Array.isArray(n)||(n=Lt.call(n)),o=0,(i=n.length)<1e3){for(;o<i;o++)r[o+2]=n[o];return Ct.apply(this,r)}for(s=Ct.apply(this,r);o<i;){for(r=[t+o,0],a=2;a<1002&&o<i;a++,o++)r[a]=n[o];Ct.apply(this,r)}return s}return void 0!==e?Ct.call(this,t,e):void 0!==t?Ct.call(this,t):[]})),St("peek",(function(){return this[0]})),St("poke",(function(t){this.length>0&&(this[0]=t)})),St("peekBack",(function(){if(this.length>0)return this[this.length-1]})),St("pokeBack",(function(t){this.length>0&&(this[this.length-1]=t)})),St("one",(function(){for(var t in this)if(Object.owns(this,t))return this[t]})),Array.prototype.clear||St("clear",(function(){return this.length=0,this})),St("compare",(function(t,e){var n,r,i;if(e=e||Object.compare,this===t)return 0;if(!t||!Array.isArray(t))return kt.prototype.compare.call(this,t,e);for(r=this.length<t.length?this.length:t.length,n=0;n<r;n++)if(n in this){if(!(n in t))return-1;if(i=e(this[n],t[n]))return i}else if(n in t)return 1;return this.length-t.length})),St("equals",(function(t,e){e=e||Object.equals;var n=0,r=this.length;if(this===t)return!0;if(!t||!Array.isArray(t))return kt.prototype.equals.call(this,t);if(r!==t.length)return!1;for(;n<r;++n)if(n in this){if(!(n in t))return!1;if(!e(this[n],t[n]))return!1}else if(n in t)return!1;return!0})),St("clone",(function(t,e){if(null==t)t=1/0;else if(0===t)return this;if((e=e||new mt).has(this))return e.get(this);var n=new Array(this.length);for(var r in e.set(this,n),this)n[r]=Object.clone(this[r],t-1,e);return n})),St("iterate",(function(t,e){return new Mt(this,t,e)})),void 0===Array.prototype.spliceOne&&St("spliceOne",(function(t,e){var n=this.length;if(n)if(1===arguments.length){for(;t<n;)this[t]=this[t+1],t++;this.length--}else this[t]=e})),St("Iterator",Mt),Mt.prototype.__iterationObject=null,Object.defineProperty(Mt.prototype,"_iterationObject",{get:function(){return this.__iterationObject||(this.__iterationObject={done:!1,value:null})}}),Mt.prototype.next=function(){return this.start===(null==this.end?this.array.length:this.end)?(this._iterationObject.done=!0,this._iterationObject.value=void 0):this._iterationObject.value=this.array[this.start++],this._iterationObject},!RegExp.escape){var It=/[-[\]{}()*+?.\\^$|,#\s]/g;RegExp.escape=function(t){return t.replace(It,"\\$&")}}var xt=Tt;function Tt(t,e,n){return Tt._init(Tt,this,t,e,n)}function Bt(t){this.head=t,this.at=t.next}function Pt(t){this.value=t,this.prev=null,this.next=null}Tt._init=function(t,e,n,r,i){if(!(e instanceof t))return new t(n,r,i);var o=e.head=new e.Node;o.next=o,o.prev=o,e.contentEquals=r||Object.equals,e.getDefault=i||Function.noop,e.length=0,e.addEach(n)},Tt.List=Tt,Object.addEach(Tt.prototype,dt.prototype),Object.addEach(Tt.prototype,kt.prototype),Tt.from=dt.from,Tt.prototype.constructClone=function(t){return new this.constructor(t,this.contentEquals,this.getDefault)},Tt.prototype.find=function(t,e,n){e=e||this.contentEquals;for(var r=this.head,i=this.scan(n,r.next);i!==r;){if(e(i.value,t))return i;i=i.next}},Tt.prototype.findLast=function(t,e,n){e=e||this.contentEquals;for(var r=this.head,i=this.scan(n,r.prev);i!==r;){if(e(i.value,t))return i;i=i.prev}},Tt.prototype.has=function(t,e){return!!this.find(t,e)},Tt.prototype.get=function(t,e){var n=this.find(t,e);return n?n.value:this.getDefault(t)},Tt.prototype.delete=function(t,e){var n=this.findLast(t,e);return!!n&&(n.delete(),this.length--,!0)},Tt.prototype.deleteAll=function(t,e){e=e||this.contentEquals;for(var n=this.head,r=n.next,i=0;r!==n;)e(t,r.value)&&(r.delete(),i++),r=r.next;return this.length-=i,i},Tt.prototype.clear=function(){this.head.next=this.head.prev=this.head,this.length=0},Tt.prototype.add=function(t){var e=new this.Node(t);return this._addNode(e)},Tt.prototype._addNode=function(t){return this.head.addBefore(t),this.length++,!0},Tt.prototype.push=function(){for(var t=this.head,e=0;e<arguments.length;e++){var n=arguments[e],r=new this.Node(n);t.addBefore(r)}this.length+=arguments.length},Tt.prototype.unshift=function(){for(var t=this.head,e=0;e<arguments.length;e++){var n=arguments[e],r=new this.Node(n);t.addAfter(r),t=r}this.length+=arguments.length},Tt.prototype._shouldPop=function(){var t,e=this.head;return e.prev!==e&&(t=e.prev.value),t},Tt.prototype.pop=function(t,e){var n,r=this.head;if(r.prev!==r){n=r.prev.value;var i=this.length-1,o=t?t.call(this,n,i):void 0;r.prev.delete(),this.length--,e&&e.call(this,n,i,o)}return n},Tt.prototype.shift=function(t,e){var n,r=this.head;if(r.prev!==r){n=r.next.value;var i=t?t.call(this,n,0):void 0;r.next.delete(),this.length--,e&&e.call(this,n,0,i)}return n},Tt.prototype.peek=function(){if(this.head!==this.head.next)return this.head.next.value},Tt.prototype.poke=function(t){this.head!==this.head.next?this.head.next.value=t:this.push(t)},Tt.prototype.one=function(){return this.peek()},Tt.prototype.scan=function(t,e){var n=this.head;if("number"==typeof t){var r=t;if(r>=0)for(t=n.next;r&&(r--,(t=t.next)!=n););else for(t=n;r<0&&(r++,(t=t.prev)!=n););return t}return t||e},Tt.prototype.slice=function(t,e){var n=[],r=this.head;for(t=this.scan(t,r.next),e=this.scan(e,r);t!==e&&t!==r;)n.push(t.value),t=t.next;return n},Tt.prototype.splice=function(t,e){return this.swap(t,e,Array.prototype.slice.call(arguments,2))},Tt.prototype.swap=function(t,e,n,r,i){var o=t;t=this.scan(t,this.head),null==e&&(e=1/0),n=Array.from(n);for(var a=[],s=t;e--&&e>=0&&s!==this.head;)a.push(s.value),s=s.next;r&&r.call(this,t,n,a);s=t;var u=0;for(s=t;u<a.length;u++,s=s.next)s.delete();null==o&&s===this.head&&(s=this.head.next);for(u=0;u<n.length;u++){var l=new this.Node(n[u]);s.addBefore(l)}return this.length+=n.length-a.length,i&&i.call(this,t,n,a),a},Tt.prototype.reverse=function(){var t=this.head;do{var e=t.next;t.next=t.prev,t.prev=e,t=t.next}while(t!==this.head);return this},Tt.prototype.sort=function(){this.swap(0,this.length,this.sorted.apply(this,arguments))},Tt.prototype.reduce=function(t,e){for(var n=arguments[2],r=this.head,i=r.next;i!==r;)e=t.call(n,e,i.value,i,this),i=i.next;return e},Tt.prototype.reduceRight=function(t,e){for(var n=arguments[2],r=this.head,i=r.prev;i!==r;)e=t.call(n,e,i.value,i,this),i=i.prev;return e},Tt.prototype.updateIndexes=function(t,e){for(;t!==this.head;)t.index=e++,t=t.next},Tt.prototype.iterate=function(){return new Bt(this.head)},Bt.prototype.__iterationObject=null,Object.defineProperty(Bt.prototype,"_iterationObject",{get:function(){return this.__iterationObject||(this.__iterationObject={done:!1,value:null})}}),Bt.prototype.next=function(){if(this.at===this.head)this._iterationObject.done=!0,this._iterationObject.value=void 0;else{var t=this.at.value;this.at=this.at.next,this._iterationObject.value=t}return this._iterationObject},Tt.prototype.Node=Pt,Pt.prototype.delete=function(){this.prev.next=this.next,this.next.prev=this.prev},Pt.prototype.addBefore=function(t){var e=this.prev;this.prev=t,t.prev=e,e.next=t,t.next=this},Pt.prototype.addAfter=function(t){var e=this.next;this.next=t,t.next=e,e.prev=t,t.prev=this};var Dt=Ft;function Ft(){throw new Error("Can't construct. GenericSet is a mixin.")}Ft.prototype.isSet=!0,Ft.prototype.union=function(t){var e=this.constructClone(this);return e.addEach(t),e},Ft.prototype.intersection=function(t){return this.constructClone(this.filter((function(e){return t.has(e)})))},Ft.prototype.difference=function(t){var e=this.constructClone(this);return e.deleteEach(t),e},Ft.prototype.symmetricDifference=function(t){var e=this.union(t),n=this.intersection(t);return e.difference(n)},Ft.prototype.deleteAll=function(t){return+this.delete(t)},Ft.prototype.equals=function(t,e){var n=this;return t&&"function"==typeof t.reduce&&this.length===t.length&&t.reduce((function(t,r){return t&&n.has(r,e)}),!0)},Ft.prototype.forEach=function(t){var e=arguments[1];return this.reduce((function(n,r,i,o,a){t.call(e,r,r,o,a)}),void 0)},Ft.prototype.toJSON=function(){return this.toArray()},Ft.prototype.contains=function(t){return this.has(t)},Ft.prototype.remove=function(t){return this.delete(t)},Ft.prototype.toggle=function(t){this.has(t)?this.delete(t):this.add(t)};var zt=function(t,e){return t};Ft.prototype.valuesArray=function(){return this.map(zt)};var qt=function(t,e){return[e,t]};Ft.prototype.entriesArray=function(){return this.map(qt)};var Xt=Yt;function Yt(t,e){var n=e&&t&&t.values&&t.values();if(n&&"function"==typeof n.next)return n;if(!(this instanceof Yt))return new Yt(t);if(Array.isArray(t)||"string"==typeof t)return Yt.iterate(t);if((t=Et(t))instanceof Yt)return t;if(t.next)this.next=function(){return t.next()};else if(t.iterate){var r=t.iterate();this.next=function(){return r.next()}}else{if("[object Function]"!==Et.prototype.toString.call(t))throw new TypeError("Can't iterate "+t);this.next=t}}Yt.prototype.forEach=dt.prototype.forEach,Yt.prototype.map=dt.prototype.map,Yt.prototype.filter=dt.prototype.filter,Yt.prototype.every=dt.prototype.every,Yt.prototype.some=dt.prototype.some,Yt.prototype.any=dt.prototype.any,Yt.prototype.all=dt.prototype.all,Yt.prototype.min=dt.prototype.min,Yt.prototype.max=dt.prototype.max,Yt.prototype.sum=dt.prototype.sum,Yt.prototype.average=dt.prototype.average,Yt.prototype.flatten=dt.prototype.flatten,Yt.prototype.zip=dt.prototype.zip,Yt.prototype.enumerate=dt.prototype.enumerate,Yt.prototype.sorted=dt.prototype.sorted,Yt.prototype.group=dt.prototype.group,Yt.prototype.reversed=dt.prototype.reversed,Yt.prototype.toArray=dt.prototype.toArray,Yt.prototype.toObject=dt.prototype.toObject,Yt.prototype.iterator=dt.prototype.iterator,Yt.prototype.__iterationObject=null,Et.defineProperty(Yt.prototype,"_iterationObject",{get:function(){return this.__iterationObject||(this.__iterationObject={done:!1,value:void 0})}}),Yt.prototype.constructClone=function(t){var e=[];return e.addEach(t),e},Yt.prototype.mapIterator=function(t){var e=Yt(this),n=arguments[1],r=0;if("[object Function]"!=Et.prototype.toString.call(t))throw new TypeError;return new e.constructor((function(){if(!0!==e._iterationObject.done){var i=t.call(n,e.next().value,r++,e);e._iterationObject.value=i}return e._iterationObject}))},Yt.prototype.filterIterator=function(t){var e=Yt(this),n=arguments[1],r=0;if("[object Function]"!=Et.prototype.toString.call(t))throw new TypeError;return new e.constructor((function(){for(var i;;){if(!0===(i=e.next()).done)return i;if(t.call(n,i.value,r++,e))return i}}))},Yt.prototype.reduce=function(t){var e,n=Yt(this),r=arguments[1],i=arguments[2],o=0;if("[object Function]"!=Et.prototype.toString.call(t))throw new TypeError;if(!0===(e=n.next()).done){if(arguments.length>1)return arguments[1];throw TypeError("cannot reduce a value from an empty iterator with no initial value")}for(r=arguments.length>1?t.call(i,r,e.value,o,n):e.value,o++;;){if(!0===(e=n.next()).done)return r;r=t.call(i,r,e.value,o,n),o++}},Yt.prototype.concat=function(){return Yt.concat(Array.prototype.concat.apply(this,arguments))},Yt.prototype.dropWhile=function(t){var e,n,r=Yt(this),i=arguments[1],o=!1,a=0;if("[object Function]"!=Et.prototype.toString.call(t))throw new TypeError;for(;!0!==(n=r.next()).done;){if(!t.call(i,n.value,a,r)){o=!0,e=n.value;break}a++}return o?r.constructor([e]).concat(r):r.constructor([])},Yt.prototype.takeWhile=function(t){var e=Yt(this),n=arguments[1],r=0;if("[object Function]"!=Et.prototype.toString.call(t))throw new TypeError;return new e.constructor((function(){if(!0!==e._iterationObject.done){var i=e.next().value;t.call(n,i,r++,e)?e._iterationObject.value=i:(e._iterationObject.done=!0,e._iterationObject.value=void 0)}return e._iterationObject}))},Yt.prototype.zipIterator=function(){return Yt.unzip(Array.prototype.concat.apply(this,arguments))},Yt.prototype.enumerateIterator=function(t){return Yt.count(t).zipIterator(this)},Yt.iterate=function(t){var e;return e=0,new Yt((function(){if("object"==typeof t)for(;!(e in t);){if(e>=t.length){this._iterationObject.done=!0,this._iterationObject.value=void 0;break}e+=1}else e>=t.length&&(this._iterationObject.done=!0,this._iterationObject.value=void 0);return this._iterationObject.done||(this._iterationObject.value=t[e],e+=1),this._iterationObject}))},Yt.cycle=function(t,e){var n;return arguments.length<2&&(e=1/0),new Yt((function(){var r,i;return n&&(i=n()),n&&!0!==i.done||(e>0?(e--,r=Yt.iterate(t),i=(n=r.next.bind(r))()):(this._iterationObject.done=!0,i=this._iterationObject)),i}))},Yt.concat=function(t){var e;return t=Yt(t),new Yt((function(){var n,r;return e&&(r=e()),r&&!0!==r.done?r:!1===(r=t.next()).done?(n=Yt(r.value),(e=n.next.bind(n))()):r}))},Yt.unzip=function(t){return 0===(t=Yt(t).map(Yt)).length?new Yt([]):new Yt((function(){var e,n,r=t.map((function(t){return!0===(n=t.next()).done&&(e=!0),n.value}));return e?(this._iterationObject.done=!0,this._iterationObject.value=void 0):this._iterationObject.value=r,this._iterationObject}))},Yt.zip=function(){return Yt.unzip(Array.prototype.slice.call(arguments))},Yt.chain=function(){return Yt.concat(Array.prototype.slice.call(arguments))},Yt.range=function(t,e,n){return arguments.length<3&&(n=1),arguments.length<2&&(e=t,t=0),t=t||0,n=n||1,new Yt((function(){t>=e&&(this._iterationObject.done=!0,this._iterationObject.value=void 0);var r=t;return t+=n,this._iterationObject.value=r,this._iterationObject}))},Yt.count=function(t,e){return Yt.range(t,1/0,e)},Yt.repeat=function(t,e){return new Yt.range(e).mapIterator((function(){return t}))};var Ht=Ut;function Ut(){throw new Error("Can't construct. GenericMap is a mixin.")}function Vt(t,e){this.key=t,this.value=e}Ut.prototype.isMap=!0,Ut.prototype.addEach=function(t){var e;if(t&&Et(t)===t)if("function"==typeof t.forEach)!0===t.isMap?t.forEach((function(t,e){this.set(e,t)}),this):t.forEach((function(t){this.set(t[0],t[1])}),this);else if("number"==typeof t.length)for(e=0;e<t.length;e++)this.add(t[e],e);else Et.keys(t).forEach((function(e){this.set(e,t[e])}),this);else if(t&&"number"==typeof t.length)for(e=0;e<t.length;e++)this.add(t[e],e);return this},Ut.prototype.get=function(t,e){var n=this.store.get(new this.Item(t));return n?n.value:arguments.length>1?(console.log("Use of a second argument as default value is deprecated to match standards"),e):this.getDefault(t)},Ut.prototype.set=function(t,e){var n=new this.Item(t,e),r=this.store.get(n);return r?(this.dispatchesMapChanges&&this.dispatchBeforeMapChange(t,r.value),r.value=e,this.dispatchesMapChanges&&this.dispatchMapChange(t,e)):(this.dispatchesMapChanges&&this.dispatchBeforeMapChange(t,void 0),this.store.add(n)&&this.length++,this.dispatchesMapChanges&&this.dispatchMapChange(t,e)),this},Ut.prototype.add=function(t,e){return this.set(e,t)},Ut.prototype.has=function(t){return this.store.has(new this.Item(t))},Ut.prototype.delete=function(t){var e=new this.Item(t);if(this.store.has(e)){var n=this.store.get(e).value;return this.dispatchesMapChanges&&this.dispatchBeforeMapChange(t,n),this.store.delete(e),this.length--,this.dispatchesMapChanges&&this.dispatchMapChange(t,void 0),!0}return!1},Ut.prototype.clear=function(){var t,e;if(this.dispatchesMapChanges&&(this.forEach((function(t,e){this.dispatchBeforeMapChange(e,t)}),this),t=this.keysArray()),this.store.clear(),this.length=0,this.dispatchesMapChanges)for(var n=0;e=t[n];n++)this.dispatchMapChange(e)},Ut.prototype.reduce=function(t,e,n){return this.store.reduce((function(e,r){return t.call(n,e,r.value,r.key,this)}),e,this)},Ut.prototype.reduceRight=function(t,e,n){return this.store.reduceRight((function(e,r){return t.call(n,e,r.value,r.key,this)}),e,this)},Ut.prototype.keysArray=function(){return this.map((function(t,e){return e}))},Ut.prototype.keys=function(){return new Xt(this.keysArray(),!0)},Ut.prototype.valuesArray=function(){return this.map(Function.identity)},Ut.prototype.values=function(){return new Xt(this.valuesArray(),!0)},Ut.prototype.entriesArray=function(){return this.map((function(t,e){return[e,t]}))},Ut.prototype.entries=function(){return new Xt(this.entriesArray(),!0)},Ut.prototype.items=function(){return this.entriesArray()},Ut.prototype.equals=function(t,e){return e=e||Et.equals,this===t||(t&&"function"==typeof t.every?t.length===this.length&&t.every((function(t,n){return e(this.get(n),t)}),this):Et.keys(t).length===this.length&&Et.keys(t).every((function(n){return e(this.get(n),t[n])}),this))},Ut.prototype.toJSON=function(){return this.entriesArray()},Ut.prototype.Item=Vt,Vt.prototype.equals=function(t){return Et.equals(this.key,t.key)&&Et.equals(this.value,t.value)},Vt.prototype.compare=function(t){return Et.compare(this.key,t.key)};var Qt=Kt;function Kt(t,e){if(!(this instanceof Kt))return new Kt(t,e);e=e||Function.noop,this.getDefault=e,this.store=Object.create(null),this.length=0,this.addEach(t)}Kt.Dict=Kt,Object.addEach(Kt.prototype,dt.prototype),Object.addEach(Kt.prototype,Ht.prototype),Kt.from=dt.from,Kt.prototype.constructClone=function(t){return new this.constructor(t,this.getDefault)},Kt.prototype.assertString=function(t){if("string"!=typeof t)throw new TypeError("key must be a string but Got "+t)},Object.defineProperty(Kt.prototype,"$__proto__",{writable:!0}),Object.defineProperty(Kt.prototype,"_hasProto",{get:function(){return this.hasOwnProperty("$__proto__")&&void 0!==this._protoValue}}),Object.defineProperty(Kt.prototype,"_protoValue",{get:function(){return this.$__proto__},set:function(t){this.$__proto__=t}}),Object.defineProperty(Kt.prototype,"size",dt._sizePropertyDescriptor),Kt.prototype.get=function(t,e){return this.assertString(t),"__proto__"===t?this._hasProto?this._protoValue:arguments.length>1?e:this.getDefault(t):t in this.store?this.store[t]:arguments.length>1?e:this.getDefault(t)},Kt.prototype.set=function(t,e){this.assertString(t);var n="__proto__"===t;return(n?this._hasProto:t in this.store)?(this.dispatchesMapChanges&&this.dispatchBeforeMapChange(t,n?this._protoValue:this.store[t]),n?this._protoValue=e:this.store[t]=e,this.dispatchesMapChanges&&this.dispatchMapChange(t,e),!1):(this.dispatchesMapChanges&&this.dispatchBeforeMapChange(t,void 0),this.length++,n?this._protoValue=e:this.store[t]=e,this.dispatchesMapChanges&&this.dispatchMapChange(t,e),!0)},Kt.prototype.has=function(t){return this.assertString(t),"__proto__"===t?this._hasProto:t in this.store},Kt.prototype.delete=function(t){return this.assertString(t),"__proto__"===t?!!this._hasProto&&(this.dispatchesMapChanges&&this.dispatchBeforeMapChange(t,this._protoValue),this._protoValue=void 0,this.length--,this.dispatchesMapChanges&&this.dispatchMapChange(t,void 0),!0):t in this.store&&(this.dispatchesMapChanges&&this.dispatchBeforeMapChange(t,this.store[t]),delete this.store[t],this.length--,this.dispatchesMapChanges&&this.dispatchMapChange(t,void 0),!0)},Kt.prototype.clear=function(){var t;for(t in this._hasProto&&(this.dispatchesMapChanges&&this.dispatchBeforeMapChange("__proto__",this._protoValue),this._protoValue=void 0,this.dispatchesMapChanges&&this.dispatchMapChange("__proto__",void 0)),this.store)this.dispatchesMapChanges&&this.dispatchBeforeMapChange(t,this.store[t]),delete this.store[t],this.dispatchesMapChanges&&this.dispatchMapChange(t,void 0);this.length=0},Kt.prototype.reduce=function(t,e,n){this._hasProto&&(e=t.call(n,e,"$__proto__","__proto__",this));var r=this.store;for(var i in this.store)e=t.call(n,e,r[i],i,this);return e},Kt.prototype.reduceRight=function(t,e,n){var r=this,i=this.store;return e=Object.keys(this.store).reduceRight((function(e,o){return t.call(n,e,i[o],o,r)}),e),this._hasProto?t.call(n,e,this._protoValue,"__proto__",r):e},Kt.prototype.one=function(){var t;for(t in this.store)return this.store[t];return this._protoValue},Kt.prototype.toJSON=function(){return this.toObject()};var Wt=Jt;function Jt(){}Jt.ascii={intersection:"+",through:"-",branchUp:"+",branchDown:"+",fromBelow:".",fromAbove:"'",fromBoth:"+",strafe:"|"},Jt.unicodeRound={intersection:"╋",through:"━",branchUp:"┻",branchDown:"┳",fromBelow:"╭",fromAbove:"╰",fromBoth:"┣",strafe:"┃"},Jt.unicodeSharp={intersection:"╋",through:"━",branchUp:"┻",branchDown:"┳",fromBelow:"┏",fromAbove:"┗",fromBoth:"┣",strafe:"┃"};var $t=Zt;function Zt(t,e,n,r){if(!(this instanceof Zt))return new Zt(t,e,n,r);e=e||Object.equals,n=n||Object.hash,r=r||Function.noop,this.contentEquals=e,this.contentHash=n,this.getDefault=r;var i=this;this.buckets=new this.Buckets(null,(function(){return new i.Bucket})),this.length=0,this.addEach(t)}Zt.FastSet=Zt,Object.addEach(Zt.prototype,dt.prototype),Object.addEach(Zt.prototype,Dt.prototype),Zt.from=dt.from,Zt.prototype.Buckets=Qt,Zt.prototype.Bucket=xt,Zt.prototype.constructClone=function(t){return new this.constructor(t,this.contentEquals,this.contentHash,this.getDefault)},Zt.prototype.has=function(t){var e=this.contentHash(t);return this.buckets.get(e).has(t)},Zt.prototype.get=function(t,e){if(e)throw new Error("FastSet#get does not support second argument: equals");var n=this.contentHash(t),r=this.buckets;return r.has(n)?r.get(n).get(t):this.getDefault(t)},Zt.prototype.delete=function(t,e){if(e)throw new Error("FastSet#delete does not support second argument: equals");var n=this.contentHash(t),r=this.buckets;if(r.has(n)){var i=r.get(n);if(i.delete(t))return this.length--,0===i.length&&r.delete(n),!0}return!1},Zt.prototype.clear=function(){this.buckets.clear(),this.length=0},Zt.prototype.add=function(t){var e=this.contentHash(t),n=this.buckets;return n.has(e)||n.set(e,new this.Bucket(null,this.contentEquals)),!n.get(e).has(t)&&(n.get(e).add(t),this.length++,!0)},Zt.prototype.reduce=function(t,e){var n=arguments[2],r=this.buckets,i=0;return r.reduce((function(e,r){return r.reduce((function(e,r){return t.call(n,e,r,i++,this)}),e,this)}),e,this)},Zt.prototype.one=function(){if(this.length>0)return this.buckets.one().one()},Zt.prototype.iterate=function(){return this.buckets.valuesArray().flatten().iterate()},Zt.prototype.log=function(t,e,n,r){t=t||Wt.unicodeSharp,e=e||this.logNode,n||(n=console.log,r=console),n=n.bind(r);for(var i,o,a,s,u=this.buckets,l=u.size,h=u.keys(),c=0;i=h.next().value;)c===l-1?(o=t.fromAbove,a=" "):0===c?(o=t.branchDown,a=t.strafe):(o=t.fromBoth,a=t.strafe),s=u.get(i),n.call(r,o+t.through+t.branchDown+" "+i),s.forEach((function(i,o){var u,l,h;o===s.head.prev?(u=t.fromAbove,l=" "):(u=t.fromBoth,l=t.strafe),e(o,(function(e){h?n.call(r,a+" "+l+"  "+e):(n.call(r,a+" "+u+t.through+t.through+e),h=!0)}),(function(e){n.call(r,a+" "+t.strafe+"  "+e)}))})),c++},Zt.prototype.logNode=function(t,e){var n=t.value;Object(n)===n?JSON.stringify(n,null,4).split("\n").forEach((function(t){e(" "+t)})):e(" "+n)};var te=gt((function(t){var e,n;void 0!==yt.Set&&"function"==typeof yt.Set.prototype.values&&((e=t.exports=yt.Set).Set=e,e.prototype.reduce=function(t,e){var n=arguments[2];return this.forEach((function(r){e=t.call(n,e,r,this)})),e},e.prototype.reduceRight=function(t,e){for(var n,r=arguments[2],i=this.values(),o=this.size,a=new Array(this.size),s=o;n=i.next().value;)a[--s]=n;for(;s<o;)e=t.call(r,e,a[s++],this);return e},e.prototype.equals=function(t,e){var n=this;return t&&"function"==typeof t.reduce&&this.size===(t.size||t.length)&&t.reduce((function(t,r){return t&&n.has(r,e)}),!0)},e.prototype.constructClone=function(t){return new this.constructor(t,this.contentEquals,this.contentHash,this.getDefault)},e.prototype.toJSON=function(){return this.entriesArray()},e.prototype.one=function(){if(this.size>0)return this.values().next().value},e.prototype.pop=function(){if(this.size){for(var t,e,n=this.values();t=n.next().value;)e=t;return this.delete(e,this.size-1),e}},e.prototype.shift=function(){if(this.size){var t=this.values().next().value;return this.delete(t,0),t}},Object.defineProperty(e.prototype,"length",{get:function(){return this.size},enumerable:!0,configurable:!0}),e.from=function(t){var e=new this;return e.addEach(t),e},Object.addEach(e.prototype,dt.prototype,!1),Object.addEach(e.prototype,Dt.prototype,!1)),(n=function t(e,n,r,i){return t._init(t,this,e,n,r,i)})._init=function(t,e,n,r,i,o){if(!(e instanceof t))return new t(n,r,i,o);r=r||Object.equals,i=i||Object.hash,o=o||Function.noop,e.contentEquals=r,e.contentHash=i,e.getDefault=o,e.order=new e.Order(void 0,r),e.store=new e.Store(void 0,(function(t,e){return r(t.value,e.value)}),(function(t){return i(t.value)})),e.length=0,e.addEach(n)},n.Set=n,n.CollectionsSet=n,Object.addEach(n.prototype,dt.prototype),Object.addEach(n.prototype,Dt.prototype),n.from=dt.from,Object.defineProperty(n.prototype,"size",dt._sizePropertyDescriptor),n.prototype.Order=xt,n.prototype.Store=$t,n.prototype.constructClone=function(t){return new this.constructor(t,this.contentEquals,this.contentHash,this.getDefault)},n.prototype.has=function(t){var e=new this.order.Node(t);return this.store.has(e)},n.prototype.get=function(t,e){if(e)throw new Error("Set#get does not support second argument: equals");var n=new this.order.Node(t);return(n=this.store.get(n))?n.value:this.getDefault(t)},n.prototype.add=function(t){var e=new this.order.Node(t);return!this.store.has(e)&&(this.length,this.order.add(t),e=this.order.head.prev,this.store.add(e),this.length++,!0)},n.prototype.delete=function(t,e){if(e)throw new Error("Set#delete does not support second argument: equals");var n=new this.order.Node(t);return!!this.store.has(n)&&(n=this.store.get(n),this.store.delete(n),this.order.splice(n,1),this.length--,!0)},n.prototype.pop=function(){if(this.length){var t=this.order.head.prev.value;return this.delete(t),t}},n.prototype.shift=function(){if(this.length){var t=this.order.head.next.value;return this.delete(t),t}},n.prototype.one=function(){if(this.length>0)return this.store.one().value},n.prototype.clear=function(){this.store.clear(),this.order.clear(),this.length=0},Object.defineProperty(n.prototype,"_clear",{value:n.prototype.clear}),n.prototype.reduce=function(t,e){var n=arguments[2],r=this.order,i=0;return r.reduce((function(e,r){return t.call(n,e,r,i++,this)}),e,this)},n.prototype.reduceRight=function(t,e){var n=arguments[2],r=this.order,i=this.length-1;return r.reduceRight((function(e,r){return t.call(n,e,r,i--,this)}),e,this)},n.prototype.iterate=function(){return this.order.iterate()},n.prototype.values=function(){return new Xt(this.valuesArray(),!0)},n.prototype.log=function(){var t=this.store;return t.log.apply(t,arguments)},e?(e.prototype.valuesArray=Dt.prototype.valuesArray,e.prototype.entriesArray=Dt.prototype.entriesArray,t.exports=e,e.CollectionsSet=n):t.exports=n})),ee=gt((function(t){var e,n,r;if(void 0!==yt.Map&&"function"==typeof yt.Set.prototype.values){var i;n=e=t.exports=yt.Map,e.Map=e,i={}.__proto__===Object.prototype?function(){this.__proto__=p}:function(){Object.defineProperties(this,observableSetProperties)},Object.defineProperty(e.prototype,"makeObservable",{value:i,writable:!0,configurable:!0,enumerable:!1}),Object.defineProperty(e.prototype,"makePropertyObservable",{value:function(){},writable:!0,configurable:!0,enumerable:!1}),e.prototype.constructClone=function(t){return new this.constructor(t)},e.prototype.isMap=!0,e.prototype.addEach=function(t){if(t&&Object(t)===t)if("function"==typeof t.forEach)!0===t.isMap?t.forEach((function(t,e){this.set(e,t)}),this):t.forEach((function(t){this.set(t[0],t[1])}),this);else if("number"==typeof t.length)for(var e=0;e<t.length;e++)this.add(t[e],e);else Object.keys(t).forEach((function(e){this.set(e,t[e])}),this);else if(t&&"number"==typeof t.length)for(e=0;e<t.length;e++)this.add(t[e],e);return this},e.prototype.add=function(t,e){return this.set(e,t)},e.prototype.reduce=function(t,e){var n=arguments[2];return this.forEach((function(r,i,o){e=t.call(n,e,r,i,this)})),e},e.prototype.reduceRight=function(t,e){for(var n,r=arguments[2],i=this.keys(),o=this.size,a=new Array(this.size),s=0;n=i.next().value;)a[--o]=n;for(;s++<o;)e=t.call(r,e,this.get(a[s]),a[s],this);return e},e.prototype.equals=function(t,e){return e=e||Object.equals,this===t||(t&&"function"==typeof t.every?t.size===this.size&&t.every((function(t,n){return e(this.get(n),t)}),this):Object.keys(t).length===this.size&&Object.keys(t).every((function(n){return e(this.get(n),t[n])}),this))};var o=function(t,e){return e};e.prototype.keysArray=function(){return this.map(o)};var a=function(t,e){return t};e.prototype.valuesArray=function(){return this.map(a)};var s=function(t,e){return[e,t]};e.prototype.entriesArray=function(){return this.map(s)},e.prototype.toJSON=function(){return this.entriesArray()},e.prototype.items=function(){return this.entriesArray()},e.from=function(t){var e=new this;return e.addEach(t),e},Object.defineProperty(e.prototype,"length",{get:function(){return this.size},enumerable:!0,configurable:!0});var u=e.prototype.clear,l=e.prototype.set,h=e.prototype.delete,c={clear:{value:function(){var t;this.dispatchesMapChanges&&(this.forEach((function(t,e){this.dispatchBeforeMapChange(e,t)}),this),t=this.keysArray()),u.call(this),this.dispatchesMapChanges&&t.forEach((function(t){this.dispatchMapChange(t)}),this)},writable:!0,configurable:!0},set:{value:function(t,e){var n=this.get(t);return n?(this.dispatchesMapChanges&&this.dispatchBeforeMapChange(t,n),l.call(this,t,e),this.dispatchesMapChanges&&this.dispatchMapChange(t,e)):(this.dispatchesMapChanges&&this.dispatchBeforeMapChange(t,void 0),l.call(this,t,e),this.dispatchesMapChanges&&this.dispatchMapChange(t,e)),this},writable:!0,configurable:!0},delete:{value:function(t){return!!this.has(t)&&(this.dispatchesMapChanges&&this.dispatchBeforeMapChange(t,this.get(t)),h.call(this,t),this.dispatchesMapChanges&&this.dispatchMapChange(t,void 0),!0)}}};Object.addEach(e.prototype,dt.prototype,!1);var p=Object.create(e.prototype,c)}var f=te.CollectionsSet;r=e=function t(e,n,r,i){if(!(this instanceof t))return new t(e,n,r,i);n=n||Object.equals,r=r||Object.hash,i=i||Function.noop,this.contentEquals=n,this.contentHash=r,this.getDefault=i,this.store=new f(void 0,(function(t,e){return n(t.key,e.key)}),(function(t){return r(t.key)})),this.length=0,this.addEach(e)},e.Map=e,Object.addEach(e.prototype,dt.prototype),Object.addEach(e.prototype,Ht.prototype),Object.defineProperty(e.prototype,"size",dt._sizePropertyDescriptor),e.from=dt.from,e.prototype.constructClone=function(t){return new this.constructor(t,this.contentEquals,this.contentHash,this.getDefault)},e.prototype.log=function(t,e,n,r){e=e||this.logNode,this.store.log(t,(function(t,n,r){e(t.value.value,n,r)}),n,r)},e.prototype.logNode=function(t,e){e(" key: "+t.key),e(" value: "+t.value)},n?(t.exports=n,n.CollectionsMap=r):t.exports=r})),ne=gt((function(t){var e=t.exports.ObjectChangeDescriptor=function(t){return this.name=t,this.isActive=!1,this._willChangeListeners=null,this._changeListeners=null,this};Object.defineProperties(e.prototype,{name:{value:null,writable:!0},isActive:{value:!1,writable:!0},_willChangeListeners:{value:null,writable:!0},willChangeListeners:{get:function(){return this._willChangeListeners||(this._willChangeListeners=new this.willChangeListenersRecordConstructor(this.name))}},_changeListeners:{value:null,writable:!0},changeListeners:{get:function(){return this._changeListeners||(this._changeListeners=new this.changeListenersRecordConstructor(this.name))}},changeListenersRecordConstructor:{value:i,writable:!0},willChangeListenersRecordConstructor:{value:a,writable:!0}});var n=t.exports.ListenerGhost=Object.create(null),r=new ee;function i(t){var e=r.get(t);return e||(e="handle",e+=t,e+="Change",r.set(t,e)),this._current=null,this._current=null,this.specificHandlerMethodName=e,this}t.exports.ChangeListenersRecord=i,Object.defineProperties(i.prototype,{_current:{value:null,writable:!0},current:{get:function(){return this._current},set:function(t){this._current=t}},ListenerGhost:{value:n,writable:!0},ghostCount:{value:0,writable:!0},maxListenerGhostRatio:{value:.3,writable:!0},listenerGhostFilter:{value:function(t){return t!==this.ListenerGhost}},removeCurrentGostListenersIfNeeded:{value:function(){return this._current&&this.ghostCount/this._current.length>this.maxListenerGhostRatio&&(this.ghostCount=0,this._current=this._current.filter(this.listenerGhostFilter,this)),this._current}},dispatchBeforeChange:{value:!1,writable:!0},genericHandlerMethodName:{value:"handlePropertyChange",writable:!0}}),t.exports.WillChangeListenersRecord=a;var o=new ee;function a(t){var e=o.get(t);return e||(e="handle",e+=t,e+="WillChange",o.set(t,e)),this.specificHandlerMethodName=e,this}a.prototype=new i,a.prototype.constructor=a,a.prototype.genericHandlerMethodName="handlePropertyWillChange"})),re=ie;function ie(){throw new Error("This is an abstract interface. Mix it. Don't construct it")}var oe=ne.ObjectChangeDescriptor,ae=ne.ListenerGhost;ie.debug=!0;var se=new mt,ue=new ee;function le(t,e,n,r){if(t&&t._current){var i,o,a,s,u,l=t.specificHandlerMethodName,h=t.genericHandlerMethodName,c=ae;if(Array.isArray(t._current)){for(a=0,s=(i=t.removeCurrentGostListenersIfNeeded()).length;a<s;a++)if((u=i[a])!==c){if(!(o=u[l]||u[h]||u).call)throw new Error("No event listener for "+t.specificHandlerName+" or "+t.genericHandlerName+" or call on "+o);o.call(u,n,e,r)}}else{if(!(o=(u=t._current)[l]||u[h]||u).call)throw new Error("No event listener for "+t.specificHandlerName+" or "+t.genericHandlerName+" or call on "+o);o.call(u,n,e,r)}}}ie.ObjectChangeDescriptor=function(){},ie.prototype.getOwnPropertyChangeDescriptor=function(t){var e,n=se.get(this);if(n||(n=Object.create(null),se.set(this,n)),void 0===(e=n[t])){var r=ue.get(t);return r||(r=(r=String(t))&&r[0].toUpperCase()+r.slice(1),ue.set(t,r)),n[t]=new oe(r)}return e},ie.prototype.hasOwnPropertyChangeDescriptor=function(t){var e=se.get(this);return!!e&&(!t||void 0!==e[t])},ie.prototype.addOwnPropertyChangeListener=function(t,e,n){this.makeObservable&&!this.isObservable&&this.makeObservable();var r=ie.getOwnPropertyChangeDescriptor(this,t),i=n?r.willChangeListeners:r.changeListeners;ie.makePropertyObservable(this,t),i._current?Array.isArray(i._current)?i._current.push(e):i._current=[i._current,e]:i._current=e;var o=this;return function(){ie.removeOwnPropertyChangeListener(o,t,e,n),o=null}},ie.prototype.addBeforeOwnPropertyChangeListener=function(t,e){return ie.addOwnPropertyChangeListener(this,t,e,!0)},ie.prototype.removeOwnPropertyChangeListener=function t(e,n,r){var i,o=ie.getOwnPropertyChangeDescriptor(this,e);if((i=r?o._willChangeListeners:o._changeListeners)&&i._current)if(i._current===n)i._current=null;else{var a=i._current.lastIndexOf(n);if(-1===a)throw new Error("Can't remove property change listener: does not exist: property name"+JSON.stringify(e));o.isActive?(i.ghostCount=i.ghostCount+1,i._current[a]=t.ListenerGhost):i._current.spliceOne(a)}},ie.prototype.removeOwnPropertyChangeListener.ListenerGhost=ae,ie.prototype.removeBeforeOwnPropertyChangeListener=function(t,e){return ie.removeOwnPropertyChangeListener(this,t,e,!0)},ie.prototype.dispatchOwnPropertyChange=function t(e,n,r){var i,o=ie.getOwnPropertyChangeDescriptor(this,e);if(!o.isActive){o.isActive=!0,i=r?o._willChangeListeners:o._changeListeners;try{t.dispatchEach(i,e,n,this)}finally{o.isActive=!1}}},ie.prototype.dispatchOwnPropertyChange.dispatchEach=le,le.ListenerGhost=ae,ie.prototype.dispatchBeforeOwnPropertyChange=function(t,e){return ie.dispatchOwnPropertyChange(this,t,e,!0)};var he=new mt;new mt;var ce={get:void 0,set:void 0,configurable:!0,enumerable:!1};ie.prototype.makePropertyObservable=function(t){var e=he.get(this);if(!e||void 0===e.get(t)){if(!e){if(Array.isArray(this))return;if(!Object.isExtensible(this))throw new Error("Can't make property "+JSON.stringify(t)+" observable on "+this+" because object is not extensible");e=new ee,he.set(this,e)}var n,r=this;do{if(n=Object.getOwnPropertyDescriptor(r,t))break;r=Object.getPrototypeOf(r)}while(r);if(n){if(!n.configurable)return;if(!n.writable&&!n.set)return}else n={value:void 0,enumerable:!0,writable:!0,configurable:!0};e.set(t,n),"value"in n?(ce.get=function t(){return t.overriddenDescriptor.value},ce.set=function t(e){var n,r,i=t.overriddenDescriptor;if(e!==i.value){if(!(r=(n=t.descriptor).isActive)){n.isActive=!0;try{t.dispatchEach(n._willChangeListeners,t.key,i.value,this)}finally{}}if(i.value=e,!r)try{t.dispatchEach(n._changeListeners,t.key,e,this)}finally{n.isActive=!1}}},ce.set.dispatchEach=le,ce.set.key=t,ce.get.overriddenDescriptor=ce.set.overriddenDescriptor=n,ce.set.descriptor=se.get(this)[t],ce.enumerable=n.enumerable,ce.configurable=!0):(ce.get=n.get,ce.set=function e(){var n,r,i,o=e.overriddenGetter.call(this);if(1===arguments.length?e.overriddenSetter.call(this,arguments[0]):2===arguments.length?e.overriddenSetter.call(this,arguments[0],arguments[1]):e.overriddenSetter.apply(this,arguments),(i=e.overriddenGetter.call(this))!==o){if(!(r=(n=e.descriptor).isActive)){n.isActive=!0;try{e.dispatchEach(n._willChangeListeners,t,o,this)}finally{}}if(!r)try{e.dispatchEach(n._changeListeners,t,i,this)}finally{n.isActive=!1}}},ce.enumerable=n.enumerable,ce.configurable=!0,ce.set.dispatchEach=le,ce.set.overriddenSetter=n.set,ce.set.overriddenGetter=n.get,ce.set.descriptor=se.get(this)[t]),Object.defineProperty(this,t,ce)}},ie.getOwnPropertyChangeDescriptor=function(t,e){return t.getOwnPropertyChangeDescriptor?t.getOwnPropertyChangeDescriptor(e):ie.prototype.getOwnPropertyChangeDescriptor.call(t,e)},ie.hasOwnPropertyChangeDescriptor=function(t,e){return t.hasOwnPropertyChangeDescriptor?t.hasOwnPropertyChangeDescriptor(e):ie.prototype.hasOwnPropertyChangeDescriptor.call(t,e)},ie.addOwnPropertyChangeListener=function(t,e,n,r){if(Object.isObject(t))return t.addOwnPropertyChangeListener?t.addOwnPropertyChangeListener(e,n,r):this.prototype.addOwnPropertyChangeListener.call(t,e,n,r)},ie.removeOwnPropertyChangeListener=function(t,e,n,r){if(Object.isObject(t))return t.removeOwnPropertyChangeListener?t.removeOwnPropertyChangeListener(e,n,r):ie.prototype.removeOwnPropertyChangeListener.call(t,e,n,r)},ie.dispatchOwnPropertyChange=function(t,e,n,r){if(Object.isObject(t))return t.dispatchOwnPropertyChange?t.dispatchOwnPropertyChange(e,n,r):ie.prototype.dispatchOwnPropertyChange.call(t,e,n,r)},ie.addBeforeOwnPropertyChangeListener=function(t,e,n){return ie.addOwnPropertyChangeListener(t,e,n,!0)},ie.removeBeforeOwnPropertyChangeListener=function(t,e,n){return ie.removeOwnPropertyChangeListener(t,e,n,!0)},ie.dispatchBeforeOwnPropertyChange=function(t,e,n){return ie.dispatchOwnPropertyChange(t,e,n,!0)},ie.makePropertyObservable=function(t,e){return t.makePropertyObservable?t.makePropertyObservable(e):ie.prototype.makePropertyObservable.call(t,e)};var pe=ne.ObjectChangeDescriptor,fe=ne.ChangeListenersRecord,ye=ne.ListenerGhost,ge=new mt;function de(t){this.name=t,this.isActive=!1,this._willChangeListeners=null,this._changeListeners=null}de.prototype=new pe,de.prototype.constructor=de,de.prototype.changeListenersRecordConstructor=_e,de.prototype.willChangeListenersRecordConstructor=me,Object.defineProperty(de.prototype,"active",{get:function(){return this._active||(this._active=this._current?this._current.slice():[])}});var ve=new ee;function _e(t){var e=ve.get(t);return e||(e="handle",e+=t.slice(0,1).toUpperCase(),e+=t.slice(1),e+="RangeChange",ve.set(t,e)),this.specificHandlerMethodName=e,this}_e.prototype=new fe,_e.prototype.constructor=_e;var be=new ee;function me(t){var e=be.get(t);return e||(e="handle",e+=t.slice(0,1).toUpperCase(),e+=t.slice(1),e+="RangeWillChange",be.set(t,e)),this.specificHandlerMethodName=e,this}me.prototype=new fe,me.prototype.constructor=me;var Ee=Oe;function Oe(){throw new Error("Can't construct. RangeChanges is a mixin.")}Oe.prototype.getAllRangeChangeDescriptors=function(){return ge.has(this)||ge.set(this,new ee),ge.get(this)},Oe.prototype.getRangeChangeDescriptor=function(t){var e=this.getAllRangeChangeDescriptors();return t=t||"",e.has(t)||e.set(t,new de(t)),e.get(t)};var we=new mt,ke="dispatchesRangeChanges",Ae={get:function(){return we.get(this)},set:function(t){return we.set(this,t)},configurable:!0,enumerable:!1};Oe.prototype.addRangeChangeListener=function(t,e,n){!this.isObservable&&this.makeObservable&&this.makeObservable();var r,i=this.getRangeChangeDescriptor(e);(r=n?i.willChangeListeners:i.changeListeners)._current?Array.isArray(r._current)?r._current.push(t):r._current=[r._current,t]:r._current=t,void 0===Object.getOwnPropertyDescriptor(this.__proto__||Object.getPrototypeOf(this),ke)&&Object.defineProperty(this.__proto__||Object.getPrototypeOf(this),ke,Ae),this.dispatchesRangeChanges=!0;var o=this;return function(){o&&(o.removeRangeChangeListener(t,e,n),o=null)}},Oe.prototype.removeRangeChangeListener=function(t,e,n){var r,i=this.getRangeChangeDescriptor(e);if((r=n?i._willChangeListeners:i._changeListeners)._current)if(r._current===t)r._current=null;else{var o=r._current.lastIndexOf(t);if(-1===o)throw new Error("Can't remove range change listener: does not exist: token "+JSON.stringify(e));i.isActive?(r.ghostCount=r.ghostCount+1,r._current[o]=ye):r._current.spliceOne(o)}},Oe.prototype.dispatchRangeChange=function(t,e,n,r){var i,o,a,s,u,l,h,c,p=this.getAllRangeChangeDescriptors(),f=p.values();for(p.dispatchBeforeChange=r;i=f.next().value;){if(i.isActive)return;if((o=r?i._willChangeListeners:i._changeListeners)&&o._current)if(a=o.specificHandlerMethodName,Array.isArray(o._current)){if(o._current.length){i.isActive=!0;try{for(h=o.removeCurrentGostListenersIfNeeded(),c=ye,s=0,u=h.length;s<u;s++)if((l=h[s])!==c)if(l[a])l[a](t,e,n,this,r);else{if(!l.call)throw new Error("Handler "+l+" has no method "+a+" and is not callable");l.call(this,t,e,n,this,r)}}finally{i.isActive=!1}}}else{i.isActive=!0;try{if((l=o._current)[a])l[a](t,e,n,this,r);else{if(!l.call)throw new Error("Handler "+l+" has no method "+a+" and is not callable");l.call(this,t,e,n,this,r)}}finally{i.isActive=!1}}}},Oe.prototype.addBeforeRangeChangeListener=function(t,e){return this.addRangeChangeListener(t,e,!0)},Oe.prototype.removeBeforeRangeChangeListener=function(t,e){return this.removeRangeChangeListener(t,e,!0)},Oe.prototype.dispatchBeforeRangeChange=function(t,e,n){return this.dispatchRangeChange(t,e,n,!0)};var Ce=Le;function Le(t,e,n){return xt._init(Le,this,t,e,n)}Le.prototype=new xt,Le.prototype.constructor=Le,Le.List=Le,Le.from=xt.from,Object.addEach(Le.prototype,re.prototype),Object.addEach(Le.prototype,Ee.prototype),Le.prototype.makeObservable=function(){this.head.index=-1,this.updateIndexes(this.head.next,0),this.dispatchesRangeChanges=!0},Object.defineProperties(Le.prototype,{_dispatchEmptyArray:{value:[]}}),Le.prototype.delete=function(t,e){var n=this.findLast(t,e);if(n){if(this.dispatchesRangeChanges){var r=[],i=[t];this.dispatchBeforeRangeChange(r,i,n.index)}return n.delete(),this.length--,this.dispatchesRangeChanges&&(this.updateIndexes(n.next,n.index),this.dispatchRangeChange(r,i,n.index)),!0}return!1},Object.defineProperty(Le.prototype,"superClear",{value:xt.prototype.clear,enumerable:!1,configurable:!0,writable:!0}),Le.prototype.clear=function(){var t,e;this.dispatchesRangeChanges&&(e=this.toArray(),t=[],this.dispatchBeforeRangeChange(t,e,0)),this.superClear(),this.dispatchesRangeChanges&&this.dispatchRangeChange(t,e,0)},Le.prototype.add=function(t){var e=new this.Node(t);return this.dispatchesRangeChanges&&(e.index=this.length,this.dispatchBeforeRangeChange([t],[],e.index)),this._addNode(e),this.dispatchesRangeChanges&&this.dispatchRangeChange([t],[],e.index),!0},Object.defineProperty(Le.prototype,"superPush",{value:xt.prototype.push,enumerable:!1,configurable:!0,writable:!0}),Le.prototype.push=function(){if(this.dispatchesRangeChanges){var t=Array.prototype.slice.call(arguments),e=[],n=this.length;this.dispatchBeforeRangeChange(t,e,n);var r=this.head.prev}1===arguments.length?this.superPush.call(this,arguments[0]):2===arguments.length?this.superPush.call(this,arguments[0],arguments[1]):this.superPush.apply(this,arguments),this.dispatchesRangeChanges&&(this.updateIndexes(r.next,void 0===r.index?0:r.index+1),this.dispatchRangeChange(t,e,n))},Object.defineProperty(Le.prototype,"superUnshift",{value:xt.prototype.unshift,enumerable:!1,configurable:!0,writable:!0}),Le.prototype.unshift=function(){if(this.dispatchesRangeChanges){var t=Array.prototype.slice.call(arguments),e=[];this.dispatchBeforeRangeChange(t,e,0)}1===arguments.length?this.superUnshift.call(this,arguments[0]):2===arguments.length?this.superUnshift.call(this,arguments[0],arguments[1]):this.superUnshift.apply(this,arguments),this.dispatchesRangeChanges&&(this.updateIndexes(this.head.next,0),this.dispatchRangeChange(t,e,0))},Object.defineProperty(Le.prototype,"_beforePop",{value:function(t,e){var n;return this.dispatchesRangeChanges&&(n=[t],this.dispatchBeforeRangeChange(this._dispatchEmptyArray,n,e)),n},enumerable:!1,configurable:!0,writable:!0}),Object.defineProperty(Le.prototype,"_afterPop",{value:function(t,e,n){this.dispatchesRangeChanges&&this.dispatchRangeChange(this._dispatchEmptyArray,n,e)},enumerable:!1,configurable:!0,writable:!0}),Object.defineProperty(Le.prototype,"superPop",{value:xt.prototype.pop,enumerable:!1,configurable:!0,writable:!0}),Le.prototype.pop=function(){return this.superPop(this._beforePop,this._afterPop)},Object.defineProperty(Le.prototype,"_beforeShift",{value:function(t,e){var n;return this.dispatchesRangeChanges&&(n=[t],this.dispatchBeforeRangeChange(this._dispatchEmptyArray,n,e)),n},enumerable:!1,configurable:!0,writable:!0}),Object.defineProperty(Le.prototype,"_afterShift",{value:function(t,e,n){this.dispatchesRangeChanges&&(this.updateIndexes(this.head.next,e),this.dispatchRangeChange(this._dispatchEmptyArray,n,e))},enumerable:!1,configurable:!0,writable:!0}),Object.defineProperty(Le.prototype,"superShift",{value:xt.prototype.shift,enumerable:!1,configurable:!0,writable:!0}),Le.prototype.shift=function(){return this.superShift(this._beforeShift,this._afterShift)},Object.defineProperty(Le.prototype,"superSwap",{value:xt.prototype.swap,enumerable:!1,configurable:!0,writable:!0}),Le.prototype.swap=function(t,e,n){var r,i;return this.superSwap(t,e,n,(function(t,e,n){this.dispatchesRangeChanges&&(r=t===this.head?this.length:t.prev===this.head?0:t.index,i=t.prev,this.dispatchBeforeRangeChange(e,n,r))}),(function(t,e,n){this.dispatchesRangeChanges&&(t===this.head?this.updateIndexes(this.head.next,0):this.updateIndexes(i.next,i.index+1),this.dispatchRangeChange(e,n,r))}))},Object.defineProperty(Le.prototype,"superReverse",{value:xt.prototype.reverse,enumerable:!1,configurable:!0,writable:!0}),Le.prototype.reverse=function(){if(this.dispatchesRangeChanges){var t=this.toArray(),e=t.reversed();this.dispatchBeforeRangeChange(e,t,0)}return this.superReverse(),this.dispatchesRangeChanges&&this.dispatchRangeChange(e,t,0),this};var Ne=function(){function t(){n(this,t),o(this,"__internal",new Ce)}return i(t,[{key:"add",value:function(t){return this.__internal.push(t)}},{key:"isEmpty",value:function(){return 0===this.__internal.length}},{key:"poll",value:function(){return this.__internal.shift()}},{key:"addAll",value:function(t){var e;return(e=this.__internal).push.apply(e,v(t))}}]),t}(),Se=function(t){a(r,t);var e=y(r);function r(){return n(this,r),e.apply(this,arguments)}return r}(N),Ge=function t(){n(this,t)};o(Ge,"out",{println:function(){var t;(t=console).log.apply(t,arguments)}}),o(Ge,"err",{println:function(){var t;(t=console).error.apply(t,arguments)}});var Re,je=function(){function t(){n(this,t),o(this,"count",void 0),o(this,"running",void 0),o(this,"started",void 0),o(this,"totalElapsed",void 0),this.count=0,this.totalElapsed=0,this.running=!1,this.started=null,this.start()}return i(t,[{key:"getElapsed",value:function(){return t.now()-this.started}},{key:"getElapsedTotal",value:function(){return this.totalElapsed}},{key:"getNumCounts",value:function(){return this.count}},{key:"log",value:function(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:X.FINE;this.stop(),E.LOGGING_ENABLED&&null!==e?e.log(r,"".concat(n," took ").concat(t.in(this.totalElapsed,I.SECONDS).toFixed(2).padStart(5)," seconds (wall clock time").concat(1===this.count?"":", ".concat(this.count," timings"))):Ge.out.println("".concat(n," took ").concat(t.in(this.totalElapsed,I.SECONDS).toFixed(3).padStart(5)," seconds (wall clock time").concat(1===this.count?"":", ".concat(this.count," timings")))}},{key:"start",value:function(){this.running||(this.started=t.now(),this.running=!0)}},{key:"stop",value:function(){this.running&&(this.totalElapsed+=this.getElapsed(),this.count++,this.running=!1)}}],[{key:"now",value:function(){if("object"===("undefined"==typeof process?"undefined":e(process))){var t=d(process.hrtime(),2);return 1e10*t[0]+t[1]}return performance.now()}},{key:"in",value:function(t,e){return t/e}}]),t}(),Me=function(){function t(){n(this,t)}return i(t,null,[{key:"elapsed",value:function(t){return this.timers.containsKey(t)?this.timers.get(t).getElapsedTotal():-1}},{key:"in",value:function(t,e){return t/e}},{key:"log",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:X.FINE;this.timers.containsKey(t)&&this.timers.get(t).log(e,t,n)}},{key:"logAll",value:function(t){t.log(X.FINE,""),t.log(X.FINE,"TIMERS");var e,n=!1,r=null,i=et.comparingInt(P),o=m(this.timers.keySet());try{for(o.s();!(e=o.n()).done;){var a=e.value;(!n||i(a,r)>0)&&(n=!0,r=a)}}catch(t){o.e(t)}finally{o.f()}var s,u=(n?r:"").length,l=function(t){return t.padEnd(u)},h=new N,c=m(this.timers.entrySet());try{for(c.s();!(s=c.n()).done;){var p=s.value;p.getKey().startsWith("[")||h.add(p)}}catch(t){c.e(t)}finally{c.f()}h.sort(Z.comparingByKey());var f,y=m(h);try{for(y.s();!(f=y.n()).done;){var g=f.value;g.getValue().log(t,l(g.getKey()))}}catch(t){y.e(t)}finally{y.f()}var d,v=new N,_=m(this.timers.entrySet());try{for(_.s();!(d=_.n()).done;){var b=d.value;b.getKey().startsWith("[")&&v.add(b)}}catch(t){_.e(t)}finally{_.f()}v.sort(Z.comparingByKey());var E,O="",w=m(v.toArray());try{for(w.s();!(E=w.n()).done;){var k=E.value,A=k.getKey().indexOf("]")+1,C=k.getKey().substring(0,A);C!==O&&(O=C,t.log(X.FINE,""),t.log(X.FINE,O)),k.getValue().log(t,l(k.getKey().substring(A+1)))}}catch(t){w.e(t)}finally{w.f()}}},{key:"start",value:function(t){this.timers.containsKey(t)?this.timers.get(t).start():this.timers.put(t,new je)}},{key:"stop",value:function(t){this.timers.get(t).stop()}},{key:"reset",value:function(){this.timers.clear()}}]),t}();function Ie(t){return t instanceof N}o(Me,"timers",new $),Re=Symbol.iterator;var xe=function(){function t(e,r,i,a){n(this,t),o(this,"cell",void 0),o(this,"parent",void 0),o(this,"_isOrphan",void 0),o(this,"children",void 0),o(this,"glyphs",void 0),o(this,"neighbors",void 0),this.cell=new k(e,r,i,a),this.parent=null,this._isOrphan=!1,this.children=null,this.glyphs=new N(E.MAX_GLYPHS_PER_CELL),this.neighbors=new N(pt.values().length);var s,u=m(pt.values());try{for(u.s();!(s=u.n()).done;){s.value;this.neighbors.add(new N)}}catch(t){u.e(t)}finally{u.f()}}return i(t,[{key:"clear",value:function(){if(null!=this.children){var t,e=m(this.children);try{for(e.s();!(t=e.n()).done;){t.value.clear()}}catch(t){e.e(t)}finally{e.f()}this.children=null}if(null!=this.glyphs){var n,r=m(this.glyphs);try{for(r.s();!(n=r.n()).done;){n.value.removeCell(this)}}catch(t){r.e(t)}finally{r.f()}this.glyphs.clear()}else this.glyphs=new N(E.MAX_GLYPHS_PER_CELL);var i,o=m(this.neighbors);try{for(o.s();!(i=o.n()).done;){i.value.clear()}}catch(t){o.e(t)}finally{o.f()}}},{key:"contains",value:function(t,e){var n=this.getRoot();return this.cell.getMinX()<=t&&this.cell.getMinY()<=e&&(t<this.cell.getMaxX()||t==n.cell.getMaxX())&&(e<this.cell.getMaxY()||e==n.cell.getMaxY())}},{key:"getGlyphs",value:function(){return this.glyphs}},{key:"getGlyphsAlive",value:function(){if(null==this.glyphs)return this.glyphs;var t,e=new N,n=m(this.glyphs);try{for(n.s();!(t=n.n()).done;){var r=t.value;r.isAlive()&&e.add(r)}}catch(t){n.e(t)}finally{n.f()}return e}},{key:"getHeight",value:function(){return this.cell.getHeight()}},{key:"getLeaves",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];if(e.length>0){if(ht(e[0])){var r=e[0];if(Ie(e[1])){var i=e[1];return this.__getLeavesSideResult(r,i)}if(O(e[1])){var o=e[1],a=e[2];return this.__getLeavesSideRectangleResult(r,o,a)}return this.__getLeavesSide(r)}if(O(e[0])){var s=e[0];if(Ie(e[1])){var u=e[1];return this.__getLeavesRectangleResult(s,u)}return this.__getLeavesRectangle(s)}if(st(e[0])){var l=e[0];if("number"==typeof e[1]){var h=e[1];if(Ie(e[2])){var c=e[2];return this.__getLeavesGlyphAtResult(l,h,c)}return this.__getLeavesGlyphAt(l,h)}}throw new Error("unresolved choice")}return this.__getLeaves()}},{key:"__getLeaves",value:function(){Me.start("[QuadTree] getLeaves");var t=new N,e=new Se;for(e.add(this);!e.isEmpty();){var n=e.poll();n.isLeaf()?t.add(n):e.addAll(ft.asList(n.children))}return Me.stop("[QuadTree] getLeaves"),t}},{key:"__getLeavesSide",value:function(t){Me.start("[QuadTree] getLeaves");var e=new N;return this.__getLeavesSideResult(t,e),Me.stop("[QuadTree] getLeaves"),e}},{key:"__getLeavesRectangle",value:function(t){Me.start("[QuadTree] getLeaves(Rectangle2D)");var e=new N;return this.__getLeavesRectangleResult(t,e),Me.stop("[QuadTree] getLeaves(Rectangle2D)"),e}},{key:"__getLeavesGlyphAt",value:function(t,e){Me.start("[QuadTree] getLeaves");var n=new N;return this.__getLeavesGlyphAtResult(t,e,n),Me.stop("[QuadTree] getLeaves"),n}},{key:"getNeighbors",value:function(t){return this.neighbors.get(t.ordinal())}},{key:"getNonOrphanAncestor",value:function(){for(var t=this;t.isOrphan();)t=t.parent;return t}},{key:"getParent",value:function(){return this.parent}},{key:"getRectangle",value:function(){return this.cell}},{key:"getRoot",value:function(){return this.isRoot()?this:this.parent.getRoot()}},{key:"getSide",value:function(t){return new k(this.cell.getX()+(t===pt.RIGHT?this.cell.getWidth():0),this.cell.getY()+(t===pt.BOTTOM?this.cell.getHeight():0),t==pt.TOP||t===pt.BOTTOM?this.cell.getWidth():0,t==pt.RIGHT||t===pt.LEFT?this.cell.getHeight():0)}},{key:"getSize",value:function(){if(this.isLeaf())return 1;var t,e=1,n=m(this.children);try{for(n.s();!(t=n.n()).done;){e+=t.value.getSize()}}catch(t){n.e(t)}finally{n.f()}return e}},{key:"getTreeHeight",value:function(){if(this.isLeaf())return 0;var t,e=1,n=m(this.children);try{for(n.s();!(t=n.n()).done;){var r=t.value.getTreeHeight();e=Math.max(e,r+1)}}catch(t){n.e(t)}finally{n.f()}return e}},{key:"getWidth",value:function(){return this.cell.getWidth()}},{key:"getX",value:function(){return this.cell.getX()}},{key:"getY",value:function(){return this.cell.getY()}},{key:"insert",value:function(t,e){if(nt.count("QuadTree insert"),F.__intersectAtGlyphRectangle(t,this.cell)>e+B.EPS)return nt.count("QuadTree insert",!1),0;nt.count("QuadTree insert",!0),Me.start("[QuadTree] insert");var n=0;if(this.isLeaf())this.glyphs.contains(t)||(this.glyphs.add(t),t.addCell(this),n=1);else{var r,i=m(this.children);try{for(i.s();!(r=i.n()).done;){n+=r.value.insert(t,e)}}catch(t){i.e(t)}finally{i.f()}}return Me.stop("[QuadTree] insert"),n}},{key:"insertCenterOf",value:function(t){return nt.count("QuadTree insertCenterOf"),t.getX()<this.cell.getMinX()||t.getX()>this.cell.getMaxX()||t.getY()<this.cell.getMinY()||t.getY()>this.cell.getMaxY()?(nt.count("QuadTree insertCenterOf",!1),!1):(nt.count("QuadTree insertCenterOf",!0),Me.start("[QuadTree] insert"),this.isLeaf()&&this.glyphs.size()<E.MAX_GLYPHS_PER_CELL?(this.glyphs.contains(t)||(this.glyphs.add(t),t.addCell(this)),!0):(this.isLeaf()&&this.__split(),this.children[pt.quadrant(this.cell,t.getX(),t.getY())].insertCenterOf(t),Me.stop("[QuadTree] insert"),!0))}},{key:"isOrphan",value:function(){return this._isOrphan}},{key:"isLeaf",value:function(){return null==this.children}},{key:"isRoot",value:function(){return null==this.parent}},{key:"iterator",value:function(){return new Te(this)}},{key:Re,value:function(){return new Te(this)}},{key:"iteratorGlyphsAlive",value:function(){return this.__getLeaves().stream().flatMap((function(t){return t.getGlyphsAlive().toArray()})).iterator()}},{key:"removeGlyph",value:function(t,e){return nt.count("QuadTree remove"),null!=this.glyphs?nt.count("QuadTree remove",this.glyphs.remove(t)):nt.count("QuadTree remove",!1),null!=this.parent&&this.parent.joinMaybe(e)}},{key:"split",value:function(t){if("number"==typeof t)return this.__splitAt(t);if(void 0===t)return this.__split();throw new Error("better resolver")}},{key:"__split",value:function(){if(Me.start("[QuadTree] split"),this.splitCell(),!this.glyphs.isEmpty()){var t,e=m(this.glyphs);try{for(e.s();!(t=e.n()).done;){var n=t.value;this.children[pt.quadrant(this.cell,n.getX(),n.getY())].insertCenterOf(n)}}catch(t){e.e(t)}finally{e.f()}this.glyphs=null}Me.stop("[QuadTree] split")}},{key:"__splitAt",value:function(t){if(Me.start("[QuadTree] split"),this.splitCell(),!this.glyphs.isEmpty()){var e,n=m(this.glyphs);try{for(n.s();!(e=n.n()).done;){var r=e.value;r.isAlive()&&this.insert(r,t)}}catch(t){n.e(t)}finally{n.f()}this.glyphs=null;var i,o=m(this.children);try{for(o.s();!(i=o.n()).done;){var a=i.value;a.glyphs.size()>E.MAX_GLYPHS_PER_CELL&&a.__splitAt(t)}}catch(t){o.e(t)}finally{o.f()}}Me.stop("[QuadTree] split")}},{key:"toString",value:function(){return"".concat(t.name,"[cell = [").concat(this.cell.getMinX()," ; ").concat(this.cell.getMaxX(),"] x [").concat(this.cell.getMinY()," ; ").concat(this.cell.getMaxY(),"]]")}},{key:"__getLeavesGlyphAtResult",value:function(t,e,n){if(!(F.__intersectAtGlyphRectangle(t,this.cell)>e+B.EPS))if(this.isLeaf())n.add(this);else{var r,i=m(this.children);try{for(i.s();!(r=i.n()).done;){r.value.__getLeavesGlyphAtResult(t,e,n)}}catch(t){i.e(t)}finally{i.f()}}}},{key:"__getLeavesSideResult",value:function(t,e){this.__getLeavesSideRectangleResult(t,null,e)}},{key:"__getLeavesRectangleResult",value:function(t,e){if(B.intervalsOverlap([this.cell.getMinX(),this.cell.getMaxX()],[t.getMinX(),t.getMaxX()])&&B.intervalsOverlap([this.cell.getMinY(),this.cell.getMaxY()],[t.getMinY(),t.getMaxY()]))if(this.isLeaf())e.add(this);else{var n,r=m(this.children);try{for(r.s();!(n=r.n()).done;){n.value.__getLeavesRectangleResult(t,e)}}catch(t){r.e(t)}finally{r.f()}}}},{key:"__getLeavesSideRectangleResult",value:function(t,e,n){if(null!=e){var r=[null,null],i=[null,null];if(t==pt.TOP||t==pt.BOTTOM?(r[0]=e.getMinX(),r[1]=e.getMaxX(),i[0]=this.cell.getMinX(),i[1]=this.cell.getMaxX()):(r[0]=e.getMinY(),r[1]=e.getMaxY(),i[0]=this.cell.getMinY(),i[1]=this.cell.getMaxY()),!B.openIntervalsOverlap(r,i))return}if(this.isLeaf())n.add(this);else{var o,a=m(t.quadrants());try{for(a.s();!(o=a.n()).done;){var s=o.value;this.children[s].__getLeavesSideRectangleResult(t,e,n)}}catch(t){a.e(t)}finally{a.f()}}}},{key:"joinMaybe",value:function(t){if(Me.start("[QuadTree] join"),this.isLeaf())return Me.stop("[QuadTree] join"),!1;var e,n=0,r=m(this.children);try{for(r.s();!(e=r.n()).done;){var i=e.value;if(!i.isLeaf())return Me.stop("[QuadTree] join"),!1;n+=i.getGlyphsAlive().size()}}catch(t){r.e(t)}finally{r.f()}if(n>E.MAX_GLYPHS_PER_CELL)return Me.stop("[QuadTree] join"),!1;nt.count("QuadTree join cells"),this.glyphs=new N(E.MAX_GLYPHS_PER_CELL);for(var o=0;o<this.children.length;++o){var a,s=this.children[o],u=m(s.getGlyphsAlive());try{for(u.s();!(a=u.n()).done;){var l=a.value;this.glyphs.contains(l)||(this.glyphs.add(l),l.addCell(this)),l.removeCell(s)}}catch(t){u.e(t)}finally{u.f()}s.glyphs=null,s._isOrphan=!0;var h,c=m(pt.quadrant(o));try{for(c.s();!(h=c.n()).done;){var p,f=h.value,y=this.neighbors.get(f.ordinal()),g=m(s.neighbors.get(f.ordinal()));try{for(g.s();!(p=g.n()).done;){var d=p.value;y.contains(d)||y.add(d)}}catch(t){g.e(t)}finally{g.f()}}}catch(t){c.e(t)}finally{c.f()}}var v,_=m(pt.values());try{for(_.s();!(v=_.n()).done;){var b,O=v.value,w=m(this.neighbors.get(O.ordinal()));try{for(w.s();!(b=w.n()).done;){var k,A=b.value.neighbors.get(O.opposite().ordinal()),C=m(this.children);try{for(C.s();!(k=C.n()).done;){var L=k.value;A.remove(L)}}catch(t){C.e(t)}finally{C.f()}A.add(this)}}catch(t){w.e(t)}finally{w.f()}}}catch(t){_.e(t)}finally{_.f()}return this.children=null,Me.stop("[QuadTree] join"),null!=this.parent&&this.parent.joinMaybe(t),!0}},{key:"splitCell",value:function(){if(!this.isLeaf())throw new Error("cannot split cell that is already split");nt.count("QuadTree split cell"),this.children=[null,null,null,null];var e=this.getX(),n=this.getY(),r=this.getWidth(),i=this.getHeight();if(r/2<E.MIN_CELL_SIZE||i/2<E.MIN_CELL_SIZE)throw new Error("cannot split a tiny cell");for(var o=0;o<4;++o)this.children[o]=new t(e+(o%2==0?0:r/2),n+(o<2?0:i/2),r/2,i/2),this.children[o].parent=this;var a,s=m(pt.values());try{for(s.s();!(a=s.n()).done;){var u,l=a.value,h=m(this.neighbors.get(l.ordinal()));try{for(h.s();!(u=h.n()).done;){var c=u.value,p=c.neighbors.get(l.opposite().ordinal());p.remove(this);var f,y=m(l.quadrants());try{for(y.s();!(f=y.n()).done;){var g=f.value;B.openIntervalsOverlap(pt.interval(this.children[g].cell,l),pt.interval(c.cell,l))&&p.add(this.children[g])}}catch(t){y.e(t)}finally{y.f()}}}catch(t){h.e(t)}finally{h.f()}}}catch(t){s.e(t)}finally{s.f()}var d,v=m(pt.values());try{for(v.s();!(d=v.n()).done;){var _,b=d.value,O=this.neighbors.get(b.ordinal()),w=m(b.quadrants());try{for(w.s();!(_=w.n()).done;){var k,A=_.value,C=pt.interval(this.children[A].cell,b),L=new N,S=m(O);try{for(S.s();!(k=S.n()).done;){var G=k.value;B.openIntervalsOverlap(C,pt.interval(G.cell,b))&&L.add(G)}}catch(t){S.e(t)}finally{S.f()}this.children[A].neighbors.get(b.ordinal()).addAll(L.toArray()),this.children[A].neighbors.get(b.opposite().ordinal()).add(this.children[pt.quadrantNeighbor(A,b.opposite())])}}catch(t){w.e(t)}finally{w.f()}O.clear()}}catch(t){v.e(t)}finally{v.f()}}}]),t}(),Te=function(){function t(e){n(this,t),o(this,"toVisit",void 0),this.toVisit=new Ne,this.toVisit.add(e)}return i(t,[{key:"isDone",value:function(){return this.toVisit.isEmpty()}},{key:"next",value:function(){var t=this.toVisit.poll();return t.isLeaf()||this.toVisit.addAll(t.children),{value:t,done:this.isDone()}}}]),t}(),Be=function(){function t(e,r){n(this,t),o(this,"glyph",void 0),o(this,"at",void 0),o(this,"createdFrom",void 0),this.glyph=e,this.at=r;for(var i=arguments.length,a=new Array(i>2?i-2:0),s=2;s<i;s++)a[s-2]=arguments[s];0===a.length?this.createdFrom=null:this.createdFrom=N.__new(Array.from(a))}return i(t,[{key:"alsoCreatedFrom",value:function(t){null==this.createdFrom&&(this.createdFrom=new N(2)),this.createdFrom.contains(t)||this.createdFrom.add(t)}},{key:"compareTo",value:function(t){return Math.sign(this.at-t.at)}},{key:"getAt",value:function(){return this.at}},{key:"getGlyph",value:function(){return this.glyph}},{key:"setGlyph",value:function(t){this.glyph=t}},{key:"toString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,o=e+"  ",a=new T(e);if(a.append(t.name),a.append("[\n"),a.append(o),a.append(this.glyph.toString()),a.append(" at "),a.append(this.at),null==this.createdFrom)a.append("\n");else if(a.append("from (".concat(this.createdFrom.size(),")\n")),n){this.createdFrom.sort((function(t,e){var n=Math.sign(e.getAt()-t.getAt());return 0===n?e.getGlyph().getN()-t.getGlyph().getN():n}));var s,u=0,l=m(this.createdFrom);try{for(l.s();!(s=l.n()).done;){var h=s.value;if(a.append(h.toString(o,r,r,i)),++u==i)break}}catch(t){l.e(t)}finally{l.f()}u<this.createdFrom.size()&&(a.append(o),a.append("... (").append(this.createdFrom.size()-u).append(" more)\n"))}return a.append(e),a.append("]\n"),a.toString()}}]),t}();var Pe,De,Fe=E.LOGGING_ENABLED&&null!==(Pe=De=K.getLogger("FirstMergeRecorder"))&&void 0!==Pe&&Pe.isLoggable(X.FINER)?De:null,ze=function(){function t(){n(this,t),o(this,"at",void 0),o(this,"glyphs",void 0),o(this,"size",void 0),this.at=N.__new(ft.nCopies(E.MAX_MERGES_TO_RECORD,Number.POSITIVE_INFINITY)),this.glyphs=new N(E.MAX_MERGES_TO_RECORD);for(var e=0;e<E.MAX_MERGES_TO_RECORD;++e)this.glyphs.add(new N(1));this.size=0,E.LOGGING_ENABLED&&null!==Fe&&Fe.log(X.FINER,"constructed an empty FirstMerge ####")}return i(t,[{key:"accept",value:function(t,e){E.LOGGING_ENABLED&&null!==Fe&&Fe.log(X.FINER,"accepting ".concat(e," into ####"));for(var n=F.__intersectAtGlyphGlyph(t._from,e),r=0;r<E.MAX_MERGES_TO_RECORD;++r){if(n<this.at.get(r)){Number.isFinite(this.at.get(r))||this.size++,this.at.size()===E.MAX_MERGES_TO_RECORD&&(this.at.removeI(this.at.size()-1),this.glyphs.addI(r,this.glyphs.removeI(this.glyphs.size()-1))),this.at.addI(r,n),this.glyphs.get(r).clear(),this.glyphs.get(r).add(e);break}if(n==this.at.get(r)){this.glyphs.get(r).add(e);break}}E.LOGGING_ENABLED&&null!==Fe&&Fe.log(X.FINER,"#### now has glyphs ".concat(this.glyphs.toArray().join(", ")," at [").concat(this.at.toArray().join(", "),"]"))}},{key:"combine",value:function(t){E.LOGGING_ENABLED&&null!==Fe&&Fe.log(X.FINER,"combining #### and ####;\n#### has glyphs ".concat(this.glyphs.toArray().join(", ")," at ").concat(this.at,";\n#### has glyphs ").concat(t.glyphs.toArray().join(", ")," at ").concat(t.at));for(var e=0,n=0,r=qe.COMBINE_RESULT,i=0;i<E.MAX_MERGES_TO_RECORD;++i)t.at.get(n)<this.at.get(e)?(B.swap(r.at,i,t.at,n),B.swap(r.glyphs,i,t.glyphs,n),n++):B.Double.eq(t.at.get(n),this.at.get(e))?(
//! } else if (that.at.get(thatInd) == this.at.get(thisInd)) {
//! } else if (that.at.get(thatInd).equals(this.at.get(thisInd))) {
B.swap(r.at,i,t.at,n),B.swap(r.glyphs,i,t.glyphs,n),r.glyphs.get(i).addAll(this.glyphs.get(e).toArray()),e++,n++):(B.swap(r.at,i,this.at,e),B.swap(r.glyphs,i,this.glyphs,e),e++),r.size++;E.LOGGING_ENABLED&&null!==Fe&&Fe.log(X.FINER,"result #### of merging #### and #### has glyphs ".concat(r.glyphs.toArray().join(", ")," at ").concat(r.at," (storing in #### now)"));var o=this.at;this.at=r.at,r.at=o;var a=this.glyphs;return this.glyphs=r.glyphs,r.glyphs=a,this.size=r.size,r.reset(),this}},{key:"getGlyphs",value:function(){return this.glyphs.get(0)}},{key:"reset",value:function(){this.resizeIfNeeded();for(var t=0;t<E.MAX_MERGES_TO_RECORD;++t)this.at.set(t,Number.POSITIVE_INFINITY),this.glyphs.get(t).clear();this.size=0}},{key:"resizeIfNeeded",value:function(){var t=E.MAX_MERGES_TO_RECORD,e=this.at.size();if(e<t)for(var n=e;n<t;++n)this.at.add(Number.POSITIVE_INFINITY),this.glyphs.add(new N(1));else if(e>t)for(var r=e-1;r>=t;--r)this.at.removeI(r),this.glyphs.removeI(r)}},{key:"pop",value:function(t){if(0===this.size)return null;var e=this.at.get(0);ft.rotate(this.at,1);var n=this.glyphs.get(0);ft.rotate(this.glyphs,1),this.size--;var r,i=new Array(n.size()),o=0,a=m(n);try{for(a.s();!(r=a.n()).done;){var s=r.value;i[o++]=new H(t,s,E.ROBUST?F.__intersectAtGlyphGlyph(t,s):e)}}catch(t){a.e(t)}finally{a.f()}return i}}]),t}(),qe=function(){function t(){n(this,t),o(this,"_from",void 0),o(this,"merge",void 0),this._from=null,this.merge=new ze}return i(t,[{key:"addEventsTo",value:function(e){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(E.ROBUST){var i,o=m(this.merge.getGlyphs());try{for(o.s();!(i=o.n()).done;){var a=i.value;e.add(new H(this._from,a))}}catch(t){o.e(t)}finally{o.f()}this.merge.getGlyphs().clear()}else{for(;null!==(n=this.merge.pop(this._from));){var s,u=m(n);try{for(u.s();!(s=u.n()).done;){var l=s.value;E.LOGGING_ENABLED&&null!==Fe&&Fe.log(X.FINE,"recorded ".concat(l)),this._from.__recordG(l)}}catch(t){u.e(t)}finally{u.f()}}this._from.popMergeInto(e,r)}t.firstReusedRecord=null}},{key:"collector",value:function(){var e=this;return void 0===t.collector&&(t.collector=function(n){return n.reduce((function(t,n){return t.accept(e,n),t}),t.newInstance())}),t.collector}},{key:"from",value:function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}((function(t){E.LOGGING_ENABLED&&null!==Fe&&Fe.log(X.FINE,"recording merges from ".concat(t)),this._from=t,this.merge.reset()}))},{key:"record",value:function(t,e,n){if(Array.isArray(t)&&void 0!==e&&void 0!==n)return this.__recordGlyphNumberNumber(t,e,n);if(t instanceof G)return this.__recordStream(t);if(t instanceof N)return this.__recordArrayList(t);throw new Error("failed to find a way")}},{key:"__recordGlyphNumberNumber",value:function(t,e,n){this.__recordStream(ft.stream(t,e,n))}},{key:"__recordArrayList",value:function(t){null!==t&&this.__recordStream(t.stream())}},{key:"__recordStream",value:function(t){var e=this,n=t.filter((function(t){return t.isAlive()&&t!=e._from}));E.ROBUST?this.merge.getGlyphs().addAll(n.collect(L.toSet())):this.merge.combine(n.collect(this.collector()))}},{key:"recordAllPairs",value:function(t,e){for(var n=t.getGlyphs().toArray(),r=0;r<n.length;++r)this.from(n[r]),Me.start("first merge recording 5"),this.__recordGlyphNumberNumber(n,r+1,n.length),Me.stop("first merge recording 5"),this.addEventsTo(e)}}],[{key:"getInstance",value:function(){var e;return null!==(e=this.INSTANCE)&&void 0!==e?e:this.INSTANCE=new t}},{key:"newInstance",value:function(){if(this.REUSABLE_RECORDS.size()>0&&(null==this.firstReusedRecord||this.REUSABLE_RECORDS.getLast()!=this.firstReusedRecord)){var t=this.REUSABLE_RECORDS.pollLast();return this.REUSABLE_RECORDS.addFirst(t),null===this.firstReusedRecord&&(this.firstReusedRecord=t),t}var e=new ze;return this.REUSABLE_RECORDS.addFirst(e),null===this.firstReusedRecord&&(this.firstReusedRecord=e),e}}]),t}();o(qe,"collector",void 0),o(qe,"INSTANCE",void 0),o(qe,"REUSABLE_RECORDS",new Se),o(qe,"COMBINE_RESULT",new ze),o(qe,"firstReusedRecord",null);var Xe=function(t){a(r,t);var e=y(r);function r(t,i){var a;n(this,r);var s=i,u=null;return"number"==typeof t?s=t:u=t,o(p(a=e.call(this,s)),"counts",void 0),o(p(a),"id",void 0),o(p(a),"next",void 0),o(p(a),"root",void 0),a.counts=null===u?[0,0,0]:null,a.id=null===u?0:u.id+1,a.next=null,a.root=null===u?p(a):u.root,a}return i(r,[{key:"getDeletions",value:function(){return this.getCount(r.DELETION)}},{key:"getDiscarded",value:function(){return this.getCount(r.DISCARD)}},{key:"getInsertions",value:function(){return this.getCount(r.INSERTION)}},{key:"getNumQueues",value:function(){for(var t=this;null!==t.next;)t=t.next;return t.id+1}},{key:"add",value:function(t){this.count(r.INSERTION),this===this.root&&Me.start("queue operations");var e=g(s(r.prototype),"add",this).call(this,t);return this===this.root&&(Me.stop("queue operations"),nt.record(t.getType().toString(),1)),e}},{key:"discard",value:function(){this.count(r.DISCARD),this._pollString(" discarded")}},{key:"peek",value:function(){var t=g(s(r.prototype),"peek",this).call(this);if(null!==this.next){var e=this.next.peek();(null==t||null!=e&&e.getAt()<t.getAt())&&(t=e)}return t}},{key:"poll",value:function(){return this.count(r.DELETION),this._pollString(" handled")}},{key:"_pollString",value:function(t){Me.start("queue operations");var e=this.peek();return this._pollEvent(e),Me.stop("queue operations"),nt.record("queue size",this.size()),nt.record(e.getType().toString()+t,1),e}},{key:"_pollEvent",value:function(t){g(s(r.prototype),"peek",this).call(this)!=t?this.next._pollEvent(t):g(s(r.prototype),"poll",this).call(this)}},{key:"size",value:function(){return this.root.sizeNoPrev()}},{key:"count",value:function(t){this.root.counts[t]++}},{key:"getCount",value:function(t){return this.root.counts[t]}},{key:"sizeNoPrev",value:function(){return g(s(r.prototype),"size",this).call(this)+(null==this.next?0:this.next.sizeNoPrev())}}]),r}(x);o(Xe,"INSERTION",0),o(Xe,"DELETION",1),o(Xe,"DISCARD",2);var Ye=function t(e){n(this,t),o(this,"nestedMerges",new x),o(this,"createdFromTmp",[null,null]),o(this,"trackersNeedingUpdate",new N),o(this,"orphanedCells",new N),o(this,"map",void 0),o(this,"numAlive",0),o(this,"glyphSize",new tt),o(this,"bigGlyphs",new N(2)),o(this,"mergedBigGlyph",!1),this.map=e},He=E.LOGGING_ENABLED?K.getLogger("QuadTreeClusterer"):null,Ue=function(){function t(e){n(this,t),o(this,"tree",void 0),o(this,"result",void 0),o(this,"rec",void 0),this.tree=e,this.result=null,this.rec=null}return i(t,[{key:"cluster",value:function(){var e=null==He?null:He.getLevel();if(E.LOGGING_ENABLED&&null!==He&&(He.log(X.FINER,"ENTRY into AgglomerativeClustering#cluster()"),He.log(X.FINE,"clustering using ".concat(B.join(" + ",E.ROBUST?"ROBUST":"",E.TRACK&&!E.ROBUST?"TRACK":"",E.ROBUST||E.TRACK?"":"FIRST MERGE ONLY","NO BUCKETING")," strategy")),He.log(X.FINE,"using the Linear Area Growing Circles grow function"),He.log(X.FINE,"QuadTree has ".concat(this.tree.getSize()," nodes and height ").concat(this.tree.getTreeHeight(),", having at most ").concat(E.MAX_GLYPHS_PER_CELL," glyphs per cell and cell size at least ").concat(E.MIN_CELL_SIZE.toExponential())),He.isLoggable(X.FINE))){var n,r=0,i=m(this.tree.__getLeaves());try{for(i.s();!(n=i.n()).done;){var o=n.value;nt.record("glyphs per cell",o.getGlyphs().size());var a,s=m(o.getGlyphs());try{for(s.s();!(a=s.n()).done;){r+=a.value.getN()}}catch(t){s.e(t)}finally{s.f()}}}catch(t){i.e(t)}finally{i.f()}nt.record("total # works",r)}E.TIMERS_ENABLED&&Me.start("clustering");var u=new Xe(10*B.size(this.tree.iteratorGlyphsAlive())),l=new $;this.rec=qe.getInstance();var h,c,p=new Ye(l),f=this.tree.getRectangle(),y=m(this.tree.__getLeaves());try{for(y.s();!(h=y.n()).done;)for(var g=h.value,d=g.getGlyphs().toArray(),v=0;v<d.length;++v){E.LOGGING_ENABLED&&null!==He&&He.log(X.FINEST,d[v].toString()),this.rec.from(d[v]),E.TIMERS_ENABLED&&Me.start("first merge recording 1"),this.rec.__recordGlyphNumberNumber(d,v+1,d.length),E.TIMERS_ENABLED&&Me.stop("first merge recording 1"),this.rec.addEventsTo(u,He);var _,b=m(pt.values());try{for(b.s();!(_=b.n()).done;){var O=_.value;B.onBorderOf(g.getSide(O),f)||d[v].record(new U(d[v],g,O))}}catch(t){b.e(t)}finally{b.f()}if(d[v].popOutOfCellInto(u,He),l.put(d[v],new Be(d[v],0)),p.numAlive++,p.glyphSize.record(d[v].getN()),!d[v].isAlive())return E.LOGGING_ENABLED&&null!==He&&He.log(X.SEVERE,"unexpected dead glyph in input"),null}}catch(t){y.e(t)}finally{y.f()}for(E.LOGGING_ENABLED&&null!==He&&He.log(X.FINE,"created ".concat(u.size()," events initially, for ").concat(p.numAlive," glyphs"));null!==(c=t.getNextEvent(u,p));){if(E.LOGGING_ENABLED&&null!==He){if(He.getLevel()>X.FINER){var w,k=m(c.getGlyphs());try{for(k.s();!(w=k.n()).done;){if(w.value.track){He.setLevel(X.FINEST);break}}}catch(t){k.e(t)}finally{k.f()}}He.log(X.FINER,"handling ".concat(c.getType()," at ").concat(c.getAt().toFixed(3)," involving"));var A,C=m(c.getGlyphs());try{for(C.s();!(A=C.n()).done;){var L=A.value;He.log(X.FINER,L.toString())}}catch(t){C.e(t)}finally{C.f()}}switch(c.getType()){case q.MERGE:var N,S=!1,G=m(c.getGlyphs());try{for(G.s();!(N=G.n()).done;){var R=N.value;S=S||R.track}}catch(t){G.e(t)}finally{G.f()}var j,M=null,I=!1,x=m(c.getGlyphs());try{for(x.s();!(j=x.n()).done;){var T=j.value;if(T.isBig()){if(null!=M){M=null,I=!0;break}M=T}}}catch(t){x.e(t)}finally{x.f()}null===M?(I?nt.count("merge big/big"):nt.count("merge small/small"),this.handleGlyphMerge(c,p,u,S)):(nt.count("merge small/big"),this.handleBigGlyphMerge(c,p,u,S));break;case q.OUT_OF_CELL:E.TIMERS_ENABLED&&Me.start("out of cell event processing"),this.handleOutOfCell(c,l,!1,u),E.TIMERS_ENABLED&&Me.stop("out of cell event processing")}this.step(),E.LOGGING_ENABLED&&null!==He&&He.setLevel(e)}if(E.LOGGING_ENABLED&&null!==He){He.isLoggable(X.FINE)&&nt.record("total # works",this.result.getGlyph().getN()),He.log(X.FINE,"created ".concat(u.getInsertions()," events, handled ").concat(u.getDeletions()," and discarded ").concat(u.getDiscarded(),"; ").concat(u.getInsertions()-u.getDeletions()-u.getDiscarded()," events were never considered"));var P,D=m(q.values());try{for(D.s();!(P=D.n()).done;){var F=P.value.toString(),z=nt.get(F);He.log(X.FINE,"→ ".concat(z.getSum()," ").concat(F,"s (").concat(nt.get(F+" handled").getSum()," handled, ").concat(nt.get(F+" discarded").getSum()," discarded)")),nt.remove(F),nt.remove(F+" handled"),nt.remove(F+" discarded")}}catch(t){D.e(t)}finally{D.f()}He.log(X.FINE,"events were stored in ".concat(u.getNumQueues()," queue(s)")),He.log(X.FINE,"QuadTree has ".concat(this.tree.getSize()," nodes and height ").concat(this.tree.getTreeHeight()," now")),nt.logAll(He)}return E.TIMERS_ENABLED&&Me.logAll(He),E.LOGGING_ENABLED&&null!==He&&He.log(X.FINER,"RETURN from AgglomerativeClustering#cluster()"),this}},{key:"getName",value:function(){return"QuadTree Clusterer"}},{key:"findOverlap",value:function(t,e,n,r){var i,o,a=!1,s=m(this.tree.__getLeavesGlyphAt(t,e));try{for(s.s();!(o=s.n()).done;){var u,l=m(o.value.getGlyphsAlive());try{for(l.s();!(u=l.n()).done;){var h=u.value;(i=F.__intersectAtGlyphGlyph(t,h))<=e&&(a=!0,n.add(new H(null,h,i)))}}catch(t){l.e(t)}finally{l.f()}}}catch(t){s.e(t)}finally{s.f()}var c,p=m(r);try{for(p.s();!(c=p.n()).done;){var f=c.value;f!==t&&(i=F.__intersectAtGlyphGlyph(t,f))<=e&&(a=!0,n.add(new H(null,f,i)))}}catch(t){p.e(t)}finally{p.f()}return a}},{key:"handleBigGlyphMerge",value:function(t,e,n,r){E.TIMERS_ENABLED&&Me.start("[merge event processing] big");var i=this.processNestedMerges(t,e,n,r);if(i.isBig())if(e.mergedBigGlyph)this.initializeBigGlyphEvents(i,e);else{var o,a=m(t.getGlyphs());try{for(a.s();!(o=a.n()).done;){var s=o.value;s.isBig()&&i.adoptUncertainMergeEvents(s,t)}}catch(t){a.e(t)}finally{a.f()}}else{var u,l=m(e.bigGlyphs);try{for(l.s();!(u=l.n()).done;){var h=u.value;h.record(new V(new H(h,i)))}}catch(t){l.e(t)}finally{l.f()}this.recordEventsForGlyph(i,t.getAt(),n)}this.recordGlyphAndStats(i,e,r),E.TIMERS_ENABLED&&Me.stop("[merge event processing] big")}},{key:"handleGlyphMerge",value:function(t,e,n,r){var i=this.processNestedMerges(t,e,n,r);if(i.isBig())this.initializeBigGlyphEvents(i,e);else{var o,a=m(e.bigGlyphs);try{for(a.s();!(o=a.n()).done;){var s=o.value;s.record(new V(new H(s,i)))}}catch(t){a.e(t)}finally{a.f()}this.recordEventsForGlyph(i,t.getAt(),n)}this.recordGlyphAndStats(i,e,r)}},{key:"handleOutOfCell",value:function(t,e,n,r){var i=t.getGlyphs()[0];if(n&&B.Double.neq(e.get(i).getAt(),t.getAt())){var o=new Be(i,t.getAt(),e.get(i));e.put(i,o)}var a=t.getCell().getNonOrphanAncestor();if(t.getCell()!==a&&!B.onBorderOf(t.getCell().getSide(t.getSide()),a.getRectangle()))return i.record(new U(i,a,t.getSide())),void i.popOutOfCellInto(r,He);var s=t.getAt(),u=t.getSide().opposite(),l=pt.interval(F.sizeAt(i,s).getBounds2D(),t.getSide());E.LOGGING_ENABLED&&null!==He&&He.log(X.FINER,"size at border is [".concat(l,"]"));var h=a.getNeighbors(t.getSide()).copy();E.LOGGING_ENABLED&&null!==He&&He.log(X.FINEST,"growing out of ".concat(t.getSide()," of ").concat(t.getCell()," into"));var c,p=m(h);try{for(p.s();!(c=p.n()).done;){var f=c.value;if(E.LOGGING_ENABLED&&null!==He&&He.log(X.FINEST,f.toString()),B.intervalsOverlap(pt.interval(f.getSide(u),u),l))if(null!==f.getGlyphs()&&f.getGlyphs().contains(i))E.LOGGING_ENABLED&&null!==He&&He.log(X.FINEST,"→ but was already in there, so ignoring"),i.popOutOfCellInto(r,He);else{f.insert(i,s);var y=void 0;if(null!==f.getGlyphs()&&f.getGlyphs().size()>E.MAX_GLYPHS_PER_CELL){if(f.__splitAt(s),y=f.__getLeavesGlyphAt(i,s),E.LOGGING_ENABLED&&null!==He&&He.isLoggable(X.FINE)){var g,d=m(f.__getLeaves());try{for(d.s();!(g=d.n()).done;){var v=g.value;nt.record("glyphs per cell",v.getGlyphsAlive().size())}}catch(t){d.e(t)}finally{d.f()}}}else y=f.__getLeaves();this.rec.from(i);var _,b=m(y);try{for(b.s();!(_=b.n()).done;){var O=_.value;Me.start("first merge recording 4"),this.rec.__recordArrayList(O.getGlyphs()),Me.stop("first merge recording 4");var w,k=m(t.getSide().opposite().others());try{for(k.s();!(w=k.n()).done;){var A=w.value,C=F.exitAt(i,O,A);if(C>=s){var L,N=!1,S=m(O.getNeighbors(A));try{for(S.s();!(L=S.n()).done;){if(!L.value.getGlyphs().contains(i)){N=!0;break}}}catch(t){S.e(t)}finally{S.f()}if(!N)continue;E.LOGGING_ENABLED&&null!==He&&He.log(X.FINEST,"→ out of ".concat(A," of ").concat(O," at ").concat(C.toFixed(3))),i.record(new U(i,O,A,C))}}}catch(t){k.e(t)}finally{k.f()}}}catch(t){b.e(t)}finally{b.f()}i.popOutOfCellInto(r,He),this.rec.addEventsTo(r,He)}else E.LOGGING_ENABLED&&null!==He&&He.log(X.FINEST,"→ but not at this point in time, so ignoring")}}catch(t){p.e(t)}finally{p.f()}}},{key:"initializeBigGlyphEvents",value:function(t,e){var n,r=m(e.bigGlyphs);try{for(r.s();!(n=r.n()).done;){var i=n.value;t.record(new V(new H(t,i)))}}catch(t){r.e(t)}finally{r.f()}var o,a=m(this.tree.iteratorGlyphsAlive());try{for(a.s();!(o=a.n()).done;){var s=o.value;t.record(new V(new H(t,s)))}}catch(t){a.e(t)}finally{a.f()}}},{key:"processNestedMerges",value:function(t,e,n,r){E.TIMERS_ENABLED&&(Me.start("[merge event processing] total"),r&&Me.start("[merge event processing] total (track)")),e.nestedMerges.add(t),e.mergedBigGlyph=!1;var i=null,o=null,a=t.getAt();E.TIMERS_ENABLED&&Me.start("[merge event processing] nested merges");do{t:for(;!e.nestedMerges.isEmpty();){var s,u=m((t=e.nestedMerges.poll()).getGlyphs());try{for(u.s();!(s=u.n()).done;){var l=s.value;if(null!==l&&!l.isAlive())continue t}}catch(t){u.e(t)}finally{u.f()}E.LOGGING_ENABLED&&null!==He&&He.log(X.FINEST,"handling nested "+t),null===o?(i=new ut(t.getGlyphs()),o=h(Be,[i,a].concat(v(B.map(t.getGlyphs(),e.map,e.createdFromTmp))))):(o.alsoCreatedFrom(e.map.get(t.getGlyphs()[1])),i=new ut(i,t.getGlyphs()[1]),o.setGlyph(i),t.getGlyphs()[1].isBig()?(e.mergedBigGlyph=!0,nt.count("merge nested big")):nt.count("merge nested small"));var c,p=m(t.getGlyphs());try{for(p.s();!(c=p.n()).done;){var f=c.value;if(null!==f&&f.isAlive()){f.perish(),e.numAlive--,e.glyphSize.unrecord(f.getN()),f.isBig()&&e.bigGlyphs.remove(f);var y,g=m(f.getCells().copy());try{for(g.s();!(y=g.n()).done;){var d=y.value;d.removeGlyph(f,a)&&e.orphanedCells.add(d)}}catch(t){g.e(t)}finally{g.f()}if(E.TRACK&&!E.ROBUST){var _,b=m(f.trackedBy);try{for(b.s();!(_=b.n()).done;){var O=_.value;e.trackersNeedingUpdate.contains(O)||e.trackersNeedingUpdate.add(O)}}catch(t){b.e(t)}finally{b.f()}}}}}catch(t){p.e(t)}finally{p.f()}E.LOGGING_ENABLED&&null!==He&&He.log(X.FINEST,"→ merged glyph is ".concat(i))}}while(this.findOverlap(i,a,e.nestedMerges,e.bigGlyphs));E.TIMERS_ENABLED&&(Me.stop("[merge event processing] nested merges"),Me.start("[merge event processing] merge events in joined cells"));var w,k=new C,A=m(e.orphanedCells);try{for(A.s();!(w=A.n()).done;){var L=w.value.getNonOrphanAncestor();k.add(L)&&(E.TIMERS_ENABLED&&Me.start("record all pairs"),this.rec.recordAllPairs(L.getNonOrphanAncestor(),n),E.TIMERS_ENABLED&&Me.stop("record all pairs"))}}catch(t){A.e(t)}finally{A.f()}if(e.orphanedCells.clear(),E.TIMERS_ENABLED&&(Me.stop("[merge event processing] merge events in joined cells"),Me.start("[merge event processing] tracker updating")),E.TRACK&&!E.ROBUST){var N,S=m(e.trackersNeedingUpdate);try{for(S.s();!(N=S.n()).done;){var G=N.value;if(G.isAlive()&&(nt.record("orphan cells",G.getCells().size()),!G.popMergeInto(n,He))){this.rec.from(G),E.TIMERS_ENABLED&&Me.start("first merge recording 2");var R,j=m(G.getCells());try{for(j.s();!(R=j.n()).done;){var M=R.value;this.rec.__recordArrayList(M.getGlyphs())}}catch(t){j.e(t)}finally{j.f()}E.TIMERS_ENABLED&&Me.stop("first merge recording 2"),this.rec.addEventsTo(n,He)}}}catch(t){S.e(t)}finally{S.f()}e.trackersNeedingUpdate.clear()}return E.TIMERS_ENABLED&&(Me.stop("[merge event processing] tracker updating"),Me.start("[merge event processing] merged glyph insert")),i.setBig(e.glyphSize),i.isBig()||(this.tree.insert(i,a),E.LOGGING_ENABLED&&null!==He&&He.log(X.FINER,"inserted merged glyph into ".concat(i.getCells().size()," cells"))),E.TIMERS_ENABLED&&Me.stop("[merge event processing] merged glyph insert"),e.map.put(i,o),this.result=o,i}},{key:"recordGlyphAndStats",value:function(t,e,n){t.participate(),e.numAlive++,e.glyphSize.record(t.getN()),t.isBig()&&(nt.record("merged cells big glyphs",t.getCells().size()),nt.record("glyphs around big glyphs",t.getCells().stream().mapToInt((function(t){return t.getGlyphsAlive().size()})).sum()),e.bigGlyphs.add(t),nt.record("number of big glyphs",e.bigGlyphs.size())),E.TIMERS_ENABLED&&(Me.stop("[merge event processing] total"),n&&Me.stop("[merge event processing] total (track)"))}},{key:"recordEventsForGlyph",value:function(t,e,n){E.TIMERS_ENABLED&&Me.start("[merge event processing] merge event recording"),this.rec.from(t),nt.record("merged cells",t.getCells().size());var r,i=m(t.getCells());try{for(i.s();!(r=i.n()).done;){var o=r.value;E.TIMERS_ENABLED&&Me.start("first merge recording 3"),this.rec.__recordArrayList(o.getGlyphs()),E.TIMERS_ENABLED&&Me.stop("first merge recording 3");var a,s=m(pt.values());try{for(s.s();!(a=s.n()).done;){var u=a.value,l=!1;E.TIMERS_ENABLED&&Me.start("neighbor finding");var h=o.getNeighbors(u);E.TIMERS_ENABLED&&Me.stop("neighbor finding");var c,p=m(h);try{for(p.s();!(c=p.n()).done;){if(!c.value.getGlyphs().contains(t)){l=!0;break}}}catch(t){p.e(t)}finally{p.f()}if(l){var f=new U(t,o,u);f.getAt()>e&&(t.record(f),E.LOGGING_ENABLED&&null!==He&&He.log(X.FINEST,"→ out of ".concat(u," of ").concat(o," at ").concat(f.getAt().toFixed(3))))}}}catch(t){s.e(t)}finally{s.f()}}}catch(t){i.e(t)}finally{i.f()}t.popOutOfCellInto(n,He),this.rec.addEventsTo(n,He),E.TIMERS_ENABLED&&Me.stop("[merge event processing] merge event recording")}},{key:"step",value:function(){E.STATS_ENABLED&&(nt.record("QuadTree cells",B.size(this.tree.iterator())),nt.record("QuadTree leaves",this.tree.__getLeaves().size()),nt.record("QuadTree height",this.tree.getTreeHeight()))}},{key:"getClustering",value:function(){return this.result}},{key:"reset",value:function(){this.result=null}}],[{key:"getNextEvent",value:function(t,e){if(e.numAlive<=1)return null;var n=null,r=null;t:for(;!t.isEmpty();){if((n=t.peek()).getType()!=q.OUT_OF_CELL||n.getCell().isLeaf()){var i,o=m(n.getGlyphs());try{for(o.s();!(i=o.n()).done;){if(!i.value.isAlive()){t.discard();continue t}}}catch(t){o.e(t)}finally{o.f()}n=r=t.peek();break}t.discard()}var a,s,u=null,l=m(e.bigGlyphs);try{for(l.s();!(a=l.n()).done;){var h=a.value;E.LOGGING_ENABLED&&null!==He&&He.log(X.FINER,"searching for uncertain merge on ".concat(h));var c=h.peekUncertain();E.LOGGING_ENABLED&&null!==He&&(null==He||He.log(X.FINER,"found ".concat(c))),(null==n||null!=c&&c.getAt()<n.getAt())&&(n=c.getGlyphMerge(),u=h)}}catch(t){l.e(t)}finally{l.f()}null!==n&&(n===r?t.poll():null===(s=u)||void 0===s||s.pollUncertain());return n}}]),t}();t.Constants=E,t.Glyph=ut,t.QuadTree=xe,t.QuadTreeClusterer=Ue,t.isGlyph=st,Object.defineProperty(t,"__esModule",{value:!0})}));
